<!DOCTYPE html>
<html lang="en-us">

<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="generator" content="Source Themes Academic 4.5.0">

  

  
  
  
  
  
    
    
    
  
  

  <meta name="author" content="Ye Zhaoliang">

  
  
  
    
  
  <meta name="description" content="">

  
  <link rel="alternate" hreflang="en-us" href="https://jueqingsizhe66.github.io/blog/2015/05/11/duo-xian-cheng-march18th/">

  


  
  
  
  <meta name="theme-color" content="#2962ff">
  

  
  
  
  
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/academicons/1.8.6/css/academicons.min.css" integrity="sha256-uFVgMKfistnJAfoCUQigIl+JfUaP47GrRKjf6CTPVmw=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.0/css/all.css" integrity="sha384-aOkxzJ5uQz7WBObEZcHvV5JvRW3TUc2rNPA7pe3AwnsUohiw1Vj2Rgx2KSOkF5+h" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.2.5/jquery.fancybox.min.css" integrity="sha256-ygkqlh3CYSUri3LhQxzdcm0n1EQvH2Y+U5S2idbLtxs=" crossorigin="anonymous">

    
    
    
      
    
    
      
      
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/styles/solarized-dark.min.css" crossorigin="anonymous" title="hl-light">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/styles/solarized-dark.min.css" crossorigin="anonymous" title="hl-dark" disabled>
      
    

    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.2.0/leaflet.css" integrity="sha512-M2wvCLH6DSRazYeZRIm1JnYyh22purTM+FDB5CsyxtQJYeKq83arPe5wgbNmcFXGqiSH2XR8dT/fJISVA1r/zQ==" crossorigin="anonymous">
    

    

  

  
  
  
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Montserrat:400,700%7CRoboto:400,400italic,700%7CRoboto+Mono&display=swap">
  

  
  
  
  <link rel="stylesheet" href="/css/academic.min.e8d4d5fd376e67b34452ebe1cae16341.css">

  

  




  


  

  <link rel="manifest" href="/index.webmanifest">
  <link rel="icon" type="image/png" href="/img/icon-32.png">
  <link rel="apple-touch-icon" type="image/png" href="/img/icon-192.png">

  <link rel="canonical" href="https://jueqingsizhe66.github.io/blog/2015/05/11/duo-xian-cheng-march18th/">

  
  
  
  
    
    
  
  
  <meta property="twitter:card" content="summary">
  
  <meta property="twitter:site" content="@jueqingsizhe66">
  <meta property="twitter:creator" content="@jueqingsizhe66">
  
  <meta property="og:site_name" content="简约派">
  <meta property="og:url" content="https://jueqingsizhe66.github.io/blog/2015/05/11/duo-xian-cheng-march18th/">
  <meta property="og:title" content="多线程March18th | 简约派">
  <meta property="og:description" content=""><meta property="og:image" content="https://jueqingsizhe66.github.io/img/icon-192.png">
  <meta property="twitter:image" content="https://jueqingsizhe66.github.io/img/icon-192.png"><meta property="og:locale" content="en-us">
  
    
      <meta property="article:published_time" content="2015-05-11T14:58:45&#43;08:00">
    
    <meta property="article:modified_time" content="2015-05-11T14:58:45&#43;08:00">
  

  



  


  


  





  <title>多线程March18th | 简约派</title>

</head>

<body id="top" data-spy="scroll" data-offset="70" data-target="#TableOfContents" >

  <aside class="search-results" id="search">
  <div class="container">
    <section class="search-header">

      <div class="row no-gutters justify-content-between mb-3">
        <div class="col-6">
          <h1>Search</h1>
        </div>
        <div class="col-6 col-search-close">
          <a class="js-search" href="#"><i class="fas fa-times-circle text-muted" aria-hidden="true"></i></a>
        </div>
      </div>

      <div id="search-box">
        
        <input name="q" id="search-query" placeholder="Search..." autocapitalize="off"
        autocomplete="off" autocorrect="off" spellcheck="false" type="search">
        
      </div>

    </section>
    <section class="section-search-results">

      <div id="search-hits">
        
      </div>

    </section>
  </div>
</aside>


  
<nav class="navbar navbar-light fixed-top navbar-expand-lg py-0 compensate-for-scrollbar" id="navbar-main">
  <div class="container">

    
      <a class="navbar-brand" href="/">简约派</a>
      
      <button type="button" class="navbar-toggler" data-toggle="collapse"
              data-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
        <span><i class="fas fa-bars"></i></span>
      </button>
      

    
    <div class="collapse navbar-collapse" id="navbar">

      
      
      <ul class="navbar-nav ml-auto">
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#hero"><span>概要</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#posts"><span>博文</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#projects"><span>项目</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#featured"><span>Publications</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        

        <li class="nav-item">
          <a class="nav-link " href="/about/"><span>About</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        

        <li class="nav-item">
          <a class="nav-link " href="/courses/"><span>课程</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        

        <li class="nav-item">
          <a class="nav-link " href="/categories/"><span>分类</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        

        <li class="nav-item">
          <a class="nav-link " href="/archives"><span>归档</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#tags"><span>标签</span></a>
        </li>

        
        

      

        

        
        <li class="nav-item">
          <a class="nav-link js-search" href="#"><i class="fas fa-search" aria-hidden="true"></i></a>
        </li>
        

        

        
        <li class="nav-item">
          <a class="nav-link js-dark-toggle" href="#"><i class="fas fa-moon" aria-hidden="true"></i></a>
        </li>
        

      </ul>

    </div>
  </div>
</nav>


  <article class="article">

  








  
 <script async src="//cdn.busuanzi.ibruce.info/cdn/busuanzi/2.3/busuanzi.pure.mini.js"></script> 
 <script src="//cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script> 
 <script> 
     $(document).ready(function() { 
         var int = setInterval(fixCount, 100); 
         var busuanziSiteOffset =  100000  
         function fixCount() { 
             if ($("#busuanzi_container_site_pv").css("display") != "none") { 
                 clearInterval(int); 
                 $("#busuanzi_value_site_pv").html(parseInt($("#busuanzi_value_site_pv").html()) + busuanziSiteOffset); 
             } 
         } 
     }); 
 </script> 
  






  

  
  
  
<div class="article-container pt-3">
  <h1>多线程March18th</h1>

  

  
    


<div class="article-metadata">

  
  

  
  <span class="article-date">
    
    
      
    
    May 11, 2015
  </span>

  

  

  

  
  
  

  
  
  <span class="middot-divider"></span>
  <span class="article-categories">
    <i class="fas fa-folder mr-1"></i><a href="/categories/programme/">programme</a></span>

  
</div>

    














  
</div>





<span class="article-metadata" >Reading time: 114 minutes and    10 seconds with 25118 words. 本文总阅读量<span id="busuanzi_value_page_pv"></span>次 </span>
    <aside>
        <nav id="TableOfContents">
  <ul>
    <li><a href="#threads----implements">start&mdash;>Runnable&mdash;-> Running&mdash;>Dead|               ||               |Threads    implements</a></li>
    <li><a href="#running---wait---blocked---notify----runnable">Running&mdash;>Wait&mdash;>Blocked&mdash;>notify&mdash;->Runnable</a></li>
    <li><a href="#running---sleep---runnable">Running&mdash;>sleep&mdash;>Runnable</a></li>
  </ul>
</nav>
    </aside>
  <div class="article-container">


    <div class="article-style">
      <p>4:java多线程</p>
<p>新建状态(start)
可运行状态(runnable)
运行状态(run)
阻塞装填(sleep)
死亡状态（stop,dead）</p>
<hr>
<h2 id="threads----implements">start&mdash;&gt;Runnable&mdash;-&gt; Running&mdash;&gt;Dead
|               |
|               |
Threads    implements</h2>
<h2 id="running---wait---blocked---notify----runnable">Running&mdash;&gt;Wait&mdash;&gt;Blocked&mdash;&gt;notify&mdash;-&gt;Runnable</h2>
<h2 id="running---sleep---runnable">Running&mdash;&gt;sleep&mdash;&gt;Runnable</h2>
<p>线程和进程的区别？
一个进程占用实际的内存资源，线程依赖于进程，一个进程可以有多个线程
进程大，线程小
每一个程序运行都运行在一个进程内，而不是线程
一个进程可分为多个线程</p>
<p>售票案例
问题： 第70张票还没售完不能售第73张的票，但是实际却是销售了？</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#75715e">/**
</span><span style="color:#75715e">* 解释：
</span><span style="color:#75715e">*/</span>
<span style="color:#f92672">package</span> TestMultiThreads<span style="color:#f92672">;</span>

<span style="color:#75715e">/**
</span><span style="color:#75715e">* @author 叶昭良
</span><span style="color:#75715e">* @time 2015年3月18日下午9:09:27
</span><span style="color:#75715e">* @version TestMultiThreadsTestPesonThread V1.0
</span><span style="color:#75715e">* 功能： 
</span><span style="color:#75715e">步骤：
</span><span style="color:#75715e">* 注意：
</span><span style="color:#75715e">* 掌握：
</span><span style="color:#75715e">思考：
</span><span style="color:#75715e">* 回顾：
</span><span style="color:#75715e">*/</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">TestPesonThread</span>
<span style="color:#f92672">{</span>

<span style="color:#75715e">/**
</span><span style="color:#75715e">* @param args 
</span><span style="color:#75715e">* 原因：
</span><span style="color:#75715e">* 解决：
</span><span style="color:#75715e">* 功能：
</span><span style="color:#75715e">* 思考： 
</span><span style="color:#75715e">* 步骤：
</span><span style="color:#75715e">*/</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">main</span><span style="color:#f92672">(</span>String<span style="color:#f92672">[</span><span style="color:#f92672">]</span> args<span style="color:#f92672">)</span>
<span style="color:#f92672">{</span>
<span style="color:#75715e">// TODO Auto-generated method stub
</span><span style="color:#75715e"></span>
A aa <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> A<span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
Thread t1 <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Thread<span style="color:#f92672">(</span>aa<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
Thread t2 <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Thread<span style="color:#f92672">(</span>aa<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
Thread t3 <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Thread<span style="color:#f92672">(</span>aa<span style="color:#f92672">)</span><span style="color:#f92672">;</span>

<span style="color:#75715e">/*        B bb = new B();
</span><span style="color:#75715e">Thread t1 = new Thread(bb);
</span><span style="color:#75715e">Thread t2 = new Thread(bb);
</span><span style="color:#75715e">Thread t3 = new Thread(bb);*/</span>

t1<span style="color:#f92672">.</span><span style="color:#a6e22e">start</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
t2<span style="color:#f92672">.</span><span style="color:#a6e22e">start</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
t3<span style="color:#f92672">.</span><span style="color:#a6e22e">start</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
<span style="color:#f92672">}</span>

<span style="color:#f92672">}</span>

<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">A</span> <span style="color:#66d9ef">implements</span> Runnable
<span style="color:#f92672">{</span>
<span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">int</span> tickets <span style="color:#f92672">=</span> 0<span style="color:#f92672">;</span>
<span style="color:#a6e22e">@Override</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">run</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span>
<span style="color:#f92672">{</span>
<span style="color:#75715e">// TODO Auto-generated method stub
</span><span style="color:#75715e"></span><span style="color:#66d9ef">while</span><span style="color:#f92672">(</span><span style="color:#66d9ef">true</span><span style="color:#f92672">)</span>
<span style="color:#f92672">{</span>
<span style="color:#75715e">//synchronized(&#34;aaa&#34;)
</span><span style="color:#75715e"></span><span style="color:#f92672">{</span>
<span style="color:#66d9ef">if</span><span style="color:#f92672">(</span>tickets <span style="color:#f92672">&lt;</span> 10<span style="color:#f92672">)</span>
<span style="color:#f92672">{</span>
System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span>Thread<span style="color:#f92672">.</span><span style="color:#a6e22e">currentThread</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">.</span><span style="color:#a6e22e">getName</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">+</span>tickets<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
tickets<span style="color:#f92672">+</span><span style="color:#f92672">+</span><span style="color:#f92672">;</span>
<span style="color:#f92672">}</span><span style="color:#66d9ef">else</span>
<span style="color:#f92672">{</span>
<span style="color:#66d9ef">break</span><span style="color:#f92672">;</span>
<span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>

<span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>

<span style="color:#f92672">}</span>


<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">B</span> <span style="color:#66d9ef">implements</span> Runnable
<span style="color:#f92672">{</span>
<span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">int</span> tickets <span style="color:#f92672">=</span> 0<span style="color:#f92672">;</span>
<span style="color:#a6e22e">@Override</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">synchronized</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">run</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span>
<span style="color:#f92672">{</span>
<span style="color:#75715e">// TODO Auto-generated method stub
</span><span style="color:#75715e"></span><span style="color:#66d9ef">while</span><span style="color:#f92672">(</span><span style="color:#66d9ef">true</span><span style="color:#f92672">)</span>
<span style="color:#f92672">{</span>
<span style="color:#66d9ef">if</span><span style="color:#f92672">(</span>tickets <span style="color:#f92672">&lt;</span> 10<span style="color:#f92672">)</span>
<span style="color:#f92672">{</span>
System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span>Thread<span style="color:#f92672">.</span><span style="color:#a6e22e">currentThread</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">.</span><span style="color:#a6e22e">getName</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">+</span>tickets<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
tickets<span style="color:#f92672">+</span><span style="color:#f92672">+</span><span style="color:#f92672">;</span>
<span style="color:#f92672">}</span><span style="color:#66d9ef">else</span>
<span style="color:#f92672">{</span>
<span style="color:#66d9ef">break</span><span style="color:#f92672">;</span>
<span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>

<span style="color:#f92672">}</span>
</code></pre></div><p>解决方案1： 采用synchronized(&ldquo;aaa&rdquo;) 或者 synchronized(TestPesonThread.class) 都是可以的，  相当于在一扇门中
塞入了口香糖，得拿走了才能打开！一个坑的作用</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#a6e22e">@Override</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">run</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span>
<span style="color:#f92672">{</span>
<span style="color:#75715e">// TODO Auto-generated method stub
</span><span style="color:#75715e"></span><span style="color:#66d9ef">while</span><span style="color:#f92672">(</span><span style="color:#66d9ef">true</span><span style="color:#f92672">)</span>
<span style="color:#f92672">{</span>
<span style="color:#75715e">//synchronized(&#34;aaa&#34;)
</span><span style="color:#75715e"></span><span style="color:#66d9ef">synchronized</span><span style="color:#f92672">(</span>TestPesonThread<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">)</span>
<span style="color:#f92672">{</span>
<span style="color:#66d9ef">if</span><span style="color:#f92672">(</span>tickets <span style="color:#f92672">&lt;</span> 10<span style="color:#f92672">)</span>
<span style="color:#f92672">{</span>
System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span>Thread<span style="color:#f92672">.</span><span style="color:#a6e22e">currentThread</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">.</span><span style="color:#a6e22e">getName</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">+</span>tickets<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
tickets<span style="color:#f92672">+</span><span style="color:#f92672">+</span><span style="color:#f92672">;</span>
<span style="color:#f92672">}</span><span style="color:#66d9ef">else</span>
<span style="color:#f92672">{</span>
<span style="color:#66d9ef">break</span><span style="color:#f92672">;</span>
<span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>

<span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>

</code></pre></div><p>结果：（注意加入Thread.sleep(1000）不然都会在thread0 或者thread1 thread2中执行，因为少）</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">Thread<span style="color:#f92672">-</span>0正在售10
Thread<span style="color:#f92672">-</span>2正在售9
Thread<span style="color:#f92672">-</span>1正在售8
Thread<span style="color:#f92672">-</span>2正在售7
Thread<span style="color:#f92672">-</span>2正在售6
Thread<span style="color:#f92672">-</span>2正在售5
Thread<span style="color:#f92672">-</span>0正在售4
Thread<span style="color:#f92672">-</span>2正在售3
Thread<span style="color:#f92672">-</span>2正在售2
Thread<span style="color:#f92672">-</span>2正在售1
</code></pre></div><p>解决方案2 ：  采用synchronized的run方法也是可以的！ 相当于锁定函数代码块，霸占着 直到用完！ 但是这个方法仅仅针对一个线程，执行完！一个对象霸占一个方法</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#75715e">/**
</span><span style="color:#75715e">* 解释：
</span><span style="color:#75715e">*/</span>
<span style="color:#f92672">package</span> TestMultiThreads<span style="color:#f92672">;</span>

<span style="color:#75715e">/**
</span><span style="color:#75715e">* @author 叶昭良
</span><span style="color:#75715e">* @time 2015年3月18日下午9:09:27
</span><span style="color:#75715e">* @version TestMultiThreadsTestPesonThread V1.0
</span><span style="color:#75715e">* 功能： 
</span><span style="color:#75715e">步骤：
</span><span style="color:#75715e">* 注意：
</span><span style="color:#75715e">* 掌握：
</span><span style="color:#75715e">思考：
</span><span style="color:#75715e">* 回顾：
</span><span style="color:#75715e">*/</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">TestPesonThread</span>
<span style="color:#f92672">{</span>

<span style="color:#75715e">/**
</span><span style="color:#75715e">* @param args 
</span><span style="color:#75715e">* 原因：
</span><span style="color:#75715e">* 解决：
</span><span style="color:#75715e">* 功能：
</span><span style="color:#75715e">* 思考： 
</span><span style="color:#75715e">* 步骤：
</span><span style="color:#75715e">*/</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">main</span><span style="color:#f92672">(</span>String<span style="color:#f92672">[</span><span style="color:#f92672">]</span> args<span style="color:#f92672">)</span>
<span style="color:#f92672">{</span>
<span style="color:#75715e">// TODO Auto-generated method stub
</span><span style="color:#75715e"></span>
A aa <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> A<span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
Thread t1 <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Thread<span style="color:#f92672">(</span>aa<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
Thread t2 <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Thread<span style="color:#f92672">(</span>aa<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
Thread t3 <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Thread<span style="color:#f92672">(</span>aa<span style="color:#f92672">)</span><span style="color:#f92672">;</span>

<span style="color:#75715e">/*        B bb = new B();
</span><span style="color:#75715e">Thread t1 = new Thread(bb);
</span><span style="color:#75715e">Thread t2 = new Thread(bb);
</span><span style="color:#75715e">Thread t3 = new Thread(bb);*/</span>

t1<span style="color:#f92672">.</span><span style="color:#a6e22e">start</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
t2<span style="color:#f92672">.</span><span style="color:#a6e22e">start</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
t3<span style="color:#f92672">.</span><span style="color:#a6e22e">start</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
<span style="color:#f92672">}</span>

<span style="color:#f92672">}</span>

<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">A</span> <span style="color:#66d9ef">implements</span> Runnable
<span style="color:#f92672">{</span>
<span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">int</span> tickets <span style="color:#f92672">=</span> 0<span style="color:#f92672">;</span>
<span style="color:#a6e22e">@Override</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">synchronized</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">run</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span>
<span style="color:#f92672">{</span>
<span style="color:#75715e">// TODO Auto-generated method stub
</span><span style="color:#75715e"></span><span style="color:#66d9ef">while</span><span style="color:#f92672">(</span><span style="color:#66d9ef">true</span><span style="color:#f92672">)</span>
<span style="color:#f92672">{</span>
<span style="color:#75715e">//synchronized(&#34;aaa&#34;)
</span><span style="color:#75715e"></span><span style="color:#75715e">//synchronized(TestPesonThread.class)
</span><span style="color:#75715e"></span><span style="color:#f92672">{</span>
<span style="color:#66d9ef">if</span><span style="color:#f92672">(</span>tickets <span style="color:#f92672">&lt;</span> 10<span style="color:#f92672">)</span>
<span style="color:#f92672">{</span>
System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span>Thread<span style="color:#f92672">.</span><span style="color:#a6e22e">currentThread</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">.</span><span style="color:#a6e22e">getName</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">+</span><span style="color:#e6db74">&#34;正在售&#34;</span><span style="color:#f92672">+</span>tickets<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
tickets<span style="color:#f92672">+</span><span style="color:#f92672">+</span><span style="color:#f92672">;</span>
<span style="color:#f92672">}</span><span style="color:#66d9ef">else</span>
<span style="color:#f92672">{</span>
<span style="color:#66d9ef">break</span><span style="color:#f92672">;</span>
<span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>

<span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>

<span style="color:#f92672">}</span>


<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">B</span> <span style="color:#66d9ef">implements</span> Runnable
<span style="color:#f92672">{</span>
<span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">int</span> tickets <span style="color:#f92672">=</span> 0<span style="color:#f92672">;</span>
<span style="color:#a6e22e">@Override</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">synchronized</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">run</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span>
<span style="color:#f92672">{</span>
<span style="color:#75715e">// TODO Auto-generated method stub
</span><span style="color:#75715e"></span><span style="color:#66d9ef">while</span><span style="color:#f92672">(</span><span style="color:#66d9ef">true</span><span style="color:#f92672">)</span>
<span style="color:#f92672">{</span>
<span style="color:#66d9ef">if</span><span style="color:#f92672">(</span>tickets <span style="color:#f92672">&lt;</span> 10<span style="color:#f92672">)</span>
<span style="color:#f92672">{</span>
System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span>Thread<span style="color:#f92672">.</span><span style="color:#a6e22e">currentThread</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">.</span><span style="color:#a6e22e">getName</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">+</span>tickets<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
tickets<span style="color:#f92672">+</span><span style="color:#f92672">+</span><span style="color:#f92672">;</span>
<span style="color:#f92672">}</span><span style="color:#66d9ef">else</span>
<span style="color:#f92672">{</span>
<span style="color:#66d9ef">break</span><span style="color:#f92672">;</span>
<span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>

<span style="color:#f92672">}</span>
</code></pre></div><p>结果：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">Thread<span style="color:#f92672">-</span>0正在售10
Thread<span style="color:#f92672">-</span>0正在售9
Thread<span style="color:#f92672">-</span>0正在售8
Thread<span style="color:#f92672">-</span>0正在售7
Thread<span style="color:#f92672">-</span>0正在售6
Thread<span style="color:#f92672">-</span>0正在售5
Thread<span style="color:#f92672">-</span>0正在售4
Thread<span style="color:#f92672">-</span>0正在售3
Thread<span style="color:#f92672">-</span>0正在售2
Thread<span style="color:#f92672">-</span>0正在售1
</code></pre></div><p>由此我们可以得知：
方法的霸占解决掉乱序，但是其实仅仅只是一个线程再执行，不能达到目的；
而采用synchronized对象 比如字符串对象&quot;aaa&rdquo;,不然类的class :TestPesonThread.class 放在循环快中都能够很好的解决多线程共用一个模块，必须执行一块完毕，才能执行下一块的问题！！perfect</p>
<p>案例2：生产和消费</p>
<p>目的：通过线程模拟一个在生产  一个在消费，并且当量小于三的时候，必须再生产，在量</p>
<p>wait方法的作用是使得当前调用wait方法所在部分（代码块）的线程（当前线程）停止执行，并释放当前获得的调用wait所在的代码块的锁，并在其他线程调用notify或者notifyAll方法时恢复到竞争锁状态（一旦获得锁就恢复执行）。
有点类似巫医的弹弹乐效果，你被弹了，就停止，当别人被弹了，你就可以运动了</p>
<p>注意：
wait被调用的时候必须在拥有锁（即synchronized修饰的）的代码块中。
恢复执行后，从wait的下一条语句开始执行，因而wait方法总是应当在while循环中调用，以免出现恢复执行后继续执行的条件不满足却继续执行的情况。
notify方法通知调用了wait方法，但是尚未激活的一个线程进入线程调度队列（即进入锁竞争），注意不是立即执行。并且具体是哪一个线程不能保证。另外一点就是被唤醒的这个线程一定是在等待wait所释放的锁。
notifyAll方法则唤醒所有调用了wait方法，尚未激活的进程进入竞争队列。</p>
<p>有一个wait框，同时有一个监工notify,负责叫醒被暂停的waiter,去继续做他的被中断的工作
synstack 类定义了synchronized的push和pop方法
producer 进行push调用（可以被中断，当达到生产线程的上限时 就中断）
customer 进行pop调用（可以被中断，当没有产品的时候  并在产品数为3的时候通知生产）</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#75715e">/**
</span><span style="color:#75715e">* 解释：
</span><span style="color:#75715e">*/</span>
<span style="color:#f92672">package</span> TestMultiThreads<span style="color:#f92672">;</span>

<span style="color:#75715e">/**
</span><span style="color:#75715e">* @author 叶昭良
</span><span style="color:#75715e">* @time 2015年3月18日下午9:54:48
</span><span style="color:#75715e">* @version TestMultiThreadsTestProducerCustomer V1.0
</span><span style="color:#75715e">* 功能： 
</span><span style="color:#75715e">步骤：
</span><span style="color:#75715e">* 注意：
</span><span style="color:#75715e">* 掌握：
</span><span style="color:#75715e">思考：
</span><span style="color:#75715e">* 回顾：
</span><span style="color:#75715e">*/</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">TestProducerCustomer</span>
<span style="color:#f92672">{</span>

<span style="color:#75715e">/**
</span><span style="color:#75715e">* @param args 
</span><span style="color:#75715e">* 原因：
</span><span style="color:#75715e">* 解决：
</span><span style="color:#75715e">* 功能：
</span><span style="color:#75715e">* 思考： 
</span><span style="color:#75715e">* 步骤：
</span><span style="color:#75715e">*/</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">main</span><span style="color:#f92672">(</span>String<span style="color:#f92672">[</span><span style="color:#f92672">]</span> args<span style="color:#f92672">)</span>
<span style="color:#f92672">{</span>
<span style="color:#75715e">// TODO Auto-generated method stub
</span><span style="color:#75715e"></span>SynStack ss <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> SynStack<span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
Producer pro <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Producer<span style="color:#f92672">(</span>ss<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
Customer custom <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Customer<span style="color:#f92672">(</span>ss<span style="color:#f92672">)</span><span style="color:#f92672">;</span>

<span style="color:#75715e">//Thread tt = new Thread();
</span><span style="color:#75715e"></span><span style="color:#75715e">/*        pro.run();
</span><span style="color:#75715e">custom.run();*/</span>

Thread t1 <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Thread<span style="color:#f92672">(</span>pro<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
t1<span style="color:#f92672">.</span><span style="color:#a6e22e">start</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
Thread t2 <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Thread<span style="color:#f92672">(</span>custom<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
t2<span style="color:#f92672">.</span><span style="color:#a6e22e">start</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>

<span style="color:#f92672">}</span>

<span style="color:#f92672">}</span>


<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">SynStack</span>
<span style="color:#f92672">{</span>
<span style="color:#66d9ef">private</span> <span style="color:#66d9ef">char</span><span style="color:#f92672">[</span><span style="color:#f92672">]</span> ss <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#66d9ef">char</span><span style="color:#f92672">[</span>6<span style="color:#f92672">]</span><span style="color:#f92672">;</span>
<span style="color:#75715e">//private static int count = 0;
</span><span style="color:#75715e"></span><span style="color:#66d9ef">private</span> <span style="color:#66d9ef">int</span> count <span style="color:#f92672">=</span> 0<span style="color:#f92672">;</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">synchronized</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">push</span><span style="color:#f92672">(</span><span style="color:#66d9ef">char</span> c<span style="color:#f92672">)</span>
<span style="color:#f92672">{</span>
<span style="color:#66d9ef">try</span>
<span style="color:#f92672">{</span>
Thread<span style="color:#f92672">.</span><span style="color:#a6e22e">sleep</span><span style="color:#f92672">(</span>500<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
<span style="color:#f92672">}</span> <span style="color:#66d9ef">catch</span> <span style="color:#f92672">(</span>InterruptedException e1<span style="color:#f92672">)</span>
<span style="color:#f92672">{</span>
<span style="color:#75715e">// TODO Auto-generated catch block
</span><span style="color:#75715e"></span>e1<span style="color:#f92672">.</span><span style="color:#a6e22e">printStackTrace</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
<span style="color:#f92672">}</span>
<span style="color:#75715e">//if(count == ss.length)
</span><span style="color:#75715e"></span><span style="color:#66d9ef">while</span><span style="color:#f92672">(</span>count <span style="color:#f92672">=</span><span style="color:#f92672">=</span> ss<span style="color:#f92672">.</span><span style="color:#a6e22e">length</span><span style="color:#f92672">)</span>
<span style="color:#f92672">{</span>
<span style="color:#66d9ef">try</span>
<span style="color:#f92672">{</span>
System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;生产已达上限，再生产容易造成供需不平衡&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
<span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">wait</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
<span style="color:#f92672">}</span> <span style="color:#66d9ef">catch</span> <span style="color:#f92672">(</span>InterruptedException e<span style="color:#f92672">)</span>
<span style="color:#f92672">{</span>
<span style="color:#75715e">// TODO Auto-generated catch block
</span><span style="color:#75715e"></span>e<span style="color:#f92672">.</span><span style="color:#a6e22e">printStackTrace</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
<span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
<span style="color:#75715e">/*        if(count == 3)
</span><span style="color:#75715e">{
</span><span style="color:#75715e">this.notify(); //如果达到3的时候通知他们进行生产
</span><span style="color:#75715e">}*/</span>
<span style="color:#66d9ef">if</span><span style="color:#f92672">(</span>count <span style="color:#f92672">&gt;</span> 1<span style="color:#f92672">)</span>
<span style="color:#f92672">{</span>
System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span>count<span style="color:#f92672">+</span><span style="color:#e6db74">&#34;大家可以来消费了&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
<span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">notify</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span> <span style="color:#75715e">//一有则通知大家进行消费
</span><span style="color:#75715e"></span><span style="color:#f92672">}</span>


System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">printf</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;It generates %d product.It is %c\n&#34;</span><span style="color:#f92672">,</span>count<span style="color:#f92672">,</span>c<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
ss<span style="color:#f92672">[</span>count<span style="color:#f92672">]</span> <span style="color:#f92672">=</span> c<span style="color:#f92672">;</span>
count<span style="color:#f92672">+</span><span style="color:#f92672">+</span><span style="color:#f92672">;</span>
<span style="color:#f92672">}</span>
<span style="color:#75715e">//synchronized 如果不加，则报错
</span><span style="color:#75715e"></span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">synchronized</span> <span style="color:#66d9ef">char</span> <span style="color:#a6e22e">pop</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span>
<span style="color:#f92672">{</span>
<span style="color:#66d9ef">try</span>
<span style="color:#f92672">{</span>
Thread<span style="color:#f92672">.</span><span style="color:#a6e22e">sleep</span><span style="color:#f92672">(</span>100<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
<span style="color:#f92672">}</span> <span style="color:#66d9ef">catch</span> <span style="color:#f92672">(</span>InterruptedException e1<span style="color:#f92672">)</span>
<span style="color:#f92672">{</span>
<span style="color:#75715e">// TODO Auto-generated catch block
</span><span style="color:#75715e"></span>e1<span style="color:#f92672">.</span><span style="color:#a6e22e">printStackTrace</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
<span style="color:#f92672">}</span>
<span style="color:#75715e">//if(count == 0)
</span><span style="color:#75715e"></span><span style="color:#66d9ef">while</span><span style="color:#f92672">(</span>count <span style="color:#f92672">=</span><span style="color:#f92672">=</span> 0<span style="color:#f92672">)</span>
<span style="color:#f92672">{</span>
<span style="color:#75715e">//this.notify();//通知push线程进行生产
</span><span style="color:#75715e"></span><span style="color:#66d9ef">try</span>
<span style="color:#f92672">{</span>
System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;产品已售空，请联系生产商&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
<span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">wait</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
<span style="color:#f92672">}</span> <span style="color:#66d9ef">catch</span> <span style="color:#f92672">(</span>InterruptedException e<span style="color:#f92672">)</span>
<span style="color:#f92672">{</span>
<span style="color:#75715e">// TODO Auto-generated catch block
</span><span style="color:#75715e"></span>e<span style="color:#f92672">.</span><span style="color:#a6e22e">printStackTrace</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
<span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
<span style="color:#66d9ef">if</span><span style="color:#f92672">(</span>count <span style="color:#f92672">=</span><span style="color:#f92672">=</span> 3<span style="color:#f92672">)</span>
<span style="color:#f92672">{</span>
System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;该督促生产了，并且可以继续销售&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
<span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">notify</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span> <span style="color:#75715e">//如果达到3的时候通知他们进行生产（push）
</span><span style="color:#75715e"></span>
<span style="color:#f92672">}</span>
<span style="color:#75715e">//this.notify();
</span><span style="color:#75715e"></span>
count<span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">;</span>
<span style="color:#75715e">//必须放在count--之后 才可以调用ss[count]
</span><span style="color:#75715e"></span>System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">printf</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;It ate %d product.It is %c\n&#34;</span><span style="color:#f92672">,</span>count<span style="color:#f92672">,</span>ss<span style="color:#f92672">[</span>count<span style="color:#f92672">]</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
<span style="color:#66d9ef">return</span> ss<span style="color:#f92672">[</span>count<span style="color:#f92672">]</span><span style="color:#f92672">;</span>

<span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>

<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Producer</span> <span style="color:#66d9ef">implements</span> Runnable
<span style="color:#f92672">{</span>
<span style="color:#66d9ef">private</span> SynStack ss <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>

<span style="color:#66d9ef">public</span> <span style="color:#a6e22e">Producer</span><span style="color:#f92672">(</span>SynStack ss<span style="color:#f92672">)</span>
<span style="color:#f92672">{</span>
<span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">ss</span> <span style="color:#f92672">=</span>ss<span style="color:#f92672">;</span>
<span style="color:#f92672">}</span>
<span style="color:#a6e22e">@Override</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">run</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span>        
<span style="color:#f92672">{</span>
<span style="color:#75715e">// TODO Auto-generated method stub
</span><span style="color:#75715e"></span><span style="color:#75715e">//        ss.push(&#39;a&#39;);
</span><span style="color:#75715e"></span><span style="color:#75715e">/*        try
</span><span style="color:#75715e">{
</span><span style="color:#75715e">Thread.sleep(1000);
</span><span style="color:#75715e">} catch (InterruptedException e)
</span><span style="color:#75715e">{
</span><span style="color:#75715e">// TODO Auto-generated catch block
</span><span style="color:#75715e">e.printStackTrace();
</span><span style="color:#75715e">}*/</span>
<span style="color:#66d9ef">char</span> ch <span style="color:#f92672">;</span>
<span style="color:#66d9ef">for</span><span style="color:#f92672">(</span><span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span>0 <span style="color:#f92672">;</span> i <span style="color:#f92672">&lt;</span> 20 <span style="color:#f92672">;</span> i<span style="color:#f92672">+</span><span style="color:#f92672">+</span><span style="color:#f92672">)</span>
<span style="color:#f92672">{</span>
ch <span style="color:#f92672">=</span> <span style="color:#f92672">(</span><span style="color:#66d9ef">char</span><span style="color:#f92672">)</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#39;a&#39;</span><span style="color:#f92672">+</span>i<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
ss<span style="color:#f92672">.</span><span style="color:#a6e22e">push</span><span style="color:#f92672">(</span>ch<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
<span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>

<span style="color:#f92672">}</span>
<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Customer</span> <span style="color:#66d9ef">implements</span> Runnable
<span style="color:#f92672">{</span>
<span style="color:#66d9ef">private</span> SynStack ss <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
<span style="color:#66d9ef">public</span> <span style="color:#a6e22e">Customer</span><span style="color:#f92672">(</span>SynStack ss<span style="color:#f92672">)</span>
<span style="color:#f92672">{</span>
<span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">ss</span> <span style="color:#f92672">=</span> ss<span style="color:#f92672">;</span>
<span style="color:#f92672">}</span>
<span style="color:#a6e22e">@Override</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">run</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span>
<span style="color:#f92672">{</span>

<span style="color:#75715e">// TODO Auto-generated method stub
</span><span style="color:#75715e"></span><span style="color:#75715e">//        System.out.println(ss.pop());
</span><span style="color:#75715e"></span><span style="color:#75715e">/*        try
</span><span style="color:#75715e">{
</span><span style="color:#75715e">Thread.sleep(1000);
</span><span style="color:#75715e">} catch (InterruptedException e)
</span><span style="color:#75715e">{
</span><span style="color:#75715e">// TODO Auto-generated catch block
</span><span style="color:#75715e">e.printStackTrace();
</span><span style="color:#75715e">}*/</span>
<span style="color:#66d9ef">for</span><span style="color:#f92672">(</span><span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> 0<span style="color:#f92672">;</span> i <span style="color:#f92672">&lt;</span> 20 <span style="color:#f92672">;</span> i<span style="color:#f92672">+</span><span style="color:#f92672">+</span><span style="color:#f92672">)</span>
<span style="color:#f92672">{</span>
System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span>ss<span style="color:#f92672">.</span><span style="color:#a6e22e">pop</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
<span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><p>结果：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">It generates 0 product<span style="color:#f92672">.</span><span style="color:#a6e22e">It</span> is a
It generates 1 product<span style="color:#f92672">.</span><span style="color:#a6e22e">It</span> is b
2大家可以来消费了
It generates 2 product<span style="color:#f92672">.</span><span style="color:#a6e22e">It</span> is c
该督促生产了<span style="color:#960050;background-color:#1e0010">，</span>并且可以继续销售
It ate 2 product<span style="color:#f92672">.</span><span style="color:#a6e22e">It</span> is c
c
2大家可以来消费了
It generates 2 product<span style="color:#f92672">.</span><span style="color:#a6e22e">It</span> is d
该督促生产了<span style="color:#960050;background-color:#1e0010">，</span>并且可以继续销售
It ate 2 product<span style="color:#f92672">.</span><span style="color:#a6e22e">It</span> is d
d
It ate 1 product<span style="color:#f92672">.</span><span style="color:#a6e22e">It</span> is b
b
It generates 1 product<span style="color:#f92672">.</span><span style="color:#a6e22e">It</span> is e
It ate 1 product<span style="color:#f92672">.</span><span style="color:#a6e22e">It</span> is e
e
It generates 1 product<span style="color:#f92672">.</span><span style="color:#a6e22e">It</span> is f
2大家可以来消费了
It generates 2 product<span style="color:#f92672">.</span><span style="color:#a6e22e">It</span> is g
该督促生产了<span style="color:#960050;background-color:#1e0010">，</span>并且可以继续销售
It ate 2 product<span style="color:#f92672">.</span><span style="color:#a6e22e">It</span> is g
g
2大家可以来消费了
It generates 2 product<span style="color:#f92672">.</span><span style="color:#a6e22e">It</span> is h
3大家可以来消费了
It generates 3 product<span style="color:#f92672">.</span><span style="color:#a6e22e">It</span> is i
It ate 3 product<span style="color:#f92672">.</span><span style="color:#a6e22e">It</span> is i
i
3大家可以来消费了
It generates 3 product<span style="color:#f92672">.</span><span style="color:#a6e22e">It</span> is j
4大家可以来消费了
It generates 4 product<span style="color:#f92672">.</span><span style="color:#a6e22e">It</span> is k
5大家可以来消费了
It generates 5 product<span style="color:#f92672">.</span><span style="color:#a6e22e">It</span> is l
生产已达上限<span style="color:#960050;background-color:#1e0010">，</span>再生产容易造成供需不平衡
It ate 5 product<span style="color:#f92672">.</span><span style="color:#a6e22e">It</span> is l
l
It ate 4 product<span style="color:#f92672">.</span><span style="color:#a6e22e">It</span> is k
k
It ate 3 product<span style="color:#f92672">.</span><span style="color:#a6e22e">It</span> is j
j
该督促生产了<span style="color:#960050;background-color:#1e0010">，</span>并且可以继续销售
It ate 2 product<span style="color:#f92672">.</span><span style="color:#a6e22e">It</span> is h
2大家可以来消费了
It generates 2 product<span style="color:#f92672">.</span><span style="color:#a6e22e">It</span> is m
h
3大家可以来消费了
It generates 3 product<span style="color:#f92672">.</span><span style="color:#a6e22e">It</span> is n
It ate 3 product<span style="color:#f92672">.</span><span style="color:#a6e22e">It</span> is n
n
3大家可以来消费了
It generates 3 product<span style="color:#f92672">.</span><span style="color:#a6e22e">It</span> is o
It ate 3 product<span style="color:#f92672">.</span><span style="color:#a6e22e">It</span> is o
o
3大家可以来消费了
It generates 3 product<span style="color:#f92672">.</span><span style="color:#a6e22e">It</span> is p
4大家可以来消费了
It generates 4 product<span style="color:#f92672">.</span><span style="color:#a6e22e">It</span> is q
It ate 4 product<span style="color:#f92672">.</span><span style="color:#a6e22e">It</span> is q
q
4大家可以来消费了
It generates 4 product<span style="color:#f92672">.</span><span style="color:#a6e22e">It</span> is r
It ate 4 product<span style="color:#f92672">.</span><span style="color:#a6e22e">It</span> is r
r
4大家可以来消费了
It generates 4 product<span style="color:#f92672">.</span><span style="color:#a6e22e">It</span> is s
5大家可以来消费了
It generates 5 product<span style="color:#f92672">.</span><span style="color:#a6e22e">It</span> is t
It ate 5 product<span style="color:#f92672">.</span><span style="color:#a6e22e">It</span> is t
t
It ate 4 product<span style="color:#f92672">.</span><span style="color:#a6e22e">It</span> is s
s
It ate 3 product<span style="color:#f92672">.</span><span style="color:#a6e22e">It</span> is p
p
该督促生产了<span style="color:#960050;background-color:#1e0010">，</span>并且可以继续销售
It ate 2 product<span style="color:#f92672">.</span><span style="color:#a6e22e">It</span> is m
m
It ate 1 product<span style="color:#f92672">.</span><span style="color:#a6e22e">It</span> is f
f
It ate 0 product<span style="color:#f92672">.</span><span style="color:#a6e22e">It</span> is a
a


</code></pre></div><p>注意：至于notify放置在代码的哪个地方，有待进一步的比较。</p>
<p>5.网络编程</p>
<p>一个网络程序需要考虑协议，IP，端口号。</p>
<p>协议：
用于网络传输的规则、准则。在不同的计算机传输层中（7层架构） 有不同的数据包，
不同
层封包的不同方法</p>
<p>IP:  唯一标识互联网中的计算机
端口号：qq有自己的端口  mysql的3306端口   smtp的23端口等</p>
<p>协议分为UDP,TCP
UDP的特点：无需等待对方确认，比如写信 有可能收不到。
TCP的特点：需要等待 对方连接，比如QQ视频聊天，打电话。三重连接</p>
<p>UDP编程：
知识点：
DatagramSocket 是一艘轮船（传递数据包）
DatagramPacket 是一个轮船上的货物（获取数据包）</p>
<p>ByteArrayInputStream and  DataInputStream 用于打包港口货物
ByteArrayOutputStream and  DataOutputStream 也用于打包港口货物</p>
<p>案例1：简单实现一个UDP的传输过程，服务器开启，客户端发送数据（暂时未实现服务器的发送  客户端的接受，实现简单，dos对应的dis  dis对应的dos)
Server:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#75715e">/**
</span><span style="color:#75715e">* 解释：
</span><span style="color:#75715e">*/</span>
<span style="color:#f92672">package</span> TestNetwork<span style="color:#f92672">;</span>

<span style="color:#f92672">import</span> java.io.ByteArrayInputStream<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.io.DataInputStream<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.io.IOException<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.net.DatagramPacket<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.net.DatagramSocket<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.net.SocketException<span style="color:#f92672">;</span>

<span style="color:#75715e">/**
</span><span style="color:#75715e">* @author 叶昭良
</span><span style="color:#75715e">* @time 2015年3月19日下午1:49:36
</span><span style="color:#75715e">* @version TestNetworkTestDatagramSocket V1.0
</span><span style="color:#75715e">* 功能： 测试UDP
</span><span style="color:#75715e">步骤：
</span><span style="color:#75715e">* 注意：
</span><span style="color:#75715e">* 掌握：
</span><span style="color:#75715e">思考：
</span><span style="color:#75715e">* 回顾：
</span><span style="color:#75715e">*/</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">TestDatagramSocket</span>
<span style="color:#f92672">{</span>

<span style="color:#75715e">/**
</span><span style="color:#75715e">* @param args 
</span><span style="color:#75715e">* 原因：
</span><span style="color:#75715e">* 解决：
</span><span style="color:#75715e">* 功能：
</span><span style="color:#75715e">* 思考： 
</span><span style="color:#75715e">* 步骤：
</span><span style="color:#75715e">*/</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">main</span><span style="color:#f92672">(</span>String<span style="color:#f92672">[</span><span style="color:#f92672">]</span> args<span style="color:#f92672">)</span>
<span style="color:#f92672">{</span>
<span style="color:#75715e">// TODO Auto-generated method stub
</span><span style="color:#75715e"></span>DatagramSocket ds <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
DatagramPacket dp <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>

<span style="color:#66d9ef">try</span>
<span style="color:#f92672">{</span>
ds <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> DatagramSocket<span style="color:#f92672">(</span>5566<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
<span style="color:#66d9ef">byte</span><span style="color:#f92672">[</span><span style="color:#f92672">]</span> apple <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#66d9ef">byte</span><span style="color:#f92672">[</span>1025<span style="color:#f92672">]</span><span style="color:#f92672">;</span>
<span style="color:#75715e">/*for(int i =0 ; i &lt; 20; i++)
</span><span style="color:#75715e">{
</span><span style="color:#75715e">apple = (byte) ((byte)&#39;a&#39;+i);
</span><span style="color:#75715e">}*/</span>
dp <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> DatagramPacket<span style="color:#f92672">(</span>apple<span style="color:#f92672">,</span> apple<span style="color:#f92672">.</span><span style="color:#a6e22e">length</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
<span style="color:#66d9ef">while</span><span style="color:#f92672">(</span><span style="color:#66d9ef">true</span><span style="color:#f92672">)</span>
<span style="color:#f92672">{</span>
<span style="color:#66d9ef">try</span>
<span style="color:#f92672">{</span>
ds<span style="color:#f92672">.</span><span style="color:#a6e22e">receive</span><span style="color:#f92672">(</span>dp<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
ByteArrayInputStream bais <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> ByteArrayInputStream<span style="color:#f92672">(</span>dp<span style="color:#f92672">.</span><span style="color:#a6e22e">getData</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
DataInputStream dis <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> DataInputStream<span style="color:#f92672">(</span>bais<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span>dis<span style="color:#f92672">.</span><span style="color:#a6e22e">readLong</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>

<span style="color:#f92672">}</span> <span style="color:#66d9ef">catch</span> <span style="color:#f92672">(</span>IOException e<span style="color:#f92672">)</span>
<span style="color:#f92672">{</span>
<span style="color:#75715e">// TODO Auto-generated catch block
</span><span style="color:#75715e"></span>e<span style="color:#f92672">.</span><span style="color:#a6e22e">printStackTrace</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
<span style="color:#f92672">}</span>

<span style="color:#f92672">}</span>
<span style="color:#f92672">}</span> <span style="color:#66d9ef">catch</span> <span style="color:#f92672">(</span>SocketException e<span style="color:#f92672">)</span>
<span style="color:#f92672">{</span>
<span style="color:#75715e">// TODO Auto-generated catch block
</span><span style="color:#75715e"></span>e<span style="color:#f92672">.</span><span style="color:#a6e22e">printStackTrace</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
<span style="color:#f92672">}</span>

<span style="color:#f92672">}</span>

<span style="color:#f92672">}</span>
</code></pre></div><p>Client</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#75715e">/**
</span><span style="color:#75715e">* 解释：
</span><span style="color:#75715e">*/</span>
<span style="color:#f92672">package</span> TestNetwork<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.io.*<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.net.*<span style="color:#f92672">;</span>
<span style="color:#75715e">/**
</span><span style="color:#75715e">* @author 叶昭良
</span><span style="color:#75715e">* @time 2015年3月21日上午1:39:22
</span><span style="color:#75715e">* @version TestNetworkTestDatagramClient V1.0
</span><span style="color:#75715e">* 功能： 
</span><span style="color:#75715e">步骤：
</span><span style="color:#75715e">* 注意：
</span><span style="color:#75715e">* 掌握：
</span><span style="color:#75715e">思考：
</span><span style="color:#75715e">* 回顾：
</span><span style="color:#75715e">*/</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">TestDatagramClient</span>
<span style="color:#f92672">{</span>

<span style="color:#75715e">/**
</span><span style="color:#75715e">* @param args 
</span><span style="color:#75715e">* 原因：
</span><span style="color:#75715e">* 解决：
</span><span style="color:#75715e">* 功能：
</span><span style="color:#75715e">* 思考： 
</span><span style="color:#75715e">* 步骤：
</span><span style="color:#75715e">*/</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">main</span><span style="color:#f92672">(</span>String<span style="color:#f92672">[</span><span style="color:#f92672">]</span> args<span style="color:#f92672">)</span>
<span style="color:#f92672">{</span>
<span style="color:#75715e">// TODO Auto-generated method stub
</span><span style="color:#75715e"></span>DatagramSocket ds <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
DatagramPacket dp <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
<span style="color:#66d9ef">try</span>
<span style="color:#f92672">{</span>
ds <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> DatagramSocket<span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
<span style="color:#66d9ef">long</span> m <span style="color:#f92672">=</span> 1000l<span style="color:#f92672">;</span>
ByteArrayOutputStream baos <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> ByteArrayOutputStream<span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
DataOutputStream dos <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> DataOutputStream<span style="color:#f92672">(</span>baos<span style="color:#f92672">)</span><span style="color:#f92672">;</span>

dos<span style="color:#f92672">.</span><span style="color:#a6e22e">writeLong</span><span style="color:#f92672">(</span>m<span style="color:#f92672">)</span><span style="color:#f92672">;</span>

<span style="color:#66d9ef">byte</span><span style="color:#f92672">[</span><span style="color:#f92672">]</span> apple <span style="color:#f92672">=</span> baos<span style="color:#f92672">.</span><span style="color:#a6e22e">toByteArray</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
dp <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> DatagramPacket<span style="color:#f92672">(</span>apple<span style="color:#f92672">,</span> apple<span style="color:#f92672">.</span><span style="color:#a6e22e">length</span><span style="color:#f92672">,</span><span style="color:#66d9ef">new</span>
InetSocketAddress<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;127.0.0.1&#34;</span><span style="color:#f92672">,</span>5566<span style="color:#f92672">)</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
ds<span style="color:#f92672">.</span><span style="color:#a6e22e">send</span><span style="color:#f92672">(</span>dp<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
<span style="color:#f92672">}</span><span style="color:#66d9ef">catch</span><span style="color:#f92672">(</span>IOException e<span style="color:#f92672">)</span>
<span style="color:#f92672">{</span>

<span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>

<span style="color:#f92672">}</span>
</code></pre></div><p>结果：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">先开启Server<span style="color:#f92672">,</span>再运行Client
1000
</code></pre></div><p>TCP编程：
知识点：
1.通过ServerSocket产生一个运行的所需的端口号
2.利用Socket进行编程，Socket源自于unix操作系统</p>
<p>案例1： 模拟UDP的类似程序，即服务器端等待数据 进行读取   客户端发送数据</p>
<p>Server:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#75715e">/**
</span><span style="color:#75715e">* 解释：
</span><span style="color:#75715e">*/</span>
<span style="color:#f92672">package</span> TestNetwork<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.io.*<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.net.*<span style="color:#f92672">;</span>
<span style="color:#75715e">/**
</span><span style="color:#75715e">* @author 叶昭良
</span><span style="color:#75715e">* @time 2015年3月19日下午2:30:08
</span><span style="color:#75715e">* @version TestNetworkTestServer1 V1.0
</span><span style="color:#75715e">* 功能： 
</span><span style="color:#75715e">步骤：
</span><span style="color:#75715e">* 注意：
</span><span style="color:#75715e">* 掌握：
</span><span style="color:#75715e">思考：
</span><span style="color:#75715e">* 回顾：
</span><span style="color:#75715e">*/</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">TestServer1</span>
<span style="color:#f92672">{</span>

<span style="color:#75715e">/**
</span><span style="color:#75715e">* @param args 
</span><span style="color:#75715e">* 原因：
</span><span style="color:#75715e">* 解决：
</span><span style="color:#75715e">* 功能：
</span><span style="color:#75715e">* 思考： 
</span><span style="color:#75715e">* 步骤：
</span><span style="color:#75715e">*/</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">main</span><span style="color:#f92672">(</span>String<span style="color:#f92672">[</span><span style="color:#f92672">]</span> args<span style="color:#f92672">)</span>
<span style="color:#f92672">{</span>
<span style="color:#75715e">// TODO Auto-generated method stub
</span><span style="color:#75715e"></span><span style="color:#66d9ef">try</span>
<span style="color:#f92672">{</span>
ServerSocket ss <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> ServerSocket<span style="color:#f92672">(</span>5566<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
<span style="color:#66d9ef">while</span><span style="color:#f92672">(</span><span style="color:#66d9ef">true</span><span style="color:#f92672">)</span>
<span style="color:#f92672">{</span>
Socket s1 <span style="color:#f92672">=</span>ss<span style="color:#f92672">.</span><span style="color:#a6e22e">accept</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
DataInputStream dis <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> DataInputStream<span style="color:#f92672">(</span>s1<span style="color:#f92672">.</span><span style="color:#a6e22e">getInputStream</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span>dis<span style="color:#f92672">.</span><span style="color:#a6e22e">readUTF</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
dis<span style="color:#f92672">.</span><span style="color:#a6e22e">close</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
<span style="color:#f92672">}</span>
<span style="color:#f92672">}</span> <span style="color:#66d9ef">catch</span> <span style="color:#f92672">(</span>IOException e<span style="color:#f92672">)</span>
<span style="color:#f92672">{</span>
<span style="color:#75715e">// TODO Auto-generated catch block
</span><span style="color:#75715e"></span>e<span style="color:#f92672">.</span><span style="color:#a6e22e">printStackTrace</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
<span style="color:#f92672">}</span>

<span style="color:#f92672">}</span>

<span style="color:#f92672">}</span>
</code></pre></div><p>Client:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#75715e">/**
</span><span style="color:#75715e">* 解释：
</span><span style="color:#75715e">*/</span>
<span style="color:#f92672">package</span> TestNetwork<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.io.*<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.net.*<span style="color:#f92672">;</span>
<span style="color:#75715e">/**
</span><span style="color:#75715e">* @author 叶昭良
</span><span style="color:#75715e">* @time 2015年3月19日下午2:30:23
</span><span style="color:#75715e">* @version TestNetworkTestClient1 V1.0
</span><span style="color:#75715e">* 功能： 
</span><span style="color:#75715e">步骤：
</span><span style="color:#75715e">* 注意：
</span><span style="color:#75715e">* 掌握：
</span><span style="color:#75715e">思考：
</span><span style="color:#75715e">* 回顾：
</span><span style="color:#75715e">*/</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">TestClient1</span>
<span style="color:#f92672">{</span>

<span style="color:#75715e">/**
</span><span style="color:#75715e">* @param args 
</span><span style="color:#75715e">* 原因：
</span><span style="color:#75715e">* 解决：
</span><span style="color:#75715e">* 功能：
</span><span style="color:#75715e">* 思考： 
</span><span style="color:#75715e">* 步骤：
</span><span style="color:#75715e">*/</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">main</span><span style="color:#f92672">(</span>String<span style="color:#f92672">[</span><span style="color:#f92672">]</span> args<span style="color:#f92672">)</span>
<span style="color:#f92672">{</span>
<span style="color:#75715e">// TODO Auto-generated method stub
</span><span style="color:#75715e"></span>Socket s1 <span style="color:#f92672">=</span><span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
OutputStream os <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
DataOutputStream dos <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
<span style="color:#66d9ef">try</span>
<span style="color:#f92672">{</span>
s1 <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Socket<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;127.0.0.1&#34;</span><span style="color:#f92672">,</span>5566<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
os <span style="color:#f92672">=</span> s1<span style="color:#f92672">.</span><span style="color:#a6e22e">getOutputStream</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
dos <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> DataOutputStream<span style="color:#f92672">(</span>os<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
dos<span style="color:#f92672">.</span><span style="color:#a6e22e">writeUTF</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;I am coming ,Sir&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
dos<span style="color:#f92672">.</span><span style="color:#a6e22e">flush</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>


<span style="color:#f92672">}</span> <span style="color:#66d9ef">catch</span> <span style="color:#f92672">(</span>IOException e<span style="color:#f92672">)</span>
<span style="color:#f92672">{</span>
<span style="color:#75715e">// TODO Auto-generated catch block
</span><span style="color:#75715e"></span>e<span style="color:#f92672">.</span><span style="color:#a6e22e">printStackTrace</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
<span style="color:#f92672">}</span><span style="color:#66d9ef">finally</span>
<span style="color:#f92672">{</span>
<span style="color:#66d9ef">try</span>
<span style="color:#f92672">{</span>
dos<span style="color:#f92672">.</span><span style="color:#a6e22e">close</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
os<span style="color:#f92672">.</span><span style="color:#a6e22e">close</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
s1<span style="color:#f92672">.</span><span style="color:#a6e22e">close</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
<span style="color:#f92672">}</span> <span style="color:#66d9ef">catch</span> <span style="color:#f92672">(</span>IOException e<span style="color:#f92672">)</span>
<span style="color:#f92672">{</span>
<span style="color:#75715e">// TODO Auto-generated catch block
</span><span style="color:#75715e"></span>e<span style="color:#f92672">.</span><span style="color:#a6e22e">printStackTrace</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
<span style="color:#f92672">}</span>

<span style="color:#f92672">}</span>

<span style="color:#f92672">}</span>

<span style="color:#f92672">}</span>
</code></pre></div><p>案例2：改进案例1  是的服务器端也能够发送  客户端也能接受数据</p>
<p>Server:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">
<span style="color:#f92672">&lt;</span>font size<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;3&#34;</span><span style="color:#f92672">&gt;</span><span style="color:#75715e">/**
</span><span style="color:#75715e">* 解释：
</span><span style="color:#75715e">*/</span>
<span style="color:#f92672">package</span> TestNetwork<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.io.*<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.net.*<span style="color:#f92672">;</span>
<span style="color:#75715e">/**
</span><span style="color:#75715e">* @author 叶昭良
</span><span style="color:#75715e">* @time 2015年3月19日下午2:38:37
</span><span style="color:#75715e">* @version TestNetworkTestServer2 V1.0
</span><span style="color:#75715e">* 功能： 
</span><span style="color:#75715e">步骤：
</span><span style="color:#75715e">* 注意：
</span><span style="color:#75715e">* 掌握：
</span><span style="color:#75715e">思考：
</span><span style="color:#75715e">* 回顾：
</span><span style="color:#75715e">*/</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">TestServer2</span>
<span style="color:#f92672">{</span>

<span style="color:#75715e">/**
</span><span style="color:#75715e">* @param args 
</span><span style="color:#75715e">* 原因：
</span><span style="color:#75715e">* 解决：
</span><span style="color:#75715e">* 功能：
</span><span style="color:#75715e">* 思考： 
</span><span style="color:#75715e">* 步骤：
</span><span style="color:#75715e">*/</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">main</span><span style="color:#f92672">(</span>String<span style="color:#f92672">[</span><span style="color:#f92672">]</span> args<span style="color:#f92672">)</span>
<span style="color:#f92672">{</span>
<span style="color:#75715e">// TODO Auto-generated method stub
</span><span style="color:#75715e"></span>Socket s1 <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span> <span style="color:#f92672">;</span>
DataOutputStream dos <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
DataInputStream dis <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
BufferedReader br <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
<span style="color:#66d9ef">try</span>
<span style="color:#f92672">{</span>
ServerSocket ss <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> ServerSocket<span style="color:#f92672">(</span>5566<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
s1 <span style="color:#f92672">=</span> ss<span style="color:#f92672">.</span><span style="color:#a6e22e">accept</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>

dis <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> DataInputStream<span style="color:#f92672">(</span>s1<span style="color:#f92672">.</span><span style="color:#a6e22e">getInputStream</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
dos <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> DataOutputStream<span style="color:#f92672">(</span>s1<span style="color:#f92672">.</span><span style="color:#a6e22e">getOutputStream</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
br <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> BufferedReader<span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> InputStreamReader<span style="color:#f92672">(</span>System<span style="color:#f92672">.</span><span style="color:#a6e22e">in</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>

<span style="color:#66d9ef">while</span><span style="color:#f92672">(</span><span style="color:#66d9ef">true</span><span style="color:#f92672">)</span>
<span style="color:#f92672">{</span>
String apple <span style="color:#f92672">=</span> dis<span style="color:#f92672">.</span><span style="color:#a6e22e">readUTF</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;客户端：&#34;</span><span style="color:#f92672">+</span>dis<span style="color:#f92672">.</span><span style="color:#a6e22e">readUTF</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
<span style="color:#66d9ef">if</span><span style="color:#f92672">(</span>apple<span style="color:#f92672">.</span><span style="color:#a6e22e">equals</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;bye&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span>
<span style="color:#f92672">{</span>
<span style="color:#66d9ef">break</span><span style="color:#f92672">;</span>
<span style="color:#f92672">}</span>
apple <span style="color:#f92672">=</span> br<span style="color:#f92672">.</span><span style="color:#a6e22e">readLine</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
dos<span style="color:#f92672">.</span><span style="color:#a6e22e">writeUTF</span><span style="color:#f92672">(</span>apple<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
<span style="color:#f92672">}</span>
<span style="color:#f92672">}</span> <span style="color:#66d9ef">catch</span> <span style="color:#f92672">(</span>IOException e<span style="color:#f92672">)</span>
<span style="color:#f92672">{</span>
<span style="color:#75715e">// TODO Auto-generated catch block
</span><span style="color:#75715e"></span>e<span style="color:#f92672">.</span><span style="color:#a6e22e">printStackTrace</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
<span style="color:#f92672">}</span><span style="color:#66d9ef">finally</span>
<span style="color:#f92672">{</span>
<span style="color:#66d9ef">try</span>
<span style="color:#f92672">{</span>
dos<span style="color:#f92672">.</span><span style="color:#a6e22e">close</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
dis<span style="color:#f92672">.</span><span style="color:#a6e22e">close</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
s1<span style="color:#f92672">.</span><span style="color:#a6e22e">close</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
<span style="color:#f92672">}</span> <span style="color:#66d9ef">catch</span> <span style="color:#f92672">(</span>IOException e<span style="color:#f92672">)</span>
<span style="color:#f92672">{</span>
<span style="color:#75715e">// TODO Auto-generated catch block
</span><span style="color:#75715e"></span>e<span style="color:#f92672">.</span><span style="color:#a6e22e">printStackTrace</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
<span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>

<span style="color:#f92672">}</span>

<span style="color:#f92672">}</span>
<span style="color:#f92672">&lt;</span><span style="color:#f92672">/</span>font<span style="color:#f92672">&gt;</span>

</code></pre></div><p>Client:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#75715e">/**
</span><span style="color:#75715e">* 解释：
</span><span style="color:#75715e">*/</span>
<span style="color:#f92672">package</span> TestNetwork<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.io.*<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.net.*<span style="color:#f92672">;</span>
<span style="color:#75715e">/**
</span><span style="color:#75715e">* @author 叶昭良
</span><span style="color:#75715e">* @time 2015年3月19日下午2:38:52
</span><span style="color:#75715e">* @version TestNetworkTestClient2 V1.0
</span><span style="color:#75715e">* 功能： 
</span><span style="color:#75715e">步骤：
</span><span style="color:#75715e">* 注意：
</span><span style="color:#75715e">* 掌握：
</span><span style="color:#75715e">思考：
</span><span style="color:#75715e">* 回顾：
</span><span style="color:#75715e">*/</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">TestClient2</span>
<span style="color:#f92672">{</span>

<span style="color:#75715e">/**
</span><span style="color:#75715e">* @param args 
</span><span style="color:#75715e">* 原因：
</span><span style="color:#75715e">* 解决：
</span><span style="color:#75715e">* 功能：
</span><span style="color:#75715e">* 思考： 
</span><span style="color:#75715e">* 步骤：
</span><span style="color:#75715e">*/</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">main</span><span style="color:#f92672">(</span>String<span style="color:#f92672">[</span><span style="color:#f92672">]</span> args<span style="color:#f92672">)</span>
<span style="color:#f92672">{</span>
<span style="color:#75715e">// TODO Auto-generated method stub
</span><span style="color:#75715e"></span>Socket s1 <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
OutputStream os <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
InputStream is <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
DataOutputStream dos <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
DataInputStream dis <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
BufferedReader br <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
<span style="color:#66d9ef">try</span>
<span style="color:#f92672">{</span>
s1 <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Socket<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;127.0.0.1&#34;</span><span style="color:#f92672">,</span>5566<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
os <span style="color:#f92672">=</span> s1<span style="color:#f92672">.</span><span style="color:#a6e22e">getOutputStream</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
is <span style="color:#f92672">=</span> s1<span style="color:#f92672">.</span><span style="color:#a6e22e">getInputStream</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
dos <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> DataOutputStream<span style="color:#f92672">(</span>os<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
dis <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> DataInputStream<span style="color:#f92672">(</span>is<span style="color:#f92672">)</span><span style="color:#f92672">;</span>

dos<span style="color:#f92672">.</span><span style="color:#a6e22e">writeUTF</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Come to the world of net server&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
dos<span style="color:#f92672">.</span><span style="color:#a6e22e">flush</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>

br <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> BufferedReader<span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> InputStreamReader<span style="color:#f92672">(</span>System<span style="color:#f92672">.</span><span style="color:#a6e22e">in</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
<span style="color:#66d9ef">while</span><span style="color:#f92672">(</span><span style="color:#66d9ef">true</span><span style="color:#f92672">)</span>
<span style="color:#f92672">{</span>
String str <span style="color:#f92672">=</span> br<span style="color:#f92672">.</span><span style="color:#a6e22e">readLine</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
dos<span style="color:#f92672">.</span><span style="color:#a6e22e">writeUTF</span><span style="color:#f92672">(</span>str<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
<span style="color:#66d9ef">if</span><span style="color:#f92672">(</span>str<span style="color:#f92672">.</span><span style="color:#a6e22e">equalsIgnoreCase</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;byebye&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span>
<span style="color:#66d9ef">break</span><span style="color:#f92672">;</span>
str <span style="color:#f92672">=</span> dis<span style="color:#f92672">.</span><span style="color:#a6e22e">readUTF</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;服务器 said that&#34;</span> <span style="color:#f92672">+</span> str<span style="color:#f92672">+</span><span style="color:#e6db74">&#34;\n&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
<span style="color:#66d9ef">if</span><span style="color:#f92672">(</span>str<span style="color:#f92672">.</span><span style="color:#a6e22e">equalsIgnoreCase</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;byebye&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span>
<span style="color:#66d9ef">break</span><span style="color:#f92672">;</span>

<span style="color:#f92672">}</span>
<span style="color:#f92672">}</span> <span style="color:#66d9ef">catch</span> <span style="color:#f92672">(</span>IOException e<span style="color:#f92672">)</span>
<span style="color:#f92672">{</span>
<span style="color:#75715e">// TODO Auto-generated catch block
</span><span style="color:#75715e"></span>e<span style="color:#f92672">.</span><span style="color:#a6e22e">printStackTrace</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
<span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>

<span style="color:#f92672">}</span>
</code></pre></div><p>结果：可以在字符界面下进行对话
客户端：hi
hi
服务器 said thathi too,smida</p>
<p>出现的问题是，无法独立的切换客户端和服务器，client接受信息后，一直存在于while循环中,于是使用了线程，让他们自己对话吧！！</p>
<p>Server的实现：
一定要注意无论是Server还是Client的实现，try&mdash;catch之后不能有finally关闭，否则异常，socket中止</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#75715e">/**
</span><span style="color:#75715e">* 解释：
</span><span style="color:#75715e">*/</span>
<span style="color:#f92672">package</span> TestNetwork<span style="color:#f92672">;</span>

<span style="color:#75715e">/**
</span><span style="color:#75715e">* @author 叶昭良
</span><span style="color:#75715e">* @time 2015年3月21日下午12:43:24
</span><span style="color:#75715e">* @version TestNetworkTestServer3 V1.0
</span><span style="color:#75715e">* 功能： 
</span><span style="color:#75715e">步骤：
</span><span style="color:#75715e">* 注意：
</span><span style="color:#75715e">* 掌握：
</span><span style="color:#75715e">思考：
</span><span style="color:#75715e">* 回顾：
</span><span style="color:#75715e">*/</span>
<span style="color:#f92672">import</span> java.io.*<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.net.*<span style="color:#f92672">;</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">TestServer3</span> <span style="color:#75715e">//throws Exception
</span><span style="color:#75715e"></span><span style="color:#f92672">{</span>

<span style="color:#75715e">/**
</span><span style="color:#75715e">* @param args 
</span><span style="color:#75715e">* 原因：
</span><span style="color:#75715e">* 解决：
</span><span style="color:#75715e">* 功能：
</span><span style="color:#75715e">* 思考： 
</span><span style="color:#75715e">* 步骤：
</span><span style="color:#75715e">*/</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">main</span><span style="color:#f92672">(</span>String<span style="color:#f92672">[</span><span style="color:#f92672">]</span> args<span style="color:#f92672">)</span> 
<span style="color:#f92672">{</span>
<span style="color:#75715e">// TODO Auto-generated method stub
</span><span style="color:#75715e"></span>ServerSocket ss <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
Socket s <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
DataOutputStream dos <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
DataInputStream dis <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
<span style="color:#66d9ef">try</span>
<span style="color:#f92672">{</span>
ss <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> ServerSocket<span style="color:#f92672">(</span>8888<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
s <span style="color:#f92672">=</span> ss<span style="color:#f92672">.</span><span style="color:#a6e22e">accept</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
dos <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> DataOutputStream<span style="color:#f92672">(</span>s<span style="color:#f92672">.</span><span style="color:#a6e22e">getOutputStream</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>

dis <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> DataInputStream<span style="color:#f92672">(</span>s<span style="color:#f92672">.</span><span style="color:#a6e22e">getInputStream</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>

<span style="color:#66d9ef">new</span> ServerRead<span style="color:#f92672">(</span>dis<span style="color:#f92672">)</span><span style="color:#f92672">.</span><span style="color:#a6e22e">start</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
<span style="color:#66d9ef">new</span> ServerWrite<span style="color:#f92672">(</span>dos<span style="color:#f92672">)</span><span style="color:#f92672">.</span><span style="color:#a6e22e">start</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
<span style="color:#f92672">}</span> <span style="color:#66d9ef">catch</span> <span style="color:#f92672">(</span>IOException e<span style="color:#f92672">)</span>
<span style="color:#f92672">{</span>
<span style="color:#75715e">// TODO Auto-generated catch block
</span><span style="color:#75715e"></span>e<span style="color:#f92672">.</span><span style="color:#a6e22e">printStackTrace</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
<span style="color:#f92672">}</span>

<span style="color:#f92672">}</span>

<span style="color:#f92672">}</span>


<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">ServerRead</span> <span style="color:#66d9ef">extends</span> Thread
<span style="color:#f92672">{</span>
<span style="color:#66d9ef">private</span> DataInputStream dis <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
<span style="color:#66d9ef">public</span> <span style="color:#a6e22e">ServerRead</span><span style="color:#f92672">(</span>DataInputStream dis<span style="color:#f92672">)</span>
<span style="color:#f92672">{</span>
<span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">dis</span> <span style="color:#f92672">=</span> dis<span style="color:#f92672">;</span>
<span style="color:#f92672">}</span>

<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">run</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span>
<span style="color:#f92672">{</span>
<span style="color:#66d9ef">while</span><span style="color:#f92672">(</span><span style="color:#66d9ef">true</span><span style="color:#f92672">)</span>
<span style="color:#f92672">{</span>
<span style="color:#66d9ef">try</span><span style="color:#f92672">{</span>
String str <span style="color:#f92672">=</span> dis<span style="color:#f92672">.</span><span style="color:#a6e22e">readUTF</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;客户端说:&#34;</span><span style="color:#f92672">+</span>str<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
<span style="color:#66d9ef">if</span><span style="color:#f92672">(</span>str<span style="color:#f92672">.</span><span style="color:#a6e22e">equalsIgnoreCase</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;byebye&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span>
<span style="color:#66d9ef">break</span><span style="color:#f92672">;</span>
<span style="color:#f92672">}</span><span style="color:#66d9ef">catch</span><span style="color:#f92672">(</span>Exception e<span style="color:#f92672">)</span>
<span style="color:#f92672">{</span>
e<span style="color:#f92672">.</span><span style="color:#a6e22e">printStackTrace</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
<span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">ServerWrite</span> <span style="color:#66d9ef">extends</span> Thread
<span style="color:#f92672">{</span>
<span style="color:#66d9ef">private</span> DataOutputStream dos <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
<span style="color:#66d9ef">public</span> <span style="color:#a6e22e">ServerWrite</span><span style="color:#f92672">(</span>DataOutputStream dos<span style="color:#f92672">)</span>
<span style="color:#f92672">{</span>
<span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">dos</span> <span style="color:#f92672">=</span> dos<span style="color:#f92672">;</span>
<span style="color:#f92672">}</span>

<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">run</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span>
<span style="color:#f92672">{</span>
BufferedReader br <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> BufferedReader<span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> InputStreamReader<span style="color:#f92672">(</span>System<span style="color:#f92672">.</span><span style="color:#a6e22e">in</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
<span style="color:#66d9ef">while</span><span style="color:#f92672">(</span><span style="color:#66d9ef">true</span><span style="color:#f92672">)</span>
<span style="color:#f92672">{</span>
<span style="color:#66d9ef">try</span><span style="color:#f92672">{</span>
String str <span style="color:#f92672">=</span> br<span style="color:#f92672">.</span><span style="color:#a6e22e">readLine</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
dos<span style="color:#f92672">.</span><span style="color:#a6e22e">writeUTF</span><span style="color:#f92672">(</span>str<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
<span style="color:#66d9ef">if</span><span style="color:#f92672">(</span>str<span style="color:#f92672">.</span><span style="color:#a6e22e">equalsIgnoreCase</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;byebye&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span>
<span style="color:#66d9ef">break</span><span style="color:#f92672">;</span>
<span style="color:#f92672">}</span><span style="color:#66d9ef">catch</span><span style="color:#f92672">(</span>Exception e<span style="color:#f92672">)</span>
<span style="color:#f92672">{</span>
e<span style="color:#f92672">.</span><span style="color:#a6e22e">printStackTrace</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
<span style="color:#f92672">}</span><span style="color:#75715e">//加入finally 关闭  dos.close()则异常。。。于是删掉Client &amp; Server的四个finally即可！！！问题解决  原因未知！！！
</span><span style="color:#75715e"></span><span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>

</code></pre></div><p>Client的实现：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#75715e">/**
</span><span style="color:#75715e">* 解释：
</span><span style="color:#75715e">*/</span>
<span style="color:#f92672">package</span> TestNetwork<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.io.*<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.net.*<span style="color:#f92672">;</span>
<span style="color:#75715e">/**
</span><span style="color:#75715e">* @author 叶昭良
</span><span style="color:#75715e">* @time 2015年3月21日下午12:47:03
</span><span style="color:#75715e">* @version TestNetworkTestClient3 V1.0
</span><span style="color:#75715e">* 功能： 
</span><span style="color:#75715e">步骤：
</span><span style="color:#75715e">* 注意：
</span><span style="color:#75715e">* 掌握：
</span><span style="color:#75715e">思考：
</span><span style="color:#75715e">* 回顾：
</span><span style="color:#75715e">*/</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">TestClient3</span>
<span style="color:#f92672">{</span>

<span style="color:#75715e">/**
</span><span style="color:#75715e">* @param args 
</span><span style="color:#75715e">* 原因：
</span><span style="color:#75715e">* 解决：
</span><span style="color:#75715e">* 功能：
</span><span style="color:#75715e">* 思考： 
</span><span style="color:#75715e">* 步骤：
</span><span style="color:#75715e">*/</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">main</span><span style="color:#f92672">(</span>String<span style="color:#f92672">[</span><span style="color:#f92672">]</span> args<span style="color:#f92672">)</span> <span style="color:#66d9ef">throws</span> Exception
<span style="color:#f92672">{</span>
<span style="color:#75715e">// TODO Auto-generated method stub
</span><span style="color:#75715e"></span>Socket s <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Socket<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;127.0.0.1&#34;</span><span style="color:#f92672">,</span>8888<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
DataOutputStream dos <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> DataOutputStream<span style="color:#f92672">(</span>s<span style="color:#f92672">.</span><span style="color:#a6e22e">getOutputStream</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>

DataInputStream dis <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> DataInputStream<span style="color:#f92672">(</span>s<span style="color:#f92672">.</span><span style="color:#a6e22e">getInputStream</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>

<span style="color:#66d9ef">new</span> ClientRead<span style="color:#f92672">(</span>dis<span style="color:#f92672">)</span><span style="color:#f92672">.</span><span style="color:#a6e22e">start</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
<span style="color:#66d9ef">new</span> ClientWrite<span style="color:#f92672">(</span>dos<span style="color:#f92672">)</span><span style="color:#f92672">.</span><span style="color:#a6e22e">start</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
<span style="color:#f92672">}</span>

<span style="color:#f92672">}</span>

<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">ClientRead</span> <span style="color:#66d9ef">extends</span> Thread
<span style="color:#f92672">{</span>
<span style="color:#66d9ef">private</span> DataInputStream dis <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
<span style="color:#66d9ef">public</span> <span style="color:#a6e22e">ClientRead</span><span style="color:#f92672">(</span>DataInputStream dis<span style="color:#f92672">)</span>
<span style="color:#f92672">{</span>
<span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">dis</span> <span style="color:#f92672">=</span> dis<span style="color:#f92672">;</span>
<span style="color:#f92672">}</span>

<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">run</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span>
<span style="color:#f92672">{</span>
<span style="color:#66d9ef">while</span><span style="color:#f92672">(</span><span style="color:#66d9ef">true</span><span style="color:#f92672">)</span>
<span style="color:#f92672">{</span>
<span style="color:#66d9ef">try</span><span style="color:#f92672">{</span>
String str <span style="color:#f92672">=</span> dis<span style="color:#f92672">.</span><span style="color:#a6e22e">readUTF</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;服务器说:&#34;</span><span style="color:#f92672">+</span>str<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
<span style="color:#66d9ef">if</span><span style="color:#f92672">(</span>str<span style="color:#f92672">.</span><span style="color:#a6e22e">equalsIgnoreCase</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;byebye&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span>
<span style="color:#66d9ef">break</span><span style="color:#f92672">;</span>
<span style="color:#f92672">}</span><span style="color:#66d9ef">catch</span><span style="color:#f92672">(</span>Exception e<span style="color:#f92672">)</span>
<span style="color:#f92672">{</span>
e<span style="color:#f92672">.</span><span style="color:#a6e22e">printStackTrace</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
<span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">ClientWrite</span> <span style="color:#66d9ef">extends</span> Thread
<span style="color:#f92672">{</span>
<span style="color:#66d9ef">private</span> DataOutputStream dos <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
<span style="color:#66d9ef">public</span> <span style="color:#a6e22e">ClientWrite</span><span style="color:#f92672">(</span>DataOutputStream dos<span style="color:#f92672">)</span>
<span style="color:#f92672">{</span>
<span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">dos</span> <span style="color:#f92672">=</span> dos<span style="color:#f92672">;</span>
<span style="color:#f92672">}</span>

<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">run</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span>
<span style="color:#f92672">{</span>
BufferedReader br <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> BufferedReader<span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> InputStreamReader<span style="color:#f92672">(</span>System<span style="color:#f92672">.</span><span style="color:#a6e22e">in</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
<span style="color:#66d9ef">while</span><span style="color:#f92672">(</span><span style="color:#66d9ef">true</span><span style="color:#f92672">)</span>
<span style="color:#f92672">{</span>
<span style="color:#66d9ef">try</span><span style="color:#f92672">{</span>
String str <span style="color:#f92672">=</span> br<span style="color:#f92672">.</span><span style="color:#a6e22e">readLine</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
dos<span style="color:#f92672">.</span><span style="color:#a6e22e">writeUTF</span><span style="color:#f92672">(</span>str<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
<span style="color:#66d9ef">if</span><span style="color:#f92672">(</span>str<span style="color:#f92672">.</span><span style="color:#a6e22e">equalsIgnoreCase</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;byebye&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span>
<span style="color:#66d9ef">break</span><span style="color:#f92672">;</span>
<span style="color:#f92672">}</span><span style="color:#66d9ef">catch</span><span style="color:#f92672">(</span>Exception e<span style="color:#f92672">)</span>
<span style="color:#f92672">{</span>
e<span style="color:#f92672">.</span><span style="color:#a6e22e">printStackTrace</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
<span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><p>结果：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">客户端的控制台<span style="color:#960050;background-color:#1e0010">：</span>

<span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span>
客户端说:fs
fsdf
客户端说:heihei
吃了吗
客户端说:我吃了啊<span style="color:#960050;background-color:#1e0010">，</span>下午去哪里玩<span style="color:#960050;background-color:#1e0010">？</span>
<span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span>


服务器端的控制台<span style="color:#960050;background-color:#1e0010">：</span>
<span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span>

fs

服务器说:fsdf

heihei
服务器说:吃了吗
我吃了啊<span style="color:#960050;background-color:#1e0010">，</span>下午去哪里玩<span style="color:#960050;background-color:#1e0010">？</span>
服务器说:不然咱们去闯红灯吧

<span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span><span style="color:#f92672">-</span>
</code></pre></div><p>问题：这里面的线程切换，没有生产和消费的明显，还需要进一步理解线程的切换，为什么就能够从Server的读线程，然后写入信息给client就可以切换到Client的读线程？
仅仅加入了extends thread?</p>
<p>案例4： 在原先的基础上 加入了窗体，并进一步抽象到TCPClient  &amp; TCPServer两个类下，通过TCPClient.launch  TCPServer.launch进行启动
美化效果操作：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">Font font <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Font<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Dialog&#34;</span><span style="color:#f92672">,</span> Font<span style="color:#f92672">.</span><span style="color:#a6e22e">PLAIN</span><span style="color:#f92672">,</span> 12<span style="color:#f92672">)</span><span style="color:#f92672">;</span> <span style="color:#75715e">//一下是改变默认的组建上显示的字体，这样更加美观一些
</span><span style="color:#75715e"></span>UIManager<span style="color:#f92672">.</span><span style="color:#a6e22e">put</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;MenuBar.font&#34;</span><span style="color:#f92672">,</span> font<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
UIManager<span style="color:#f92672">.</span><span style="color:#a6e22e">put</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;MenuItem.font&#34;</span><span style="color:#f92672">,</span> font<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
UIManager<span style="color:#f92672">.</span><span style="color:#a6e22e">put</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Menu.font&#34;</span><span style="color:#f92672">,</span> font<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
UIManager<span style="color:#f92672">.</span><span style="color:#a6e22e">put</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;PopupMenu.font&#34;</span><span style="color:#f92672">,</span> font<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
UIManager<span style="color:#f92672">.</span><span style="color:#a6e22e">put</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;ToolBar.font&#34;</span><span style="color:#f92672">,</span> font<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
UIManager<span style="color:#f92672">.</span><span style="color:#a6e22e">put</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;ToolTip.font&#34;</span><span style="color:#f92672">,</span> font<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
UIManager<span style="color:#f92672">.</span><span style="color:#a6e22e">put</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;TabbedPane.font&#34;</span><span style="color:#f92672">,</span> font<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
UIManager<span style="color:#f92672">.</span><span style="color:#a6e22e">put</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Label.font&#34;</span><span style="color:#f92672">,</span> font<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
UIManager<span style="color:#f92672">.</span><span style="color:#a6e22e">put</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;List.font&#34;</span><span style="color:#f92672">,</span> font<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
UIManager<span style="color:#f92672">.</span><span style="color:#a6e22e">put</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;ComboBox.font&#34;</span><span style="color:#f92672">,</span> font<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
UIManager<span style="color:#f92672">.</span><span style="color:#a6e22e">put</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Button.font&#34;</span><span style="color:#f92672">,</span> font<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
UIManager<span style="color:#f92672">.</span><span style="color:#a6e22e">put</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Table.font&#34;</span><span style="color:#f92672">,</span> font<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
UIManager<span style="color:#f92672">.</span><span style="color:#a6e22e">put</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;TableHeader.font&#34;</span><span style="color:#f92672">,</span> font<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
UIManager<span style="color:#f92672">.</span><span style="color:#a6e22e">put</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Tree.font&#34;</span><span style="color:#f92672">,</span> font<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
UIManager<span style="color:#f92672">.</span><span style="color:#a6e22e">put</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;TextField.font&#34;</span><span style="color:#f92672">,</span> font<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
UIManager<span style="color:#f92672">.</span><span style="color:#a6e22e">put</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;TextArea.font&#34;</span><span style="color:#f92672">,</span> font<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
UIManager<span style="color:#f92672">.</span><span style="color:#a6e22e">put</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;TitledBorder.font&#34;</span><span style="color:#f92672">,</span> font<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
UIManager<span style="color:#f92672">.</span><span style="color:#a6e22e">put</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;OptionPane.font&#34;</span><span style="color:#f92672">,</span> font<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
UIManager<span style="color:#f92672">.</span><span style="color:#a6e22e">put</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;RadioButton.font&#34;</span><span style="color:#f92672">,</span> font<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
UIManager<span style="color:#f92672">.</span><span style="color:#a6e22e">put</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;CheckBox.font&#34;</span><span style="color:#f92672">,</span> font<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
UIManager<span style="color:#f92672">.</span><span style="color:#a6e22e">put</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;ToggleButton.font&#34;</span><span style="color:#f92672">,</span> font<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
UIManager<span style="color:#f92672">.</span><span style="color:#a6e22e">put</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Dialog.font&#34;</span><span style="color:#f92672">,</span> font<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
UIManager<span style="color:#f92672">.</span><span style="color:#a6e22e">put</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Panel.font&#34;</span><span style="color:#f92672">,</span> font<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
</code></pre></div><p>Server的实现：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#75715e">/**
</span><span style="color:#75715e">* 解释：
</span><span style="color:#75715e">*/</span>
<span style="color:#f92672">package</span> TestNetwork<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.io.*<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.net.ServerSocket<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.net.Socket<span style="color:#f92672">;</span>


<span style="color:#75715e">//some error swing : controler
</span><span style="color:#75715e"></span><span style="color:#f92672">import</span> javax.swing.*<span style="color:#f92672">;</span>

<span style="color:#f92672">import</span> java.awt.*<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.awt.event.*<span style="color:#f92672">;</span>
<span style="color:#75715e">/**
</span><span style="color:#75715e">* @author 叶昭良
</span><span style="color:#75715e">* @time 2015年3月19日下午3:20:34
</span><span style="color:#75715e">* @version TestNetworkTestServer4 V1.0
</span><span style="color:#75715e">* 功能： 
</span><span style="color:#75715e">步骤：
</span><span style="color:#75715e">* 注意：
</span><span style="color:#75715e">* 掌握：
</span><span style="color:#75715e">思考：
</span><span style="color:#75715e">* 回顾：
</span><span style="color:#75715e">*/</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">TestServer4</span>
<span style="color:#f92672">{</span>

<span style="color:#75715e">/**
</span><span style="color:#75715e">* @param args 
</span><span style="color:#75715e">* 原因：
</span><span style="color:#75715e">* 解决：
</span><span style="color:#75715e">* 功能：
</span><span style="color:#75715e">* 思考： 
</span><span style="color:#75715e">* 步骤：
</span><span style="color:#75715e">*/</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">main</span><span style="color:#f92672">(</span>String<span style="color:#f92672">[</span><span style="color:#f92672">]</span> args<span style="color:#f92672">)</span>
<span style="color:#f92672">{</span>
<span style="color:#75715e">// TODO Auto-generated method stub
</span><span style="color:#75715e"></span>Font font <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Font<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Dialog&#34;</span><span style="color:#f92672">,</span> Font<span style="color:#f92672">.</span><span style="color:#a6e22e">PLAIN</span><span style="color:#f92672">,</span> 12<span style="color:#f92672">)</span><span style="color:#f92672">;</span> <span style="color:#75715e">//一下是改变默认的组建上显示的字体，这样更加美观一些
</span><span style="color:#75715e"></span>UIManager<span style="color:#f92672">.</span><span style="color:#a6e22e">put</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;MenuBar.font&#34;</span><span style="color:#f92672">,</span> font<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
UIManager<span style="color:#f92672">.</span><span style="color:#a6e22e">put</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;MenuItem.font&#34;</span><span style="color:#f92672">,</span> font<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
UIManager<span style="color:#f92672">.</span><span style="color:#a6e22e">put</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Menu.font&#34;</span><span style="color:#f92672">,</span> font<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
UIManager<span style="color:#f92672">.</span><span style="color:#a6e22e">put</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;PopupMenu.font&#34;</span><span style="color:#f92672">,</span> font<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
UIManager<span style="color:#f92672">.</span><span style="color:#a6e22e">put</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;ToolBar.font&#34;</span><span style="color:#f92672">,</span> font<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
UIManager<span style="color:#f92672">.</span><span style="color:#a6e22e">put</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;ToolTip.font&#34;</span><span style="color:#f92672">,</span> font<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
UIManager<span style="color:#f92672">.</span><span style="color:#a6e22e">put</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;TabbedPane.font&#34;</span><span style="color:#f92672">,</span> font<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
UIManager<span style="color:#f92672">.</span><span style="color:#a6e22e">put</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Label.font&#34;</span><span style="color:#f92672">,</span> font<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
UIManager<span style="color:#f92672">.</span><span style="color:#a6e22e">put</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;List.font&#34;</span><span style="color:#f92672">,</span> font<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
UIManager<span style="color:#f92672">.</span><span style="color:#a6e22e">put</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;ComboBox.font&#34;</span><span style="color:#f92672">,</span> font<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
UIManager<span style="color:#f92672">.</span><span style="color:#a6e22e">put</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Button.font&#34;</span><span style="color:#f92672">,</span> font<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
UIManager<span style="color:#f92672">.</span><span style="color:#a6e22e">put</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Table.font&#34;</span><span style="color:#f92672">,</span> font<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
UIManager<span style="color:#f92672">.</span><span style="color:#a6e22e">put</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;TableHeader.font&#34;</span><span style="color:#f92672">,</span> font<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
UIManager<span style="color:#f92672">.</span><span style="color:#a6e22e">put</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Tree.font&#34;</span><span style="color:#f92672">,</span> font<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
UIManager<span style="color:#f92672">.</span><span style="color:#a6e22e">put</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;TextField.font&#34;</span><span style="color:#f92672">,</span> font<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
UIManager<span style="color:#f92672">.</span><span style="color:#a6e22e">put</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;TextArea.font&#34;</span><span style="color:#f92672">,</span> font<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
UIManager<span style="color:#f92672">.</span><span style="color:#a6e22e">put</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;TitledBorder.font&#34;</span><span style="color:#f92672">,</span> font<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
UIManager<span style="color:#f92672">.</span><span style="color:#a6e22e">put</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;OptionPane.font&#34;</span><span style="color:#f92672">,</span> font<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
UIManager<span style="color:#f92672">.</span><span style="color:#a6e22e">put</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;RadioButton.font&#34;</span><span style="color:#f92672">,</span> font<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
UIManager<span style="color:#f92672">.</span><span style="color:#a6e22e">put</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;CheckBox.font&#34;</span><span style="color:#f92672">,</span> font<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
UIManager<span style="color:#f92672">.</span><span style="color:#a6e22e">put</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;ToggleButton.font&#34;</span><span style="color:#f92672">,</span> font<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
UIManager<span style="color:#f92672">.</span><span style="color:#a6e22e">put</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Dialog.font&#34;</span><span style="color:#f92672">,</span> font<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
UIManager<span style="color:#f92672">.</span><span style="color:#a6e22e">put</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Panel.font&#34;</span><span style="color:#f92672">,</span> font<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
<span style="color:#66d9ef">new</span> TCPServer<span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">.</span><span style="color:#a6e22e">launch</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
<span style="color:#f92672">}</span>

<span style="color:#f92672">}</span>


<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">TCPServer</span>
<span style="color:#f92672">{</span>
<span style="color:#75715e">// class variables
</span><span style="color:#75715e"></span><span style="color:#75715e">// class variables
</span><span style="color:#75715e"></span><span style="color:#75715e">// connect
</span><span style="color:#75715e"></span><span style="color:#66d9ef">private</span> ServerSocket ss <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
<span style="color:#66d9ef">private</span> Socket s <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
<span style="color:#75715e">// data flow
</span><span style="color:#75715e"></span><span style="color:#66d9ef">private</span> DataOutputStream dos <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
<span style="color:#66d9ef">private</span> DataInputStream dis <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
<span style="color:#75715e">// UI
</span><span style="color:#75715e"></span><span style="color:#66d9ef">private</span> Frame f <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
<span style="color:#66d9ef">private</span> TextArea ta <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
<span style="color:#66d9ef">private</span> TextField tf <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
<span style="color:#66d9ef">private</span> Button bn <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>


<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">launch</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span>
<span style="color:#f92672">{</span>
createUI<span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
connect<span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
<span style="color:#66d9ef">new</span> ServerRead<span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">.</span><span style="color:#a6e22e">start</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
<span style="color:#66d9ef">new</span> ServerWrite<span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">.</span><span style="color:#a6e22e">start</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
<span style="color:#f92672">}</span>
<span style="color:#75715e">// construct member
</span><span style="color:#75715e"></span><span style="color:#75715e">/*
</span><span style="color:#75715e">public TCPServer()
</span><span style="color:#75715e">{
</span><span style="color:#75715e">
</span><span style="color:#75715e">}
</span><span style="color:#75715e">*/</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">createUI</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span>
<span style="color:#f92672">{</span>
Frame f <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Frame<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;服务器&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
ta <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> TextArea<span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
tf <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> TextField<span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
Panel p <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Panel<span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> BorderLayout<span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
bn <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Button<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;发送&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
p<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span>tf<span style="color:#f92672">,</span>BorderLayout<span style="color:#f92672">.</span><span style="color:#a6e22e">CENTER</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
p<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span>bn<span style="color:#f92672">,</span>BorderLayout<span style="color:#f92672">.</span><span style="color:#a6e22e">EAST</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>

f<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span>ta<span style="color:#f92672">,</span>BorderLayout<span style="color:#f92672">.</span><span style="color:#a6e22e">CENTER</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
f<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span>p<span style="color:#f92672">,</span>BorderLayout<span style="color:#f92672">.</span><span style="color:#a6e22e">SOUTH</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>

f<span style="color:#f92672">.</span><span style="color:#a6e22e">setSize</span><span style="color:#f92672">(</span>400<span style="color:#f92672">,</span>200<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
f<span style="color:#f92672">.</span><span style="color:#a6e22e">setVisible</span><span style="color:#f92672">(</span><span style="color:#66d9ef">true</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
<span style="color:#75715e">//f.setVisable(true);
</span><span style="color:#75715e"></span>f<span style="color:#f92672">.</span><span style="color:#a6e22e">addWindowListener</span><span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> WindowAdapter<span style="color:#f92672">(</span><span style="color:#f92672">)</span>
<span style="color:#f92672">{</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">windowClosing</span><span style="color:#f92672">(</span>WindowEvent e<span style="color:#f92672">)</span>
<span style="color:#f92672">{</span>
System<span style="color:#f92672">.</span><span style="color:#a6e22e">exit</span><span style="color:#f92672">(</span>0<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
<span style="color:#f92672">}</span>
<span style="color:#f92672">}</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
<span style="color:#f92672">}</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">connect</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span>
<span style="color:#f92672">{</span>
<span style="color:#66d9ef">try</span><span style="color:#f92672">{</span>
ss <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> ServerSocket<span style="color:#f92672">(</span>5599<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
s <span style="color:#f92672">=</span> ss<span style="color:#f92672">.</span><span style="color:#a6e22e">accept</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
dis <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> DataInputStream<span style="color:#f92672">(</span>s<span style="color:#f92672">.</span><span style="color:#a6e22e">getInputStream</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
dos <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> DataOutputStream<span style="color:#f92672">(</span>s<span style="color:#f92672">.</span><span style="color:#a6e22e">getOutputStream</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
<span style="color:#f92672">}</span><span style="color:#66d9ef">catch</span><span style="color:#f92672">(</span>Exception e<span style="color:#f92672">)</span>
<span style="color:#f92672">{</span>
System<span style="color:#f92672">.</span><span style="color:#a6e22e">exit</span><span style="color:#f92672">(</span>0<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
<span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">close</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span>
<span style="color:#f92672">{</span>
<span style="color:#66d9ef">try</span><span style="color:#f92672">{</span>
dis<span style="color:#f92672">.</span><span style="color:#a6e22e">close</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
dos<span style="color:#f92672">.</span><span style="color:#a6e22e">close</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
ss<span style="color:#f92672">.</span><span style="color:#a6e22e">close</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
s<span style="color:#f92672">.</span><span style="color:#a6e22e">close</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
<span style="color:#f92672">}</span><span style="color:#66d9ef">catch</span><span style="color:#f92672">(</span>Exception e<span style="color:#f92672">)</span>
<span style="color:#f92672">{</span>
System<span style="color:#f92672">.</span><span style="color:#a6e22e">exit</span><span style="color:#f92672">(</span>0<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
<span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>

<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">ServerRead</span> <span style="color:#66d9ef">extends</span> Thread
<span style="color:#f92672">{</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">run</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span>
<span style="color:#f92672">{</span>
<span style="color:#66d9ef">while</span><span style="color:#f92672">(</span><span style="color:#66d9ef">true</span><span style="color:#f92672">)</span>
<span style="color:#f92672">{</span>
<span style="color:#66d9ef">try</span><span style="color:#f92672">{</span>
String str <span style="color:#f92672">=</span> dis<span style="color:#f92672">.</span><span style="color:#a6e22e">readUTF</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
<span style="color:#75715e">// System.out.println(&#34;对方说:&#34;+str);
</span><span style="color:#75715e"></span>ta<span style="color:#f92672">.</span><span style="color:#a6e22e">append</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;客户端说：&#34;</span><span style="color:#f92672">+</span>str<span style="color:#f92672">+</span><span style="color:#e6db74">&#34;\n&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
<span style="color:#66d9ef">if</span><span style="color:#f92672">(</span>str<span style="color:#f92672">.</span><span style="color:#a6e22e">equalsIgnoreCase</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;再见&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span>
<span style="color:#f92672">{</span>
close<span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
System<span style="color:#f92672">.</span><span style="color:#a6e22e">exit</span><span style="color:#f92672">(</span>0<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
<span style="color:#f92672">}</span>
<span style="color:#f92672">}</span><span style="color:#66d9ef">catch</span><span style="color:#f92672">(</span>Exception e<span style="color:#f92672">)</span>
<span style="color:#f92672">{</span>
JOptionPane<span style="color:#f92672">.</span><span style="color:#a6e22e">showMessageDialog</span><span style="color:#f92672">(</span>f<span style="color:#f92672">,</span><span style="color:#e6db74">&#34;客户端已离开&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
<span style="color:#66d9ef">return</span><span style="color:#f92672">;</span>
<span style="color:#75715e">// e.printStackTrace();
</span><span style="color:#75715e"></span><span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">ServerWrite</span> <span style="color:#66d9ef">extends</span> Thread
<span style="color:#f92672">{</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">run</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span>
<span style="color:#f92672">{</span>
tf<span style="color:#f92672">.</span><span style="color:#a6e22e">addActionListener</span><span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> TCPServerListener<span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
bn<span style="color:#f92672">.</span><span style="color:#a6e22e">addActionListener</span><span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> TCPServerListener<span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
<span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">TCPServerListener</span> <span style="color:#66d9ef">implements</span> ActionListener
<span style="color:#f92672">{</span>
<span style="color:#a6e22e">@Override</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">actionPerformed</span><span style="color:#f92672">(</span>ActionEvent e<span style="color:#f92672">)</span>
<span style="color:#f92672">{</span>
<span style="color:#66d9ef">try</span><span style="color:#f92672">{</span>
String str <span style="color:#f92672">=</span> tf<span style="color:#f92672">.</span><span style="color:#a6e22e">getText</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
tf<span style="color:#f92672">.</span><span style="color:#a6e22e">setText</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
ta<span style="color:#f92672">.</span><span style="color:#a6e22e">append</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;服务器说:&#34;</span><span style="color:#f92672">+</span>str<span style="color:#f92672">+</span><span style="color:#e6db74">&#34;\n&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
dos<span style="color:#f92672">.</span><span style="color:#a6e22e">writeUTF</span><span style="color:#f92672">(</span>str<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
<span style="color:#66d9ef">if</span><span style="color:#f92672">(</span>str<span style="color:#f92672">.</span><span style="color:#a6e22e">equalsIgnoreCase</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;再见&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span>
<span style="color:#f92672">{</span>
close<span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
System<span style="color:#f92672">.</span><span style="color:#a6e22e">exit</span><span style="color:#f92672">(</span>0<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
<span style="color:#f92672">}</span>
<span style="color:#f92672">}</span><span style="color:#66d9ef">catch</span><span style="color:#f92672">(</span>Exception e1<span style="color:#f92672">)</span>
<span style="color:#f92672">{</span>
<span style="color:#75715e">// e.printStackTrace();
</span><span style="color:#75715e"></span>System<span style="color:#f92672">.</span><span style="color:#a6e22e">exit</span><span style="color:#f92672">(</span>0<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
<span style="color:#f92672">}</span> 
<span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><p>Client的实现：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#75715e">/**
</span><span style="color:#75715e">* 解释：
</span><span style="color:#75715e">*/</span>
<span style="color:#f92672">package</span> TestNetwork<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.net.*<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.io.*<span style="color:#f92672">;</span>

<span style="color:#75715e">// some error swing : controler
</span><span style="color:#75715e"></span><span style="color:#f92672">import</span> javax.swing.*<span style="color:#f92672">;</span>

<span style="color:#f92672">import</span> java.awt.*<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.awt.event.*<span style="color:#f92672">;</span>
<span style="color:#75715e">/**
</span><span style="color:#75715e">* @author 叶昭良
</span><span style="color:#75715e">* @time 2015年3月19日下午3:22:27
</span><span style="color:#75715e">* @version TestNetworkTestClient4 V1.0
</span><span style="color:#75715e">* 功能： 
</span><span style="color:#75715e">步骤：
</span><span style="color:#75715e">* 注意：
</span><span style="color:#75715e">* 掌握：
</span><span style="color:#75715e">思考：
</span><span style="color:#75715e">* 回顾：
</span><span style="color:#75715e">*/</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">TestClient4</span>
<span style="color:#f92672">{</span>

<span style="color:#75715e">/**
</span><span style="color:#75715e">* @param args 
</span><span style="color:#75715e">* 原因：
</span><span style="color:#75715e">* 解决：
</span><span style="color:#75715e">* 功能：
</span><span style="color:#75715e">* 思考： 
</span><span style="color:#75715e">* 步骤：
</span><span style="color:#75715e">*/</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">main</span><span style="color:#f92672">(</span>String<span style="color:#f92672">[</span><span style="color:#f92672">]</span> args<span style="color:#f92672">)</span>
<span style="color:#f92672">{</span>
<span style="color:#75715e">// TODO Auto-generated method stub
</span><span style="color:#75715e"></span>Font font <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Font<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Dialog&#34;</span><span style="color:#f92672">,</span> Font<span style="color:#f92672">.</span><span style="color:#a6e22e">PLAIN</span><span style="color:#f92672">,</span> 12<span style="color:#f92672">)</span><span style="color:#f92672">;</span> <span style="color:#75715e">//一下是改变默认的组建上显示的字体，这样更加美观一些
</span><span style="color:#75715e"></span>UIManager<span style="color:#f92672">.</span><span style="color:#a6e22e">put</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;MenuBar.font&#34;</span><span style="color:#f92672">,</span> font<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
UIManager<span style="color:#f92672">.</span><span style="color:#a6e22e">put</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;MenuItem.font&#34;</span><span style="color:#f92672">,</span> font<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
UIManager<span style="color:#f92672">.</span><span style="color:#a6e22e">put</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Menu.font&#34;</span><span style="color:#f92672">,</span> font<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
UIManager<span style="color:#f92672">.</span><span style="color:#a6e22e">put</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;PopupMenu.font&#34;</span><span style="color:#f92672">,</span> font<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
UIManager<span style="color:#f92672">.</span><span style="color:#a6e22e">put</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;ToolBar.font&#34;</span><span style="color:#f92672">,</span> font<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
UIManager<span style="color:#f92672">.</span><span style="color:#a6e22e">put</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;ToolTip.font&#34;</span><span style="color:#f92672">,</span> font<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
UIManager<span style="color:#f92672">.</span><span style="color:#a6e22e">put</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;TabbedPane.font&#34;</span><span style="color:#f92672">,</span> font<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
UIManager<span style="color:#f92672">.</span><span style="color:#a6e22e">put</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Label.font&#34;</span><span style="color:#f92672">,</span> font<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
UIManager<span style="color:#f92672">.</span><span style="color:#a6e22e">put</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;List.font&#34;</span><span style="color:#f92672">,</span> font<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
UIManager<span style="color:#f92672">.</span><span style="color:#a6e22e">put</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;ComboBox.font&#34;</span><span style="color:#f92672">,</span> font<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
UIManager<span style="color:#f92672">.</span><span style="color:#a6e22e">put</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Button.font&#34;</span><span style="color:#f92672">,</span> font<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
UIManager<span style="color:#f92672">.</span><span style="color:#a6e22e">put</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Table.font&#34;</span><span style="color:#f92672">,</span> font<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
UIManager<span style="color:#f92672">.</span><span style="color:#a6e22e">put</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;TableHeader.font&#34;</span><span style="color:#f92672">,</span> font<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
UIManager<span style="color:#f92672">.</span><span style="color:#a6e22e">put</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Tree.font&#34;</span><span style="color:#f92672">,</span> font<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
UIManager<span style="color:#f92672">.</span><span style="color:#a6e22e">put</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;TextField.font&#34;</span><span style="color:#f92672">,</span> font<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
UIManager<span style="color:#f92672">.</span><span style="color:#a6e22e">put</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;TextArea.font&#34;</span><span style="color:#f92672">,</span> font<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
UIManager<span style="color:#f92672">.</span><span style="color:#a6e22e">put</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;TitledBorder.font&#34;</span><span style="color:#f92672">,</span> font<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
UIManager<span style="color:#f92672">.</span><span style="color:#a6e22e">put</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;OptionPane.font&#34;</span><span style="color:#f92672">,</span> font<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
UIManager<span style="color:#f92672">.</span><span style="color:#a6e22e">put</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;RadioButton.font&#34;</span><span style="color:#f92672">,</span> font<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
UIManager<span style="color:#f92672">.</span><span style="color:#a6e22e">put</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;CheckBox.font&#34;</span><span style="color:#f92672">,</span> font<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
UIManager<span style="color:#f92672">.</span><span style="color:#a6e22e">put</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;ToggleButton.font&#34;</span><span style="color:#f92672">,</span> font<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
UIManager<span style="color:#f92672">.</span><span style="color:#a6e22e">put</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Dialog.font&#34;</span><span style="color:#f92672">,</span> font<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
UIManager<span style="color:#f92672">.</span><span style="color:#a6e22e">put</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Panel.font&#34;</span><span style="color:#f92672">,</span> font<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
<span style="color:#66d9ef">new</span> TCPClient<span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">.</span><span style="color:#a6e22e">launch</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
<span style="color:#f92672">}</span>

<span style="color:#f92672">}</span>
<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">TCPClient</span>
<span style="color:#f92672">{</span>
<span style="color:#75715e">// class variables
</span><span style="color:#75715e"></span><span style="color:#75715e">// class variables
</span><span style="color:#75715e"></span><span style="color:#75715e">// connect
</span><span style="color:#75715e"></span><span style="color:#66d9ef">private</span> Socket s <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
<span style="color:#75715e">// data flow
</span><span style="color:#75715e"></span><span style="color:#66d9ef">private</span> DataOutputStream dos <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
<span style="color:#66d9ef">private</span> DataInputStream dis <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
<span style="color:#75715e">// UI
</span><span style="color:#75715e"></span><span style="color:#66d9ef">private</span> Frame f <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
<span style="color:#66d9ef">private</span> TextArea ta <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
<span style="color:#66d9ef">private</span> TextField tf <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
<span style="color:#66d9ef">private</span> Button bn <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>


<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">launch</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span>
<span style="color:#f92672">{</span>
createUI<span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
connect<span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
<span style="color:#66d9ef">new</span> ClientRead<span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">.</span><span style="color:#a6e22e">start</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
<span style="color:#66d9ef">new</span> ClientWrite<span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">.</span><span style="color:#a6e22e">start</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
<span style="color:#f92672">}</span>
<span style="color:#75715e">// construct member
</span><span style="color:#75715e"></span><span style="color:#75715e">/*
</span><span style="color:#75715e">public TCPClient()
</span><span style="color:#75715e">{
</span><span style="color:#75715e">
</span><span style="color:#75715e">}
</span><span style="color:#75715e">*/</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">createUI</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span>
<span style="color:#f92672">{</span>
Frame f <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Frame<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;客户端&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
ta <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> TextArea<span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
tf <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> TextField<span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
Panel p <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Panel<span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> BorderLayout<span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
bn <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Button<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;发送&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
p<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span>tf<span style="color:#f92672">,</span>BorderLayout<span style="color:#f92672">.</span><span style="color:#a6e22e">CENTER</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
p<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span>bn<span style="color:#f92672">,</span>BorderLayout<span style="color:#f92672">.</span><span style="color:#a6e22e">EAST</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>

f<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span>ta<span style="color:#f92672">,</span>BorderLayout<span style="color:#f92672">.</span><span style="color:#a6e22e">CENTER</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
f<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span>p<span style="color:#f92672">,</span>BorderLayout<span style="color:#f92672">.</span><span style="color:#a6e22e">SOUTH</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>

f<span style="color:#f92672">.</span><span style="color:#a6e22e">setSize</span><span style="color:#f92672">(</span>400<span style="color:#f92672">,</span>200<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
f<span style="color:#f92672">.</span><span style="color:#a6e22e">setVisible</span><span style="color:#f92672">(</span><span style="color:#66d9ef">true</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
<span style="color:#75715e">//f.setVisable(true);
</span><span style="color:#75715e"></span>f<span style="color:#f92672">.</span><span style="color:#a6e22e">addWindowListener</span><span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> WindowAdapter<span style="color:#f92672">(</span><span style="color:#f92672">)</span>
<span style="color:#f92672">{</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">windowClosing</span><span style="color:#f92672">(</span>WindowEvent e<span style="color:#f92672">)</span>
<span style="color:#f92672">{</span>
System<span style="color:#f92672">.</span><span style="color:#a6e22e">exit</span><span style="color:#f92672">(</span>0<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
<span style="color:#f92672">}</span>
<span style="color:#f92672">}</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
<span style="color:#f92672">}</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">connect</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span>
<span style="color:#f92672">{</span>
<span style="color:#66d9ef">try</span><span style="color:#f92672">{</span>
s <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Socket<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;127.0.0.1&#34;</span><span style="color:#f92672">,</span>5599<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
dis <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> DataInputStream<span style="color:#f92672">(</span>s<span style="color:#f92672">.</span><span style="color:#a6e22e">getInputStream</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
dos <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> DataOutputStream<span style="color:#f92672">(</span>s<span style="color:#f92672">.</span><span style="color:#a6e22e">getOutputStream</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
<span style="color:#f92672">}</span><span style="color:#66d9ef">catch</span><span style="color:#f92672">(</span>Exception e<span style="color:#f92672">)</span>
<span style="color:#f92672">{</span>
System<span style="color:#f92672">.</span><span style="color:#a6e22e">exit</span><span style="color:#f92672">(</span>0<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
<span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">close</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span>
<span style="color:#f92672">{</span>
<span style="color:#66d9ef">try</span><span style="color:#f92672">{</span>
dis<span style="color:#f92672">.</span><span style="color:#a6e22e">close</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
dos<span style="color:#f92672">.</span><span style="color:#a6e22e">close</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
s<span style="color:#f92672">.</span><span style="color:#a6e22e">close</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
<span style="color:#f92672">}</span><span style="color:#66d9ef">catch</span><span style="color:#f92672">(</span>Exception e<span style="color:#f92672">)</span>
<span style="color:#f92672">{</span>
System<span style="color:#f92672">.</span><span style="color:#a6e22e">exit</span><span style="color:#f92672">(</span>0<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
<span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>

<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">ClientRead</span> <span style="color:#66d9ef">extends</span> Thread
<span style="color:#f92672">{</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">run</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span>
<span style="color:#f92672">{</span>
<span style="color:#66d9ef">while</span><span style="color:#f92672">(</span><span style="color:#66d9ef">true</span><span style="color:#f92672">)</span>
<span style="color:#f92672">{</span>
<span style="color:#66d9ef">try</span><span style="color:#f92672">{</span>
String str <span style="color:#f92672">=</span> dis<span style="color:#f92672">.</span><span style="color:#a6e22e">readUTF</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
<span style="color:#75715e">// System.out.println(&#34;对方说:&#34;+str);
</span><span style="color:#75715e"></span>ta<span style="color:#f92672">.</span><span style="color:#a6e22e">append</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;服务器说:&#34;</span><span style="color:#f92672">+</span>str<span style="color:#f92672">+</span><span style="color:#e6db74">&#34;\n&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
<span style="color:#66d9ef">if</span><span style="color:#f92672">(</span>str<span style="color:#f92672">.</span><span style="color:#a6e22e">equalsIgnoreCase</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;再见&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span>
<span style="color:#f92672">{</span>
close<span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
System<span style="color:#f92672">.</span><span style="color:#a6e22e">exit</span><span style="color:#f92672">(</span>0<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
<span style="color:#f92672">}</span>
<span style="color:#f92672">}</span><span style="color:#66d9ef">catch</span><span style="color:#f92672">(</span>Exception e<span style="color:#f92672">)</span>
<span style="color:#f92672">{</span>
JOptionPane<span style="color:#f92672">.</span><span style="color:#a6e22e">showMessageDialog</span><span style="color:#f92672">(</span>f<span style="color:#f92672">,</span><span style="color:#e6db74">&#34;客户端已离开&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
<span style="color:#66d9ef">return</span><span style="color:#f92672">;</span>
<span style="color:#75715e">// e.printStackTrace();
</span><span style="color:#75715e"></span><span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">ClientWrite</span> <span style="color:#66d9ef">extends</span> Thread
<span style="color:#f92672">{</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">run</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span>
<span style="color:#f92672">{</span>
tf<span style="color:#f92672">.</span><span style="color:#a6e22e">addActionListener</span><span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> TCPClientListener<span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
bn<span style="color:#f92672">.</span><span style="color:#a6e22e">addActionListener</span><span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> TCPClientListener<span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
<span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">TCPClientListener</span> <span style="color:#66d9ef">implements</span> ActionListener
<span style="color:#f92672">{</span>
<span style="color:#a6e22e">@Override</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">actionPerformed</span><span style="color:#f92672">(</span>ActionEvent e<span style="color:#f92672">)</span>
<span style="color:#f92672">{</span>
<span style="color:#66d9ef">try</span><span style="color:#f92672">{</span>
String str <span style="color:#f92672">=</span> tf<span style="color:#f92672">.</span><span style="color:#a6e22e">getText</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
tf<span style="color:#f92672">.</span><span style="color:#a6e22e">setText</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
ta<span style="color:#f92672">.</span><span style="color:#a6e22e">append</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;客户端说:&#34;</span><span style="color:#f92672">+</span>str<span style="color:#f92672">+</span><span style="color:#e6db74">&#34;\n&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
dos<span style="color:#f92672">.</span><span style="color:#a6e22e">writeUTF</span><span style="color:#f92672">(</span>str<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
<span style="color:#66d9ef">if</span><span style="color:#f92672">(</span>str<span style="color:#f92672">.</span><span style="color:#a6e22e">equalsIgnoreCase</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;再见&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span>
<span style="color:#f92672">{</span>
close<span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
System<span style="color:#f92672">.</span><span style="color:#a6e22e">exit</span><span style="color:#f92672">(</span>0<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
<span style="color:#f92672">}</span>
<span style="color:#f92672">}</span><span style="color:#66d9ef">catch</span><span style="color:#f92672">(</span>Exception e1<span style="color:#f92672">)</span>
<span style="color:#f92672">{</span>
<span style="color:#75715e">// e.printStackTrace();
</span><span style="color:#75715e"></span>System<span style="color:#f92672">.</span><span style="color:#a6e22e">exit</span><span style="color:#f92672">(</span>0<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
<span style="color:#f92672">}</span> 
<span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><p><img src="/images/java/%E5%AE%A2%E6%88%B7%E7%AB%AF%E6%9C%8D%E5%8A%A1%E7%AB%AF.png" alt="服务器端和客户端的对话窗口"></p>
<p>##重写TCPServer1 &amp; TCPClient1 并加入了  String ip = s.getInetAddress().getHostAddress();
并且调整了编写风格，把所有类使用的变量都放在类中，并把socket创建和连接  接受和发送都放在构造函数中。类似于OOGTK的编写风格http://www.rupeng.com/forum/forum.php?mod=viewthread&amp;tid=44377。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#75715e">/**
</span><span style="color:#75715e">* 解释：
</span><span style="color:#75715e">*/</span>
<span style="color:#f92672">package</span> TestNetwork<span style="color:#f92672">;</span>

<span style="color:#75715e">/**
</span><span style="color:#75715e">* @author    叶昭良
</span><span style="color:#75715e">* @time      2015年3月22日下午3:49:11
</span><span style="color:#75715e">* @version   TestNetworkRewriteTestServer1 V1.0
</span><span style="color:#75715e">* 功能： 
</span><span style="color:#75715e">                步骤：
</span><span style="color:#75715e">                1: Server绑定端口
</span><span style="color:#75715e">                2：接受
</span><span style="color:#75715e">                3：循环接收
</span><span style="color:#75715e">* 注意：  socket的主要作用就是   getOutputStream  和getInputStream来确定
</span><span style="color:#75715e">*       表明socket交流的方向
</span><span style="color:#75715e">* 掌握：
</span><span style="color:#75715e">                思考：
</span><span style="color:#75715e">* 回顾：
</span><span style="color:#75715e">*/</span>
<span style="color:#f92672">import</span> java.io.*<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.net.*<span style="color:#f92672">;</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">RewriteTestServer1</span>
<span style="color:#f92672">{</span>

        <span style="color:#75715e">/**
</span><span style="color:#75715e">         * @param args 
</span><span style="color:#75715e">         * 原因：
</span><span style="color:#75715e">         * 解决：
</span><span style="color:#75715e">         * 功能：
</span><span style="color:#75715e">         *       思考：        
</span><span style="color:#75715e">         *       步骤：
</span><span style="color:#75715e">         */</span>
        ServerSocket ss <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
        Socket s <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
        DataInputStream dis <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
        <span style="color:#66d9ef">public</span> <span style="color:#a6e22e">RewriteTestServer1</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span>
        <span style="color:#f92672">{</span>
                <span style="color:#66d9ef">try</span>
                <span style="color:#f92672">{</span>
                        ss <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> ServerSocket<span style="color:#f92672">(</span>5566<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                        s <span style="color:#f92672">=</span> ss<span style="color:#f92672">.</span><span style="color:#a6e22e">accept</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                        String ip <span style="color:#f92672">=</span> s<span style="color:#f92672">.</span><span style="color:#a6e22e">getInetAddress</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">.</span><span style="color:#a6e22e">getHostAddress</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                        dis <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> DataInputStream<span style="color:#f92672">(</span>s<span style="color:#f92672">.</span><span style="color:#a6e22e">getInputStream</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                        System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;客户端&#34;</span><span style="color:#f92672">+</span>ip<span style="color:#f92672">+</span><span style="color:#e6db74">&#34; said: &#34;</span><span style="color:#f92672">+</span>dis<span style="color:#f92672">.</span><span style="color:#a6e22e">readUTF</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                <span style="color:#f92672">}</span> <span style="color:#66d9ef">catch</span> <span style="color:#f92672">(</span>IOException e<span style="color:#f92672">)</span>
                <span style="color:#f92672">{</span>
                        <span style="color:#75715e">// TODO Auto-generated catch block
</span><span style="color:#75715e"></span>                        e<span style="color:#f92672">.</span><span style="color:#a6e22e">printStackTrace</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                <span style="color:#f92672">}</span><span style="color:#66d9ef">finally</span>
                <span style="color:#f92672">{</span>
                        <span style="color:#66d9ef">try</span>
                        <span style="color:#f92672">{</span>
                                dis<span style="color:#f92672">.</span><span style="color:#a6e22e">close</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                                s<span style="color:#f92672">.</span><span style="color:#a6e22e">close</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                        <span style="color:#f92672">}</span><span style="color:#66d9ef">catch</span><span style="color:#f92672">(</span>IOException e<span style="color:#f92672">)</span>
                        <span style="color:#f92672">{</span>
                                
                        <span style="color:#f92672">}</span>                
                <span style="color:#f92672">}</span>
                
        <span style="color:#f92672">}</span>
        <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">main</span><span style="color:#f92672">(</span>String<span style="color:#f92672">[</span><span style="color:#f92672">]</span> args<span style="color:#f92672">)</span>
        <span style="color:#f92672">{</span>
                <span style="color:#75715e">// TODO Auto-generated method stub
</span><span style="color:#75715e"></span>                <span style="color:#66d9ef">new</span> RewriteTestServer1<span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
        <span style="color:#f92672">}</span>

<span style="color:#f92672">}</span>
</code></pre></div><p>TCPClient1:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#75715e">/**
</span><span style="color:#75715e">* 解释：
</span><span style="color:#75715e">*/</span>
<span style="color:#f92672">package</span> TestNetwork<span style="color:#f92672">;</span>

<span style="color:#75715e">/**
</span><span style="color:#75715e">* @author    叶昭良
</span><span style="color:#75715e">* @time      2015年3月22日下午3:54:39
</span><span style="color:#75715e">* @version   TestNetworkRewriteTestClient1 V1.0
</span><span style="color:#75715e">* 功能： 
</span><span style="color:#75715e">                步骤：  
</span><span style="color:#75715e">                1: Socket的建立
</span><span style="color:#75715e">                2： 发送数据
</span><span style="color:#75715e">                3：。。
</span><span style="color:#75715e">* 注意：
</span><span style="color:#75715e">* 掌握：
</span><span style="color:#75715e">                思考：
</span><span style="color:#75715e">* 回顾：
</span><span style="color:#75715e">*/</span>
<span style="color:#f92672">import</span> java.io.*<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.net.*<span style="color:#f92672">;</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">RewriteTestClient1</span>
<span style="color:#f92672">{</span>

        <span style="color:#75715e">/**
</span><span style="color:#75715e">         * @param args 
</span><span style="color:#75715e">         * 原因：
</span><span style="color:#75715e">         * 解决：
</span><span style="color:#75715e">         * 功能：
</span><span style="color:#75715e">         *       思考：        
</span><span style="color:#75715e">         *       步骤：
</span><span style="color:#75715e">         */</span>
        Socket s <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
        DataOutputStream dos <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
        <span style="color:#66d9ef">public</span> <span style="color:#a6e22e">RewriteTestClient1</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span>
        <span style="color:#f92672">{</span>
                <span style="color:#66d9ef">try</span>
                <span style="color:#f92672">{</span>
                        s <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Socket<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;127.0.0.1&#34;</span><span style="color:#f92672">,</span>5566<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                        dos <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> DataOutputStream<span style="color:#f92672">(</span>s<span style="color:#f92672">.</span><span style="color:#a6e22e">getOutputStream</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                        dos<span style="color:#f92672">.</span><span style="color:#a6e22e">writeUTF</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Hello&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                        dos<span style="color:#f92672">.</span><span style="color:#a6e22e">flush</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                <span style="color:#f92672">}</span> <span style="color:#66d9ef">catch</span> <span style="color:#f92672">(</span>IOException e<span style="color:#f92672">)</span>
                <span style="color:#f92672">{</span>
                        <span style="color:#75715e">// TODO Auto-generated catch block
</span><span style="color:#75715e"></span>                        e<span style="color:#f92672">.</span><span style="color:#a6e22e">printStackTrace</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                <span style="color:#f92672">}</span>
        <span style="color:#f92672">}</span>
        <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">main</span><span style="color:#f92672">(</span>String<span style="color:#f92672">[</span><span style="color:#f92672">]</span> args<span style="color:#f92672">)</span>
        <span style="color:#f92672">{</span>
                <span style="color:#75715e">// TODO Auto-generated method stub
</span><span style="color:#75715e"></span>                <span style="color:#66d9ef">new</span> RewriteTestClient1<span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
        <span style="color:#f92672">}</span>

<span style="color:#f92672">}</span>
</code></pre></div><p>重写了TestServer2
功能：   在第一版本服务器的基础上  修正了客户端的只发送 不接受</p>
<ul>
<li>
<pre><code>    以及服务器端的只接受不发送
</code></pre>
</li>
<li>
<pre><code>    并用BufferedReader获取System.in的内容输送到客户端
</code></pre>
</li>
</ul>
<p>当客户端 也就是ss.accept之后，服务器来了一声“欢迎，ohni sang 光临”
紧接着客户端做了动作，接收到了服务器来的欢迎词，然后开始写入 一些话提交给服务器
反复执行这个过程</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#75715e">/**
</span><span style="color:#75715e">* 解释：
</span><span style="color:#75715e">*/</span>
<span style="color:#f92672">package</span> TestNetwork<span style="color:#f92672">;</span>

<span style="color:#75715e">/**
</span><span style="color:#75715e">* @author    叶昭良
</span><span style="color:#75715e">* @time      2015年3月22日下午4:08:24
</span><span style="color:#75715e">* @version   TestNetworkRewriteTestServer2 V1.0
</span><span style="color:#75715e">* 功能： 
</span><span style="color:#75715e">*              在第一版本服务器的基础上  修正了客户端的只发送 不接受
</span><span style="color:#75715e">*         以及服务器端的只接受不发送
</span><span style="color:#75715e">*         并用BufferedReader获取System.in的内容输送到客户端
</span><span style="color:#75715e">                步骤：
</span><span style="color:#75715e">* 注意：
</span><span style="color:#75715e">* 掌握：
</span><span style="color:#75715e">                思考：
</span><span style="color:#75715e">* 回顾： 回顾了第一版本的ServerSocket   ss.accept()  以及DataInputStream(s.getInputStream());
</span><span style="color:#75715e">*/</span>
<span style="color:#f92672">import</span> java.io.*<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.net.*<span style="color:#f92672">;</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">RewriteTestServer2</span>
<span style="color:#f92672">{</span>

        <span style="color:#75715e">/**
</span><span style="color:#75715e">         * @param args 
</span><span style="color:#75715e">         * 原因：
</span><span style="color:#75715e">         * 解决：
</span><span style="color:#75715e">         * 功能：
</span><span style="color:#75715e">         *       思考：        
</span><span style="color:#75715e">         *       步骤：
</span><span style="color:#75715e">         */</span>
        ServerSocket ss <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
        Socket s <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
        DataInputStream dis <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
        DataOutputStream dos <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
        BufferedReader br <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
        String wordsFromClient  <span style="color:#f92672">=</span><span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
        String wordsFromServer  <span style="color:#f92672">=</span><span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
        <span style="color:#66d9ef">public</span> <span style="color:#a6e22e">RewriteTestServer2</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span>
        <span style="color:#f92672">{</span>
                createConnection<span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                String ip <span style="color:#f92672">=</span> s<span style="color:#f92672">.</span><span style="color:#a6e22e">getInetAddress</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">.</span><span style="color:#a6e22e">getHostAddress</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>

                <span style="color:#66d9ef">while</span><span style="color:#f92672">(</span><span style="color:#66d9ef">true</span><span style="color:#f92672">)</span>
                <span style="color:#f92672">{</span>
                        <span style="color:#66d9ef">try</span>
                        <span style="color:#f92672">{</span>
                                
                                wordsFromClient <span style="color:#f92672">=</span> dis<span style="color:#f92672">.</span><span style="color:#a6e22e">readUTF</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                                System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;客户端IP:&#34;</span><span style="color:#f92672">+</span>ip<span style="color:#f92672">+</span><span style="color:#e6db74">&#34; said:&#34;</span><span style="color:#f92672">+</span>wordsFromClient<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                                <span style="color:#66d9ef">if</span><span style="color:#f92672">(</span>wordsFromClient<span style="color:#f92672">.</span><span style="color:#a6e22e">equalsIgnoreCase</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;bye*&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span>
                                <span style="color:#f92672">{</span>
                                        <span style="color:#66d9ef">break</span><span style="color:#f92672">;</span>
                                <span style="color:#f92672">}</span>
                                System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;服务器，请您输入你想对客户端说什么：&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                                wordsFromServer <span style="color:#f92672">=</span> br<span style="color:#f92672">.</span><span style="color:#a6e22e">readLine</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                                dos<span style="color:#f92672">.</span><span style="color:#a6e22e">writeUTF</span><span style="color:#f92672">(</span>wordsFromServer<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                        <span style="color:#f92672">}</span> <span style="color:#66d9ef">catch</span> <span style="color:#f92672">(</span>IOException e<span style="color:#f92672">)</span>
                        <span style="color:#f92672">{</span>
                                <span style="color:#75715e">// TODO Auto-generated catch block
</span><span style="color:#75715e"></span>                                e<span style="color:#f92672">.</span><span style="color:#a6e22e">printStackTrace</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                        <span style="color:#f92672">}</span><span style="color:#66d9ef">finally</span>
                        <span style="color:#f92672">{</span>
                                <span style="color:#66d9ef">try</span>
                                <span style="color:#f92672">{</span>
                                        dos<span style="color:#f92672">.</span><span style="color:#a6e22e">close</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                                        dis<span style="color:#f92672">.</span><span style="color:#a6e22e">close</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                                        s<span style="color:#f92672">.</span><span style="color:#a6e22e">close</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                                <span style="color:#f92672">}</span> <span style="color:#66d9ef">catch</span> <span style="color:#f92672">(</span>IOException e<span style="color:#f92672">)</span>
                                <span style="color:#f92672">{</span>
                                        <span style="color:#75715e">// TODO Auto-generated catch block
</span><span style="color:#75715e"></span>                                        e<span style="color:#f92672">.</span><span style="color:#a6e22e">printStackTrace</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                                <span style="color:#f92672">}</span>
                        <span style="color:#f92672">}</span>
                        
                <span style="color:#f92672">}</span>
        <span style="color:#f92672">}</span>
        <span style="color:#75715e">/**
</span><span style="color:#75715e">         * 功能： 创建一个读的连接，用于读取客户端的socket数据
</span><span style="color:#75715e">         *       创建一个写的连接，通过BufferedReader进行缓冲读取System.in的数据
</span><span style="color:#75715e">         *       并通过DataOutputStream发送出去
</span><span style="color:#75715e">         *       思考：        
</span><span style="color:#75715e">         *       步骤：
</span><span style="color:#75715e">         */</span>
        <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">createConnection</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span>
        <span style="color:#f92672">{</span>
                <span style="color:#66d9ef">try</span>
                <span style="color:#f92672">{</span>
                        ss <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> ServerSocket<span style="color:#f92672">(</span>5566<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                        s <span style="color:#f92672">=</span>  ss<span style="color:#f92672">.</span><span style="color:#a6e22e">accept</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                        dis <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> DataInputStream<span style="color:#f92672">(</span>s<span style="color:#f92672">.</span><span style="color:#a6e22e">getInputStream</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                        dos <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> DataOutputStream<span style="color:#f92672">(</span>s<span style="color:#f92672">.</span><span style="color:#a6e22e">getOutputStream</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                        <span style="color:#75715e">//增加了下面两句
</span><span style="color:#75715e"></span>                        dos<span style="color:#f92672">.</span><span style="color:#a6e22e">writeUTF</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;您好！我是服务器想要聊些什么:&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                        dos<span style="color:#f92672">.</span><span style="color:#a6e22e">flush</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                        br <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> BufferedReader<span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> InputStreamReader<span style="color:#f92672">(</span>System<span style="color:#f92672">.</span><span style="color:#a6e22e">in</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                <span style="color:#f92672">}</span><span style="color:#66d9ef">catch</span><span style="color:#f92672">(</span>IOException e<span style="color:#f92672">)</span>
                <span style="color:#f92672">{</span>
                        System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;创建连接问题&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                <span style="color:#f92672">}</span>
        <span style="color:#f92672">}</span>
        <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">main</span><span style="color:#f92672">(</span>String<span style="color:#f92672">[</span><span style="color:#f92672">]</span> args<span style="color:#f92672">)</span>
        <span style="color:#f92672">{</span>
                <span style="color:#75715e">// TODO Auto-generated method stub
</span><span style="color:#75715e"></span>                <span style="color:#66d9ef">new</span> RewriteTestServer2<span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
        <span style="color:#f92672">}</span>

<span style="color:#f92672">}</span>
</code></pre></div><p>RewriteTestClient2:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#75715e">/**
</span><span style="color:#75715e">* 解释：
</span><span style="color:#75715e">*/</span>
<span style="color:#f92672">package</span> TestNetwork<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.io.*<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.net.*<span style="color:#f92672">;</span>
<span style="color:#75715e">/**
</span><span style="color:#75715e">* @author    叶昭良
</span><span style="color:#75715e">* @time      2015年3月19日下午2:38:52
</span><span style="color:#75715e">* @version   TestNetworkTestClient2 V1.0
</span><span style="color:#75715e">* 功能： 
</span><span style="color:#75715e">                步骤：
</span><span style="color:#75715e">* 注意：
</span><span style="color:#75715e">* 掌握：
</span><span style="color:#75715e">                思考：
</span><span style="color:#75715e">* 回顾：
</span><span style="color:#75715e">*/</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">TestClient2</span>
<span style="color:#f92672">{</span>

        <span style="color:#75715e">/**
</span><span style="color:#75715e">         * @param args 
</span><span style="color:#75715e">         * 原因：
</span><span style="color:#75715e">         * 解决：
</span><span style="color:#75715e">         * 功能：
</span><span style="color:#75715e">         *       思考：        
</span><span style="color:#75715e">         *       步骤：
</span><span style="color:#75715e">         */</span>
        <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">main</span><span style="color:#f92672">(</span>String<span style="color:#f92672">[</span><span style="color:#f92672">]</span> args<span style="color:#f92672">)</span>
        <span style="color:#f92672">{</span>
                <span style="color:#75715e">// TODO Auto-generated method stub
</span><span style="color:#75715e"></span>                Socket s1 <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
                OutputStream os <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
                InputStream is <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
                DataOutputStream dos <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
                DataInputStream dis <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
                BufferedReader br <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
                <span style="color:#66d9ef">try</span>
                <span style="color:#f92672">{</span>
                        s1 <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Socket<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;127.0.0.1&#34;</span><span style="color:#f92672">,</span>5566<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                        os <span style="color:#f92672">=</span> s1<span style="color:#f92672">.</span><span style="color:#a6e22e">getOutputStream</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                        is <span style="color:#f92672">=</span> s1<span style="color:#f92672">.</span><span style="color:#a6e22e">getInputStream</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                        dos <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> DataOutputStream<span style="color:#f92672">(</span>os<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                        dis <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> DataInputStream<span style="color:#f92672">(</span>is<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                        
                        dos<span style="color:#f92672">.</span><span style="color:#a6e22e">writeUTF</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Come to the world of net server&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                        dos<span style="color:#f92672">.</span><span style="color:#a6e22e">flush</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                        
                        br <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> BufferedReader<span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> InputStreamReader<span style="color:#f92672">(</span>System<span style="color:#f92672">.</span><span style="color:#a6e22e">in</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                        <span style="color:#66d9ef">while</span><span style="color:#f92672">(</span><span style="color:#66d9ef">true</span><span style="color:#f92672">)</span>
                        <span style="color:#f92672">{</span>
                                String str <span style="color:#f92672">=</span> br<span style="color:#f92672">.</span><span style="color:#a6e22e">readLine</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                                dos<span style="color:#f92672">.</span><span style="color:#a6e22e">writeUTF</span><span style="color:#f92672">(</span>str<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                                <span style="color:#66d9ef">if</span><span style="color:#f92672">(</span>str<span style="color:#f92672">.</span><span style="color:#a6e22e">equalsIgnoreCase</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;byebye&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span>
                    <span style="color:#66d9ef">break</span><span style="color:#f92672">;</span>
                str <span style="color:#f92672">=</span> dis<span style="color:#f92672">.</span><span style="color:#a6e22e">readUTF</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;服务器 said that&#34;</span> <span style="color:#f92672">+</span> str<span style="color:#f92672">+</span><span style="color:#e6db74">&#34;\n&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                                <span style="color:#66d9ef">if</span><span style="color:#f92672">(</span>str<span style="color:#f92672">.</span><span style="color:#a6e22e">equalsIgnoreCase</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;byebye&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span>
                    <span style="color:#66d9ef">break</span><span style="color:#f92672">;</span>

                        <span style="color:#f92672">}</span>
                <span style="color:#f92672">}</span> <span style="color:#66d9ef">catch</span> <span style="color:#f92672">(</span>IOException e<span style="color:#f92672">)</span>
                <span style="color:#f92672">{</span>
                        <span style="color:#75715e">// TODO Auto-generated catch block
</span><span style="color:#75715e"></span>                        e<span style="color:#f92672">.</span><span style="color:#a6e22e">printStackTrace</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                <span style="color:#f92672">}</span>
        <span style="color:#f92672">}</span>

<span style="color:#f92672">}</span>
</code></pre></div><p>我遇到了一个问题：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">java<span style="color:#f92672">.</span><span style="color:#a6e22e">net</span><span style="color:#f92672">.</span><span style="color:#a6e22e">SocketException</span><span style="color:#f92672">:</span> socket closed
        at java<span style="color:#f92672">.</span><span style="color:#a6e22e">net</span><span style="color:#f92672">.</span><span style="color:#a6e22e">SocketInputStream</span><span style="color:#f92672">.</span><span style="color:#a6e22e">socketRead0</span><span style="color:#f92672">(</span>Native Method<span style="color:#f92672">)</span>
        at java<span style="color:#f92672">.</span><span style="color:#a6e22e">net</span><span style="color:#f92672">.</span><span style="color:#a6e22e">SocketInputStream</span><span style="color:#f92672">.</span><span style="color:#a6e22e">read</span><span style="color:#f92672">(</span>SocketInputStream<span style="color:#f92672">.</span><span style="color:#a6e22e">java</span><span style="color:#f92672">:</span>150<span style="color:#f92672">)</span>
        at java<span style="color:#f92672">.</span><span style="color:#a6e22e">net</span><span style="color:#f92672">.</span><span style="color:#a6e22e">SocketInputStream</span><span style="color:#f92672">.</span><span style="color:#a6e22e">read</span><span style="color:#f92672">(</span>SocketInputStream<span style="color:#f92672">.</span><span style="color:#a6e22e">java</span><span style="color:#f92672">:</span>121<span style="color:#f92672">)</span>
        at java<span style="color:#f92672">.</span><span style="color:#a6e22e">net</span><span style="color:#f92672">.</span><span style="color:#a6e22e">SocketInputStream</span><span style="color:#f92672">.</span><span style="color:#a6e22e">read</span><span style="color:#f92672">(</span>SocketInputStream<span style="color:#f92672">.</span><span style="color:#a6e22e">java</span><span style="color:#f92672">:</span>203<span style="color:#f92672">)</span>
        at java<span style="color:#f92672">.</span><span style="color:#a6e22e">io</span><span style="color:#f92672">.</span><span style="color:#a6e22e">DataInputStream</span><span style="color:#f92672">.</span><span style="color:#a6e22e">readUnsignedShort</span><span style="color:#f92672">(</span>DataInputStream<span style="color:#f92672">.</span><span style="color:#a6e22e">java</span><span style="color:#f92672">:</span>337<span style="color:#f92672">)</span>
        at java<span style="color:#f92672">.</span><span style="color:#a6e22e">io</span><span style="color:#f92672">.</span><span style="color:#a6e22e">DataInputStream</span><span style="color:#f92672">.</span><span style="color:#a6e22e">readUTF</span><span style="color:#f92672">(</span>DataInputStream<span style="color:#f92672">.</span><span style="color:#a6e22e">java</span><span style="color:#f92672">:</span>589<span style="color:#f92672">)</span>
        at java<span style="color:#f92672">.</span><span style="color:#a6e22e">io</span><span style="color:#f92672">.</span><span style="color:#a6e22e">DataInputStream</span><span style="color:#f92672">.</span><span style="color:#a6e22e">readUTF</span><span style="color:#f92672">(</span>DataInputStream<span style="color:#f92672">.</span><span style="color:#a6e22e">java</span><span style="color:#f92672">:</span>564<span style="color:#f92672">)</span>
        at TestNetwork<span style="color:#f92672">.</span><span style="color:#a6e22e">RewriteTestClient2</span><span style="color:#f92672">.</span><span style="color:#f92672">&lt;</span>init<span style="color:#f92672">&gt;</span><span style="color:#f92672">(</span>RewriteTestClient2<span style="color:#f92672">.</span><span style="color:#a6e22e">java</span><span style="color:#f92672">:</span>52<span style="color:#f92672">)</span>
        at TestNetwork<span style="color:#f92672">.</span><span style="color:#a6e22e">RewriteTestClient2</span><span style="color:#f92672">.</span><span style="color:#a6e22e">main</span><span style="color:#f92672">(</span>RewriteTestClient2<span style="color:#f92672">.</span><span style="color:#a6e22e">java</span><span style="color:#f92672">:</span>100<span style="color:#f92672">)</span>
</code></pre></div><p>于是我删掉了两个finally解决了问题，但是我不明白为什么？</p>
<p>重写了RewriteTestServer3 &amp; RewriteTestClient3 ：
出现的问题： 在客户端连接上后，客户端发送数据可以到服务器端，接着切换到服务器端，但是服务器的输入出现了问题，无论你输入一个字还是n个字都无法切换回客户端了
主要不同点：</p>
<ul>
<li>
<pre><code>    1: 把读和写的过程 从while中脱离出来 变成线程的形式(采用了implements形式出现而不是 extends threads)
</code></pre>
</li>
<li>
<pre><code> 即读线程和写线程
</code></pre>
</li>
<li>
<p>2：把BufferedReader放入到写出线程中 ，因为只有在那边读取控制台的输入字符
3:   把线程的开启部分放在了构造函数中  而不是  main函数中。
步骤：
测试了： 把implements Runnable 该回到extends threads结果一样</p>
<pre><code>       把线程的定义和开启放在main函数，并让dos dis变为static变量，也不能解决问题，依旧是卡在服务器中，无法切回到客户端
</code></pre>
</li>
</ul>
<p>一个有趣的问题：（是不是跟synchronized有关系，没关系，加进去也没什么效果）</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">ServerReWrite21</span> <span style="color:#66d9ef">extends</span> Thread
<span style="color:#f92672">{</span>
        <span style="color:#66d9ef">private</span> DataOutputStream dos <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
        <span style="color:#66d9ef">private</span> BufferedReader br <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
        <span style="color:#66d9ef">private</span> String wordsFromServer <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
        <span style="color:#66d9ef">public</span> <span style="color:#a6e22e">ServerReWrite21</span><span style="color:#f92672">(</span>DataOutputStream dos<span style="color:#f92672">)</span>
        <span style="color:#f92672">{</span>
                <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">dos</span> <span style="color:#f92672">=</span> dos<span style="color:#f92672">;</span>
        <span style="color:#f92672">}</span>
        
        <span style="color:#a6e22e">@Override</span>
        <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">run</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span>
        <span style="color:#f92672">{</span>
                <span style="color:#75715e">//System.out.println(&#34;dos=&#34;+dos);  如果在ServerReWrite21中加入了这句话，则运行客户端之后 直接跳到这边  为什么？？？？？？？
</span></code></pre></div><p>有问题的RewriteTestServer3</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#75715e">/**
</span><span style="color:#75715e">* 解释：
</span><span style="color:#75715e">*/</span>
<span style="color:#f92672">package</span> TestNetwork<span style="color:#f92672">;</span>

<span style="color:#75715e">/**
</span><span style="color:#75715e">* @author    叶昭良
</span><span style="color:#75715e">* @time      2015年3月22日下午4:49:25
</span><span style="color:#75715e">* @version   TestNetworkRewriteTestServer3 V1.0
</span><span style="color:#75715e">* 功能：  
</span><span style="color:#75715e">*         1: 把读和写的过程 从while中脱离出来 变成线程的形式
</span><span style="color:#75715e">*      即读线程和写线程
</span><span style="color:#75715e">*  2：把BufferedReader放入到写出线程中 ，因为只有在那边读取控制台的输入字符
</span><span style="color:#75715e">                步骤：
</span><span style="color:#75715e">* 注意：
</span><span style="color:#75715e">* 掌握：
</span><span style="color:#75715e">                思考：
</span><span style="color:#75715e">* 回顾：
</span><span style="color:#75715e">*/</span>
<span style="color:#f92672">import</span> java.io.*<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.net.*<span style="color:#f92672">;</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">RewriteTestServer31</span>
<span style="color:#f92672">{</span>

        <span style="color:#75715e">/**
</span><span style="color:#75715e">         * @param args 
</span><span style="color:#75715e">         * 原因：
</span><span style="color:#75715e">         * 解决：
</span><span style="color:#75715e">         * 功能：
</span><span style="color:#75715e">         *       思考：        
</span><span style="color:#75715e">         *       步骤：
</span><span style="color:#75715e">         */</span>
        ServerSocket ss <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
        Socket s <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
         DataInputStream dis <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
         DataOutputStream dos <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
         
        <span style="color:#66d9ef">public</span> <span style="color:#a6e22e">RewriteTestServer31</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span>
        <span style="color:#f92672">{</span>
                createConnection<span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                ServerReRead21 sr<span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> ServerReRead21<span style="color:#f92672">(</span>dis<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                ServerReWrite21 sw <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> ServerReWrite21<span style="color:#f92672">(</span>dos<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                sr<span style="color:#f92672">.</span><span style="color:#a6e22e">start</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                sw<span style="color:#f92672">.</span><span style="color:#a6e22e">start</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
        <span style="color:#f92672">}</span>
        
        <span style="color:#75715e">/**
</span><span style="color:#75715e">         * 功能： 创建一个读的连接，用于读取客户端的socket数据
</span><span style="color:#75715e">         *       创建一个写的连接，通过BufferedReader进行缓冲读取System.in的数据
</span><span style="color:#75715e">         *       并通过DataOutputStream发送出去
</span><span style="color:#75715e">         *       思考：        
</span><span style="color:#75715e">         *       步骤：
</span><span style="color:#75715e">         */</span>
        <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">createConnection</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span>
        <span style="color:#f92672">{</span>
                <span style="color:#66d9ef">try</span>
                <span style="color:#f92672">{</span>
                        ss <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> ServerSocket<span style="color:#f92672">(</span>5566<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                        s <span style="color:#f92672">=</span>  ss<span style="color:#f92672">.</span><span style="color:#a6e22e">accept</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                        dis <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> DataInputStream<span style="color:#f92672">(</span>s<span style="color:#f92672">.</span><span style="color:#a6e22e">getInputStream</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                        dos <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> DataOutputStream<span style="color:#f92672">(</span>s<span style="color:#f92672">.</span><span style="color:#a6e22e">getOutputStream</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                        <span style="color:#75715e">//增加了下面两句
</span><span style="color:#75715e"></span>                        dos<span style="color:#f92672">.</span><span style="color:#a6e22e">writeUTF</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;您好！我是服务器想要聊些什么:&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                        dos<span style="color:#f92672">.</span><span style="color:#a6e22e">flush</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                <span style="color:#f92672">}</span><span style="color:#66d9ef">catch</span><span style="color:#f92672">(</span>IOException e<span style="color:#f92672">)</span>
                <span style="color:#f92672">{</span>
                        System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;创建连接问题&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                <span style="color:#f92672">}</span>
        <span style="color:#f92672">}</span>
        <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">main</span><span style="color:#f92672">(</span>String<span style="color:#f92672">[</span><span style="color:#f92672">]</span> args<span style="color:#f92672">)</span>
        <span style="color:#f92672">{</span>
                <span style="color:#75715e">// TODO Auto-generated method stub
</span><span style="color:#75715e"></span>                <span style="color:#66d9ef">new</span> RewriteTestServer31<span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
        <span style="color:#f92672">}</span>

<span style="color:#f92672">}</span>

<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">ServerReRead21</span> <span style="color:#66d9ef">extends</span> Thread
<span style="color:#f92672">{</span>
        <span style="color:#66d9ef">private</span> DataInputStream dis <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
        <span style="color:#66d9ef">private</span> String wordsFromClient <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
        <span style="color:#66d9ef">public</span> <span style="color:#a6e22e">ServerReRead21</span><span style="color:#f92672">(</span>DataInputStream dis<span style="color:#f92672">)</span>
        <span style="color:#f92672">{</span>
                <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">dis</span> <span style="color:#f92672">=</span> dis<span style="color:#f92672">;</span>
        <span style="color:#f92672">}</span>
        <span style="color:#a6e22e">@Override</span>
        <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">run</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span>
        <span style="color:#f92672">{</span>
                <span style="color:#75715e">// TODO Auto-generated method stub
</span><span style="color:#75715e"></span>                <span style="color:#66d9ef">try</span>
                <span style="color:#f92672">{</span>
                        wordsFromClient <span style="color:#f92672">=</span> dis<span style="color:#f92672">.</span><span style="color:#a6e22e">readUTF</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                        System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;客户端对你说：&#34;</span><span style="color:#f92672">+</span>wordsFromClient<span style="color:#f92672">)</span><span style="color:#f92672">;</span>  
                <span style="color:#f92672">}</span> <span style="color:#66d9ef">catch</span> <span style="color:#f92672">(</span>IOException e<span style="color:#f92672">)</span>
                <span style="color:#f92672">{</span>
                        <span style="color:#75715e">// TODO Auto-generated catch block
</span><span style="color:#75715e"></span>                        e<span style="color:#f92672">.</span><span style="color:#a6e22e">printStackTrace</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                <span style="color:#f92672">}</span> 
        <span style="color:#f92672">}</span>
        
<span style="color:#f92672">}</span>

<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">ServerReWrite21</span> <span style="color:#66d9ef">extends</span> Thread
<span style="color:#f92672">{</span>
        <span style="color:#66d9ef">private</span> DataOutputStream dos <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
        <span style="color:#66d9ef">private</span> BufferedReader br <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
        <span style="color:#66d9ef">private</span> String wordsFromServer <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
        <span style="color:#66d9ef">public</span> <span style="color:#a6e22e">ServerReWrite21</span><span style="color:#f92672">(</span>DataOutputStream dos<span style="color:#f92672">)</span>
        <span style="color:#f92672">{</span>
                <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">dos</span> <span style="color:#f92672">=</span> dos<span style="color:#f92672">;</span>
        <span style="color:#f92672">}</span>
        
        <span style="color:#a6e22e">@Override</span>
        <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">run</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span>
        <span style="color:#f92672">{</span>
                <span style="color:#75715e">//System.out.println(&#34;dos=&#34;+dos);
</span><span style="color:#75715e"></span>                <span style="color:#75715e">// TODO Auto-generated method stub
</span><span style="color:#75715e"></span>                br <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> BufferedReader<span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> InputStreamReader<span style="color:#f92672">(</span>System<span style="color:#f92672">.</span><span style="color:#a6e22e">in</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                <span style="color:#66d9ef">while</span><span style="color:#f92672">(</span><span style="color:#66d9ef">true</span><span style="color:#f92672">)</span>
                <span style="color:#f92672">{</span>
                        <span style="color:#66d9ef">try</span>
                        <span style="color:#f92672">{</span>
                                wordsFromServer <span style="color:#f92672">=</span> br<span style="color:#f92672">.</span><span style="color:#a6e22e">readLine</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                                dos<span style="color:#f92672">.</span><span style="color:#a6e22e">writeUTF</span><span style="color:#f92672">(</span>wordsFromServer<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                                <span style="color:#75715e">//要不要break????? if(bye){break}
</span><span style="color:#75715e"></span>                        <span style="color:#f92672">}</span><span style="color:#66d9ef">catch</span><span style="color:#f92672">(</span>IOException e<span style="color:#f92672">)</span>
                        <span style="color:#f92672">{</span>
                                
                        <span style="color:#f92672">}</span>
                <span style="color:#f92672">}</span>
        <span style="color:#f92672">}</span>
        
<span style="color:#f92672">}</span>
</code></pre></div><p>有问题的RewriteTestClient31:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#75715e">/**
</span><span style="color:#75715e">* 解释：
</span><span style="color:#75715e">*/</span>
<span style="color:#f92672">package</span> TestNetwork<span style="color:#f92672">;</span>

<span style="color:#f92672">import</span> java.io.BufferedReader<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.io.DataInputStream<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.io.DataOutputStream<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.io.IOException<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.io.InputStreamReader<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.net.ServerSocket<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.net.Socket<span style="color:#f92672">;</span>

<span style="color:#75715e">/**
</span><span style="color:#75715e">* @author    叶昭良
</span><span style="color:#75715e">* @time      2015年3月22日下午5:12:56
</span><span style="color:#75715e">* @version   TestNetworkRewriteTestClient3 V1.0
</span><span style="color:#75715e">* 功能： 
</span><span style="color:#75715e">                步骤：
</span><span style="color:#75715e">* 注意：
</span><span style="color:#75715e">* 掌握：
</span><span style="color:#75715e">                思考：
</span><span style="color:#75715e">* 回顾：
</span><span style="color:#75715e">*/</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">RewriteTestClient31</span>
<span style="color:#f92672">{</span>

        Socket s <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
        DataInputStream dis <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
    DataOutputStream dos <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
        
        <span style="color:#66d9ef">public</span> <span style="color:#a6e22e">RewriteTestClient31</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span>
        <span style="color:#f92672">{</span>
                createConnection<span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                ClientReRead31 sr <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> ClientReRead31<span style="color:#f92672">(</span>dis<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                ClientReWrite31 sw <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> ClientReWrite31<span style="color:#f92672">(</span>dos<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                sr<span style="color:#f92672">.</span><span style="color:#a6e22e">start</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                sw<span style="color:#f92672">.</span><span style="color:#a6e22e">start</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>        
        <span style="color:#f92672">}</span>
        
        <span style="color:#75715e">/**
</span><span style="color:#75715e">         * 功能： 创建一个读的连接，用于读取客户端的socket数据
</span><span style="color:#75715e">         *       创建一个写的连接，通过BufferedReader进行缓冲读取System.in的数据
</span><span style="color:#75715e">         *       并通过DataOutputStream发送出去
</span><span style="color:#75715e">         *       思考：        
</span><span style="color:#75715e">         *       步骤：
</span><span style="color:#75715e">         */</span>
        <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">createConnection</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span>
        <span style="color:#f92672">{</span>
                <span style="color:#66d9ef">try</span>
                <span style="color:#f92672">{</span>
                        s<span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Socket<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;127.0.0.1&#34;</span><span style="color:#f92672">,</span>5566<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                        dis <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> DataInputStream<span style="color:#f92672">(</span>s<span style="color:#f92672">.</span><span style="color:#a6e22e">getInputStream</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                        dos <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> DataOutputStream<span style="color:#f92672">(</span>s<span style="color:#f92672">.</span><span style="color:#a6e22e">getOutputStream</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                        <span style="color:#75715e">//增加了下面两句
</span><span style="color:#75715e"></span>                        
                <span style="color:#f92672">}</span><span style="color:#66d9ef">catch</span><span style="color:#f92672">(</span>IOException e<span style="color:#f92672">)</span>
                <span style="color:#f92672">{</span>
                        System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;创建连接问题&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                <span style="color:#f92672">}</span>
        <span style="color:#f92672">}</span>
        <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">main</span><span style="color:#f92672">(</span>String<span style="color:#f92672">[</span><span style="color:#f92672">]</span> args<span style="color:#f92672">)</span>
        <span style="color:#f92672">{</span>
                <span style="color:#75715e">// TODO Auto-generated method stub
</span><span style="color:#75715e"></span>                <span style="color:#66d9ef">new</span> RewriteTestClient31<span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>

        <span style="color:#f92672">}</span>

<span style="color:#f92672">}</span>
<span style="color:#75715e">//主要更换地方 wordsFromServer  和服务器的不同地方
</span><span style="color:#75715e"></span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">ClientReRead31</span> <span style="color:#66d9ef">extends</span> Thread
<span style="color:#f92672">{</span>
        <span style="color:#66d9ef">private</span> DataInputStream dis <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
        <span style="color:#66d9ef">private</span> String wordsFromServer  <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
        <span style="color:#66d9ef">public</span> <span style="color:#a6e22e">ClientReRead31</span><span style="color:#f92672">(</span>DataInputStream dis<span style="color:#f92672">)</span>
        <span style="color:#f92672">{</span>
                <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">dis</span> <span style="color:#f92672">=</span> dis<span style="color:#f92672">;</span>
        <span style="color:#f92672">}</span>
        <span style="color:#a6e22e">@Override</span>
        <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">run</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span>
        <span style="color:#f92672">{</span>
                <span style="color:#75715e">// TODO Auto-generated method stub
</span><span style="color:#75715e"></span>                <span style="color:#66d9ef">try</span>
                <span style="color:#f92672">{</span>
                        wordsFromServer <span style="color:#f92672">=</span> dis<span style="color:#f92672">.</span><span style="color:#a6e22e">readUTF</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                        System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;服务器端对你说：&#34;</span><span style="color:#f92672">+</span>wordsFromServer<span style="color:#f92672">)</span><span style="color:#f92672">;</span>  
                <span style="color:#f92672">}</span> <span style="color:#66d9ef">catch</span> <span style="color:#f92672">(</span>IOException e<span style="color:#f92672">)</span>
                <span style="color:#f92672">{</span>
                        <span style="color:#75715e">// TODO Auto-generated catch block
</span><span style="color:#75715e"></span>                        e<span style="color:#f92672">.</span><span style="color:#a6e22e">printStackTrace</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                <span style="color:#f92672">}</span> 
        <span style="color:#f92672">}</span>
        
<span style="color:#f92672">}</span>
<span style="color:#75715e">//主要更换地方 wordsFromClient  和服务器的不同地方
</span><span style="color:#75715e"></span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">ClientReWrite31</span> <span style="color:#66d9ef">extends</span> Thread
<span style="color:#f92672">{</span>
        <span style="color:#66d9ef">private</span> DataOutputStream dos <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
        <span style="color:#66d9ef">private</span> BufferedReader br <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
        <span style="color:#66d9ef">private</span> String  wordsFromClient<span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
        <span style="color:#66d9ef">public</span> <span style="color:#a6e22e">ClientReWrite31</span><span style="color:#f92672">(</span>DataOutputStream dos<span style="color:#f92672">)</span>
        <span style="color:#f92672">{</span>
                <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">dos</span> <span style="color:#f92672">=</span> dos<span style="color:#f92672">;</span>
        <span style="color:#f92672">}</span>
        <span style="color:#a6e22e">@Override</span>
        <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">run</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span>
        <span style="color:#f92672">{</span>
                <span style="color:#75715e">// TODO Auto-generated method stub
</span><span style="color:#75715e"></span>                br <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> BufferedReader<span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> InputStreamReader<span style="color:#f92672">(</span>System<span style="color:#f92672">.</span><span style="color:#a6e22e">in</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                <span style="color:#66d9ef">while</span><span style="color:#f92672">(</span><span style="color:#66d9ef">true</span><span style="color:#f92672">)</span>
                <span style="color:#f92672">{</span>
                        <span style="color:#66d9ef">try</span>
                        <span style="color:#f92672">{</span>
                                wordsFromClient <span style="color:#f92672">=</span> br<span style="color:#f92672">.</span><span style="color:#a6e22e">readLine</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                                dos<span style="color:#f92672">.</span><span style="color:#a6e22e">writeUTF</span><span style="color:#f92672">(</span>wordsFromClient<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                                <span style="color:#75715e">//要不要break????? if(bye){break}
</span><span style="color:#75715e"></span>                        <span style="color:#f92672">}</span><span style="color:#66d9ef">catch</span><span style="color:#f92672">(</span>IOException e<span style="color:#f92672">)</span>
                        <span style="color:#f92672">{</span>
                                
                        <span style="color:#f92672">}</span>
                <span style="color:#f92672">}</span>
        <span style="color:#f92672">}</span>
        
<span style="color:#f92672">}</span>
</code></pre></div><p>如果我把所有的变量定义在main当中则是没有问题的（在implements Runnable)</p>
<p>没问题的版本
RewriteTestServer3extends</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#75715e">/**
</span><span style="color:#75715e">* 解释：
</span><span style="color:#75715e">*/</span>
<span style="color:#f92672">package</span> TestNetwork<span style="color:#f92672">;</span>

<span style="color:#f92672">import</span> java.io.BufferedReader<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.io.DataInputStream<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.io.DataOutputStream<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.io.IOException<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.io.InputStreamReader<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.net.ServerSocket<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.net.Socket<span style="color:#f92672">;</span>

<span style="color:#75715e">/**
</span><span style="color:#75715e">* @author    叶昭良
</span><span style="color:#75715e">* @time      2015年3月22日下午5:57:16
</span><span style="color:#75715e">* @version   TestNetworkRewriteTestServer3extends V1.0
</span><span style="color:#75715e">* 功能： 
</span><span style="color:#75715e">                步骤：
</span><span style="color:#75715e">* 注意：
</span><span style="color:#75715e">* 掌握：
</span><span style="color:#75715e">                思考：
</span><span style="color:#75715e">* 回顾：
</span><span style="color:#75715e">*/</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">RewriteTestServer3extends</span>
<span style="color:#f92672">{</span>

        <span style="color:#75715e">/**
</span><span style="color:#75715e">         * @param args 
</span><span style="color:#75715e">         * 原因：
</span><span style="color:#75715e">         * 解决：
</span><span style="color:#75715e">         * 功能：
</span><span style="color:#75715e">         *       思考：        
</span><span style="color:#75715e">         *       步骤：
</span><span style="color:#75715e">         */</span>
        <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">main</span><span style="color:#f92672">(</span>String<span style="color:#f92672">[</span><span style="color:#f92672">]</span> args<span style="color:#f92672">)</span>
        <span style="color:#f92672">{</span>
                <span style="color:#75715e">// TODO Auto-generated method stub
</span><span style="color:#75715e"></span>                <span style="color:#75715e">// TODO Auto-generated method stub
</span><span style="color:#75715e"></span>        ServerSocket ss <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
        Socket s <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
        DataOutputStream dos  <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
        DataInputStream dis <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
                <span style="color:#66d9ef">try</span>
                <span style="color:#f92672">{</span>
                        ss <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> ServerSocket<span style="color:#f92672">(</span>8888<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                        s <span style="color:#f92672">=</span> ss<span style="color:#f92672">.</span><span style="color:#a6e22e">accept</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                        dos <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> DataOutputStream<span style="color:#f92672">(</span>s<span style="color:#f92672">.</span><span style="color:#a6e22e">getOutputStream</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>

                        dis  <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> DataInputStream<span style="color:#f92672">(</span>s<span style="color:#f92672">.</span><span style="color:#a6e22e">getInputStream</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                       

                <span style="color:#66d9ef">new</span> Thread<span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> ServerReadImp<span style="color:#f92672">(</span>dis<span style="color:#f92672">)</span><span style="color:#f92672">)</span><span style="color:#f92672">.</span><span style="color:#a6e22e">start</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                <span style="color:#66d9ef">new</span> Thread<span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> ServerWriteImp<span style="color:#f92672">(</span>dos<span style="color:#f92672">)</span><span style="color:#f92672">)</span><span style="color:#f92672">.</span><span style="color:#a6e22e">start</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                <span style="color:#f92672">}</span> <span style="color:#66d9ef">catch</span> <span style="color:#f92672">(</span>IOException e<span style="color:#f92672">)</span>
                <span style="color:#f92672">{</span>
                        <span style="color:#75715e">// TODO Auto-generated catch block
</span><span style="color:#75715e"></span>                        e<span style="color:#f92672">.</span><span style="color:#a6e22e">printStackTrace</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                <span style="color:#f92672">}</span>

        <span style="color:#f92672">}</span>

<span style="color:#f92672">}</span>
<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">ServerReadImp</span> <span style="color:#66d9ef">implements</span> Runnable
<span style="color:#f92672">{</span>
    <span style="color:#66d9ef">private</span> DataInputStream dis <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
    <span style="color:#66d9ef">public</span> <span style="color:#a6e22e">ServerReadImp</span><span style="color:#f92672">(</span>DataInputStream dis<span style="color:#f92672">)</span>
    <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">dis</span> <span style="color:#f92672">=</span> dis<span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>

    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">run</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span>
    <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">while</span><span style="color:#f92672">(</span><span style="color:#66d9ef">true</span><span style="color:#f92672">)</span>
        <span style="color:#f92672">{</span>
           <span style="color:#66d9ef">try</span><span style="color:#f92672">{</span>
                String str <span style="color:#f92672">=</span> dis<span style="color:#f92672">.</span><span style="color:#a6e22e">readUTF</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;客户端说:&#34;</span><span style="color:#f92672">+</span>str<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                <span style="color:#66d9ef">if</span><span style="color:#f92672">(</span>str<span style="color:#f92672">.</span><span style="color:#a6e22e">equalsIgnoreCase</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;byebye&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span>
                    <span style="color:#66d9ef">break</span><span style="color:#f92672">;</span>
           <span style="color:#f92672">}</span><span style="color:#66d9ef">catch</span><span style="color:#f92672">(</span>Exception e<span style="color:#f92672">)</span>
           <span style="color:#f92672">{</span>
               e<span style="color:#f92672">.</span><span style="color:#a6e22e">printStackTrace</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
           <span style="color:#f92672">}</span>
        <span style="color:#f92672">}</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">ServerWriteImp</span> <span style="color:#66d9ef">implements</span> Runnable
<span style="color:#f92672">{</span>
    <span style="color:#66d9ef">private</span> DataOutputStream dos <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
    <span style="color:#66d9ef">public</span> <span style="color:#a6e22e">ServerWriteImp</span><span style="color:#f92672">(</span>DataOutputStream dos<span style="color:#f92672">)</span>
    <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">dos</span> <span style="color:#f92672">=</span> dos<span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>

    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">run</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span>
    <span style="color:#f92672">{</span>
        BufferedReader br <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> BufferedReader<span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> InputStreamReader<span style="color:#f92672">(</span>System<span style="color:#f92672">.</span><span style="color:#a6e22e">in</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
        <span style="color:#66d9ef">while</span><span style="color:#f92672">(</span><span style="color:#66d9ef">true</span><span style="color:#f92672">)</span>
        <span style="color:#f92672">{</span>
           <span style="color:#66d9ef">try</span><span style="color:#f92672">{</span>
                String str <span style="color:#f92672">=</span> br<span style="color:#f92672">.</span><span style="color:#a6e22e">readLine</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                dos<span style="color:#f92672">.</span><span style="color:#a6e22e">writeUTF</span><span style="color:#f92672">(</span>str<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                <span style="color:#66d9ef">if</span><span style="color:#f92672">(</span>str<span style="color:#f92672">.</span><span style="color:#a6e22e">equalsIgnoreCase</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;byebye&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span>
                    <span style="color:#66d9ef">break</span><span style="color:#f92672">;</span>
           <span style="color:#f92672">}</span><span style="color:#66d9ef">catch</span><span style="color:#f92672">(</span>Exception e<span style="color:#f92672">)</span>
           <span style="color:#f92672">{</span>
               e<span style="color:#f92672">.</span><span style="color:#a6e22e">printStackTrace</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
           <span style="color:#f92672">}</span>
        <span style="color:#f92672">}</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><p>问题较少的RewriteTestClient3extends</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#75715e">/**
</span><span style="color:#75715e">* 解释：
</span><span style="color:#75715e">*/</span>
<span style="color:#f92672">package</span> TestNetwork<span style="color:#f92672">;</span>

<span style="color:#f92672">import</span> java.io.BufferedReader<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.io.DataInputStream<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.io.DataOutputStream<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.io.InputStreamReader<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.net.Socket<span style="color:#f92672">;</span>

<span style="color:#75715e">/**
</span><span style="color:#75715e">* @author    叶昭良
</span><span style="color:#75715e">* @time      2015年3月22日下午5:57:44
</span><span style="color:#75715e">* @version   TestNetworkRewriteTestClient3extends V1.0
</span><span style="color:#75715e">* 功能： 
</span><span style="color:#75715e">                步骤：
</span><span style="color:#75715e">* 注意：
</span><span style="color:#75715e">* 掌握：
</span><span style="color:#75715e">                思考：
</span><span style="color:#75715e">* 回顾：
</span><span style="color:#75715e">*/</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">RewriteTestClient3extends</span> 
<span style="color:#f92672">{</span>

        <span style="color:#75715e">/**
</span><span style="color:#75715e">         * @param args 
</span><span style="color:#75715e">         * 原因：
</span><span style="color:#75715e">         * 解决：
</span><span style="color:#75715e">         * 功能：
</span><span style="color:#75715e">         *       思考：        
</span><span style="color:#75715e">         *       步骤：
</span><span style="color:#75715e">         */</span>

        <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">main</span><span style="color:#f92672">(</span>String<span style="color:#f92672">[</span><span style="color:#f92672">]</span> args<span style="color:#f92672">)</span> <span style="color:#66d9ef">throws</span> Exception
        <span style="color:#f92672">{</span>
                <span style="color:#75715e">// TODO Auto-generated method stub
</span><span style="color:#75715e"></span>        Socket s <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Socket<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;127.0.0.1&#34;</span><span style="color:#f92672">,</span>8888<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
        DataOutputStream dos <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> DataOutputStream<span style="color:#f92672">(</span>s<span style="color:#f92672">.</span><span style="color:#a6e22e">getOutputStream</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>

        DataInputStream dis <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> DataInputStream<span style="color:#f92672">(</span>s<span style="color:#f92672">.</span><span style="color:#a6e22e">getInputStream</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>

        <span style="color:#66d9ef">new</span> Thread<span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> ClientReadImp<span style="color:#f92672">(</span>dis<span style="color:#f92672">)</span><span style="color:#f92672">)</span><span style="color:#f92672">.</span><span style="color:#a6e22e">start</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
        <span style="color:#66d9ef">new</span> Thread<span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> ClientWriteImp<span style="color:#f92672">(</span>dos<span style="color:#f92672">)</span><span style="color:#f92672">)</span><span style="color:#f92672">.</span><span style="color:#a6e22e">start</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>

        <span style="color:#f92672">}</span>

<span style="color:#f92672">}</span>
<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">ClientReadImp</span> <span style="color:#66d9ef">implements</span> Runnable
<span style="color:#f92672">{</span>
    <span style="color:#66d9ef">private</span> DataInputStream dis <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
    <span style="color:#66d9ef">public</span> <span style="color:#a6e22e">ClientReadImp</span><span style="color:#f92672">(</span>DataInputStream dis<span style="color:#f92672">)</span>
    <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">dis</span> <span style="color:#f92672">=</span> dis<span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>

    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">run</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span>
    <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">while</span><span style="color:#f92672">(</span><span style="color:#66d9ef">true</span><span style="color:#f92672">)</span>
        <span style="color:#f92672">{</span>
           <span style="color:#66d9ef">try</span><span style="color:#f92672">{</span>
                String str <span style="color:#f92672">=</span> dis<span style="color:#f92672">.</span><span style="color:#a6e22e">readUTF</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;服务器说:&#34;</span><span style="color:#f92672">+</span>str<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                <span style="color:#66d9ef">if</span><span style="color:#f92672">(</span>str<span style="color:#f92672">.</span><span style="color:#a6e22e">equalsIgnoreCase</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;byebye&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span>
                    <span style="color:#66d9ef">break</span><span style="color:#f92672">;</span>
           <span style="color:#f92672">}</span><span style="color:#66d9ef">catch</span><span style="color:#f92672">(</span>Exception e<span style="color:#f92672">)</span>
           <span style="color:#f92672">{</span>
               e<span style="color:#f92672">.</span><span style="color:#a6e22e">printStackTrace</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
           <span style="color:#f92672">}</span>
        <span style="color:#f92672">}</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">ClientWriteImp</span> <span style="color:#66d9ef">implements</span> Runnable
<span style="color:#f92672">{</span>
    <span style="color:#66d9ef">private</span> DataOutputStream dos <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
    <span style="color:#66d9ef">public</span> <span style="color:#a6e22e">ClientWriteImp</span><span style="color:#f92672">(</span>DataOutputStream dos<span style="color:#f92672">)</span>
    <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">dos</span> <span style="color:#f92672">=</span> dos<span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>

    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">run</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span>
    <span style="color:#f92672">{</span>
        BufferedReader br <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> BufferedReader<span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> InputStreamReader<span style="color:#f92672">(</span>System<span style="color:#f92672">.</span><span style="color:#a6e22e">in</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
        <span style="color:#66d9ef">while</span><span style="color:#f92672">(</span><span style="color:#66d9ef">true</span><span style="color:#f92672">)</span>
        <span style="color:#f92672">{</span>
           <span style="color:#66d9ef">try</span><span style="color:#f92672">{</span>
                String str <span style="color:#f92672">=</span> br<span style="color:#f92672">.</span><span style="color:#a6e22e">readLine</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                dos<span style="color:#f92672">.</span><span style="color:#a6e22e">writeUTF</span><span style="color:#f92672">(</span>str<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                <span style="color:#66d9ef">if</span><span style="color:#f92672">(</span>str<span style="color:#f92672">.</span><span style="color:#a6e22e">equalsIgnoreCase</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;byebye&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span>
                    <span style="color:#66d9ef">break</span><span style="color:#f92672">;</span>
           <span style="color:#f92672">}</span><span style="color:#66d9ef">catch</span><span style="color:#f92672">(</span>Exception e<span style="color:#f92672">)</span>
           <span style="color:#f92672">{</span>
               e<span style="color:#f92672">.</span><span style="color:#a6e22e">printStackTrace</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
           <span style="color:#f92672">}</span>
        <span style="color:#f92672">}</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><p>可以看到的确是和变量放在哪里有着很大的关系，但是暂时不知道怎么解释？
还有网络编程，当服务器发送过后，是如何切换控制权的？（服务器的run处于while循环中，如何切换，有notify?(在生产和消费当中有wait and notify进行通知）</p>
<p>另外前两个版本（RewriteTCPServer1 RewriteTCPServer2)我进行重新改写则是没有问题，第三个版本(RewriteTCPServer3)加入了线程则是有问题,
所以程序线程+程序变量肯定有一个存在问题，具体不清楚</p>
<p>通过学习第十五节的网络编程，了解到while(true){ss.accept() ;  new线程的作用} 之前TCPServer3和RewriteServer3并没有多线程的效果，得在
服务器当中添加如下代码：增加一个while(true) 让服务器一直在等待连接（不然再ctrl+F11 并没有新的客户端连接服务器）</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">private</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">createConnection</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span>
        <span style="color:#f92672">{</span>
                <span style="color:#66d9ef">try</span>
                <span style="color:#f92672">{</span>
                        ss <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> ServerSocket<span style="color:#f92672">(</span>5566<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                        <span style="color:#66d9ef">while</span><span style="color:#f92672">(</span><span style="color:#66d9ef">true</span><span style="color:#f92672">)</span>
                        <span style="color:#f92672">{</span>
                                s <span style="color:#f92672">=</span>  ss<span style="color:#f92672">.</span><span style="color:#a6e22e">accept</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                                ServerReRead2 sr <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> ServerReRead2<span style="color:#f92672">(</span>dis<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                                ServerReWrite2 sw <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> ServerReWrite2<span style="color:#f92672">(</span>dos<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                                Thread t1 <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Thread<span style="color:#f92672">(</span>sr<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                                Thread t2 <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Thread<span style="color:#f92672">(</span>sw<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                                t1<span style="color:#f92672">.</span><span style="color:#a6e22e">start</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                                t2<span style="color:#f92672">.</span><span style="color:#a6e22e">start</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                                dis <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> DataInputStream<span style="color:#f92672">(</span>s<span style="color:#f92672">.</span><span style="color:#a6e22e">getInputStream</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                                dos <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> DataOutputStream<span style="color:#f92672">(</span>s<span style="color:#f92672">.</span><span style="color:#a6e22e">getOutputStream</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                                <span style="color:#75715e">//增加了下面两句
</span><span style="color:#75715e"></span>                                dos<span style="color:#f92672">.</span><span style="color:#a6e22e">writeUTF</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;您好！我是服务器想要聊些什么:&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                                dos<span style="color:#f92672">.</span><span style="color:#a6e22e">flush</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                        <span style="color:#f92672">}</span>
                                

                <span style="color:#f92672">}</span><span style="color:#66d9ef">catch</span><span style="color:#f92672">(</span>IOException e<span style="color:#f92672">)</span>
                <span style="color:#f92672">{</span>
                        System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;创建连接问题&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                <span style="color:#f92672">}</span>
        <span style="color:#f92672">}</span>
</code></pre></div><p>有了这个意识之后，我发现之前的所谓的多线程的UI版本的TCPServer4 &amp;  TCPClient4也是lier,根本没有实现。
具体是： 一个服务器端对应一个客户端，虽然你写着extends thread，也start了，但是在ss.accept
那边根本就没有循环的接收，暂时进行修改未通过，这是另一个问题。</p>
<p>有进步了。改进了TCPServer4
1：客户端可以新建多个（但是这个多个还是有问题)&mdash;&gt;具体分析socket的while循环放的有问题（有待进一步测试）</p>
<p>问题1：服务器无法发送出去数据
问题2：客户端不切换 还好可以，一切换之后发送一条就卡死了</p>
<p>有问题的
RewriteServer4:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#75715e">/**
</span><span style="color:#75715e">* 解释：
</span><span style="color:#75715e">*/</span>
<span style="color:#f92672">package</span> TestNetwork<span style="color:#f92672">;</span>

<span style="color:#75715e">/**
</span><span style="color:#75715e">* @author    叶昭良
</span><span style="color:#75715e">* @time      2015年3月22日下午10:08:18
</span><span style="color:#75715e">* @version   TestNetworkRewriteTestServer4 V1.0
</span><span style="color:#75715e">* 功能： 
</span><span style="color:#75715e">                步骤：
</span><span style="color:#75715e">* 注意：
</span><span style="color:#75715e">* 掌握：
</span><span style="color:#75715e">                思考：
</span><span style="color:#75715e">* 回顾：
</span><span style="color:#75715e">*/</span>
<span style="color:#f92672">import</span> java.awt.BorderLayout<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.awt.Button<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.awt.Frame<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.awt.Panel<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.awt.TextArea<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.awt.TextField<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.awt.event.ActionEvent<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.awt.event.ActionListener<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.awt.event.WindowAdapter<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.awt.event.WindowEvent<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.io.*<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.net.*<span style="color:#f92672">;</span>

<span style="color:#f92672">import</span> javax.swing.JOptionPane<span style="color:#f92672">;</span>


<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">RewriteTestServer4</span>
<span style="color:#f92672">{</span>

        <span style="color:#75715e">/**
</span><span style="color:#75715e">         * @param args 
</span><span style="color:#75715e">         * 原因：
</span><span style="color:#75715e">         * 解决：
</span><span style="color:#75715e">         * 功能：
</span><span style="color:#75715e">         *       思考：        
</span><span style="color:#75715e">         *       步骤：
</span><span style="color:#75715e">         */</span>
        <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">main</span><span style="color:#f92672">(</span>String<span style="color:#f92672">[</span><span style="color:#f92672">]</span> args<span style="color:#f92672">)</span>
        <span style="color:#f92672">{</span>
                <span style="color:#75715e">// TODO Auto-generated method stub
</span><span style="color:#75715e"></span>                <span style="color:#66d9ef">new</span> TCPServer1<span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">.</span><span style="color:#a6e22e">launch</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
        <span style="color:#f92672">}</span>

<span style="color:#f92672">}</span>


<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">TCPServer1</span>
<span style="color:#f92672">{</span>
        <span style="color:#75715e">// class variables
</span><span style="color:#75715e"></span>        <span style="color:#75715e">// class variables
</span><span style="color:#75715e"></span>        <span style="color:#75715e">// connect
</span><span style="color:#75715e"></span>         <span style="color:#66d9ef">private</span> ServerSocket ss <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
         <span style="color:#66d9ef">private</span> Socket s <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
         <span style="color:#75715e">// data flow
</span><span style="color:#75715e"></span>         <span style="color:#66d9ef">private</span> DataOutputStream dos <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
         <span style="color:#66d9ef">private</span> DataInputStream dis <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
         <span style="color:#75715e">// UI
</span><span style="color:#75715e"></span>         <span style="color:#66d9ef">private</span> Frame f <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
         <span style="color:#66d9ef">private</span> TextArea ta <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
         <span style="color:#66d9ef">private</span> TextField tf <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
         <span style="color:#66d9ef">private</span> Button  bn <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>

       
         <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">launch</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span>
         <span style="color:#f92672">{</span>
             createUI<span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
             connect<span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>

         <span style="color:#f92672">}</span>
        <span style="color:#75715e">// construct member
</span><span style="color:#75715e"></span>        <span style="color:#75715e">/*
</span><span style="color:#75715e">        public TCPServer()
</span><span style="color:#75715e">        {
</span><span style="color:#75715e">
</span><span style="color:#75715e">        }
</span><span style="color:#75715e">        */</span>
        <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">createUI</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span>
        <span style="color:#f92672">{</span>
            Frame f <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Frame<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;服务器&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
            ta <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> TextArea<span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
            tf <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> TextField<span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
            Panel p <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Panel<span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> BorderLayout<span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
            bn <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Button<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;发送&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
            p<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span>tf<span style="color:#f92672">,</span>BorderLayout<span style="color:#f92672">.</span><span style="color:#a6e22e">CENTER</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
            p<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span>bn<span style="color:#f92672">,</span>BorderLayout<span style="color:#f92672">.</span><span style="color:#a6e22e">EAST</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>

            f<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span>ta<span style="color:#f92672">,</span>BorderLayout<span style="color:#f92672">.</span><span style="color:#a6e22e">CENTER</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
            f<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span>p<span style="color:#f92672">,</span>BorderLayout<span style="color:#f92672">.</span><span style="color:#a6e22e">SOUTH</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>

            f<span style="color:#f92672">.</span><span style="color:#a6e22e">setSize</span><span style="color:#f92672">(</span>400<span style="color:#f92672">,</span>200<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
            f<span style="color:#f92672">.</span><span style="color:#a6e22e">setVisible</span><span style="color:#f92672">(</span><span style="color:#66d9ef">true</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
            <span style="color:#75715e">//f.setVisable(true);
</span><span style="color:#75715e"></span><span style="color:#75715e">/*            tf.addActionListener(new TCPServerListener());
</span><span style="color:#75715e">            bn.addActionListener(new TCPServerListener());*/</span>
            f<span style="color:#f92672">.</span><span style="color:#a6e22e">addWindowListener</span><span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> WindowAdapter<span style="color:#f92672">(</span><span style="color:#f92672">)</span>
                    <span style="color:#f92672">{</span>
                        <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">windowClosing</span><span style="color:#f92672">(</span>WindowEvent e<span style="color:#f92672">)</span>
                        <span style="color:#f92672">{</span>
                            System<span style="color:#f92672">.</span><span style="color:#a6e22e">exit</span><span style="color:#f92672">(</span>0<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                        <span style="color:#f92672">}</span>
                    <span style="color:#f92672">}</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
        <span style="color:#f92672">}</span>
        <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">connect</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span>
        <span style="color:#f92672">{</span>
                
            <span style="color:#66d9ef">try</span>
            <span style="color:#f92672">{</span>
                    ss <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> ServerSocket<span style="color:#f92672">(</span>5599<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                    <span style="color:#66d9ef">while</span><span style="color:#f92672">(</span><span style="color:#66d9ef">true</span><span style="color:#f92672">)</span>
                    <span style="color:#f92672">{</span>
                            <span style="color:#75715e">//阻塞这边 等待客户端的连接
</span><span style="color:#75715e"></span>                        s <span style="color:#f92672">=</span> ss<span style="color:#f92672">.</span><span style="color:#a6e22e">accept</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                        dis <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> DataInputStream<span style="color:#f92672">(</span>s<span style="color:#f92672">.</span><span style="color:#a6e22e">getInputStream</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                        dos <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> DataOutputStream<span style="color:#f92672">(</span>s<span style="color:#f92672">.</span><span style="color:#a6e22e">getOutputStream</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                        dos<span style="color:#f92672">.</span><span style="color:#a6e22e">writeUTF</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;欢迎你的到来&#34;</span><span style="color:#f92672">+</span>s<span style="color:#f92672">.</span><span style="color:#a6e22e">getInetAddress</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">.</span><span style="color:#a6e22e">getHostAddress</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                        <span style="color:#66d9ef">new</span> UserReadThread<span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">.</span><span style="color:#a6e22e">start</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                        <span style="color:#66d9ef">new</span> UserWriteThread<span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">.</span><span style="color:#a6e22e">start</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                        System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span>Thread<span style="color:#f92672">.</span><span style="color:#a6e22e">currentThread</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">.</span><span style="color:#a6e22e">getName</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">+</span><span style="color:#e6db74">&#34;已开启&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                    <span style="color:#f92672">}</span>
                
            <span style="color:#f92672">}</span><span style="color:#66d9ef">catch</span><span style="color:#f92672">(</span>Exception e<span style="color:#f92672">)</span>
            <span style="color:#f92672">{</span>
                    System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;服务器端异常&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
               <span style="color:#75715e">// System.exit(0);
</span><span style="color:#75715e"></span>            <span style="color:#f92672">}</span>
        <span style="color:#f92672">}</span>
        <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">close</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span>
        <span style="color:#f92672">{</span>
            <span style="color:#66d9ef">try</span><span style="color:#f92672">{</span>
                ss<span style="color:#f92672">.</span><span style="color:#a6e22e">close</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                s<span style="color:#f92672">.</span><span style="color:#a6e22e">close</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
            <span style="color:#f92672">}</span><span style="color:#66d9ef">catch</span><span style="color:#f92672">(</span>Exception e<span style="color:#f92672">)</span>
            <span style="color:#f92672">{</span>
                System<span style="color:#f92672">.</span><span style="color:#a6e22e">exit</span><span style="color:#f92672">(</span>0<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
            <span style="color:#f92672">}</span>
        <span style="color:#f92672">}</span>
        
        <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">UserReadThread</span> <span style="color:#66d9ef">extends</span> Thread
        <span style="color:#f92672">{</span>
                <span style="color:#a6e22e">@Override</span>
                <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">run</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span>
                <span style="color:#f92672">{</span>
                        <span style="color:#66d9ef">while</span><span style="color:#f92672">(</span><span style="color:#66d9ef">true</span><span style="color:#f92672">)</span>
                <span style="color:#f92672">{</span>
                   <span style="color:#66d9ef">try</span><span style="color:#f92672">{</span>
                        String str <span style="color:#f92672">=</span> dis<span style="color:#f92672">.</span><span style="color:#a6e22e">readUTF</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
              <span style="color:#75715e">//          System.out.println(&#34;对方说:&#34;+str);
</span><span style="color:#75715e"></span>                        ta<span style="color:#f92672">.</span><span style="color:#a6e22e">append</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;客户端说：&#34;</span><span style="color:#f92672">+</span>str<span style="color:#f92672">+</span><span style="color:#e6db74">&#34;\n&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                        <span style="color:#66d9ef">if</span><span style="color:#f92672">(</span>str<span style="color:#f92672">.</span><span style="color:#a6e22e">equalsIgnoreCase</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;再见&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span>
                        <span style="color:#f92672">{</span>
                            close<span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                            System<span style="color:#f92672">.</span><span style="color:#a6e22e">exit</span><span style="color:#f92672">(</span>0<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                        <span style="color:#f92672">}</span>
                   <span style="color:#f92672">}</span><span style="color:#66d9ef">catch</span><span style="color:#f92672">(</span>Exception e<span style="color:#f92672">)</span>
                   <span style="color:#f92672">{</span>
                       JOptionPane<span style="color:#f92672">.</span><span style="color:#a6e22e">showMessageDialog</span><span style="color:#f92672">(</span>f<span style="color:#f92672">,</span><span style="color:#e6db74">&#34;客户端已离开&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                       <span style="color:#66d9ef">return</span><span style="color:#f92672">;</span>
                   <span style="color:#75715e">//    e.printStackTrace();
</span><span style="color:#75715e"></span>                   <span style="color:#f92672">}</span>
                <span style="color:#f92672">}</span>
                <span style="color:#f92672">}</span>
        <span style="color:#f92672">}</span>
        <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">UserWriteThread</span> <span style="color:#66d9ef">extends</span> Thread
        <span style="color:#f92672">{</span>
                <span style="color:#a6e22e">@Override</span>
                <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">run</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span>
                <span style="color:#f92672">{</span>
                tf<span style="color:#f92672">.</span><span style="color:#a6e22e">addActionListener</span><span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> TCPServerListener<span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                bn<span style="color:#f92672">.</span><span style="color:#a6e22e">addActionListener</span><span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> TCPServerListener<span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                <span style="color:#f92672">}</span>
        <span style="color:#f92672">}</span>
        <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">TCPServerListener</span> <span style="color:#66d9ef">implements</span> ActionListener
        <span style="color:#f92672">{</span>
            <span style="color:#a6e22e">@Override</span>
            <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">actionPerformed</span><span style="color:#f92672">(</span>ActionEvent e<span style="color:#f92672">)</span>
            <span style="color:#f92672">{</span>
                   <span style="color:#66d9ef">try</span><span style="color:#f92672">{</span>
                           String str <span style="color:#f92672">=</span> tf<span style="color:#f92672">.</span><span style="color:#a6e22e">getText</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                       <span style="color:#66d9ef">if</span><span style="color:#f92672">(</span><span style="color:#f92672">!</span>str<span style="color:#f92672">.</span><span style="color:#a6e22e">isEmpty</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span>
                       <span style="color:#f92672">{</span>
                               tf<span style="color:#f92672">.</span><span style="color:#a6e22e">setText</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                                ta<span style="color:#f92672">.</span><span style="color:#a6e22e">append</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;服务器说:&#34;</span><span style="color:#f92672">+</span>str<span style="color:#f92672">+</span><span style="color:#e6db74">&#34;\n&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                                dos<span style="color:#f92672">.</span><span style="color:#a6e22e">writeUTF</span><span style="color:#f92672">(</span>str<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                                <span style="color:#66d9ef">if</span><span style="color:#f92672">(</span>str<span style="color:#f92672">.</span><span style="color:#a6e22e">equalsIgnoreCase</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;再见&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span>
                                <span style="color:#f92672">{</span>
                                    close<span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                                    System<span style="color:#f92672">.</span><span style="color:#a6e22e">exit</span><span style="color:#f92672">(</span>0<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                                <span style="color:#f92672">}</span>
                       <span style="color:#f92672">}</span>
                   <span style="color:#f92672">}</span><span style="color:#66d9ef">catch</span><span style="color:#f92672">(</span>Exception e1<span style="color:#f92672">)</span>
                   <span style="color:#f92672">{</span>
                      <span style="color:#75715e">// e.printStackTrace();
</span><span style="color:#75715e"></span>                      System<span style="color:#f92672">.</span><span style="color:#a6e22e">exit</span><span style="color:#f92672">(</span>0<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                   <span style="color:#f92672">}</span> 
            <span style="color:#f92672">}</span>
        <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><p>RewriteTestClient4:
/**</p>
<ul>
<li>解释：
*/
package TestNetwork;</li>
</ul>
<p>import java.awt.BorderLayout;
import java.awt.Button;
import java.awt.Frame;
import java.awt.Panel;
import java.awt.TextArea;
import java.awt.TextField;
import java.awt.event.ActionEvent;
import java.awt.event.ActionListener;
import java.awt.event.WindowAdapter;
import java.awt.event.WindowEvent;
import java.io.DataInputStream;
import java.io.DataOutputStream;
import java.net.Socket;</p>
<p>import javax.swing.JOptionPane;</p>
<p>import TestNetwork.TCPClient.TCPClientListener;</p>
<p>/**</p>
<ul>
<li>
<p>@author    叶昭良</p>
</li>
<li>
<p>@time      2015年3月22日下午10:08:37</p>
</li>
<li>
<p>@version   TestNetworkRewriteTestClient4 V1.0</p>
</li>
<li>
<p>功能：
步骤：</p>
</li>
<li>
<p>注意：</p>
</li>
<li>
<p>掌握：
思考：</p>
</li>
<li>
<p>回顾：
*/
public class RewriteTestClient4
{</p>
<pre><code>  /**
   * @param args 
   * 原因：
   * 解决：
   * 功能：
   *       思考：        
   *       步骤：
   */
  public static void main(String[] args)
  {
          // TODO Auto-generated method stub
           new TCPClient1().launch();
  }
</code></pre>
</li>
</ul>
<p>}</p>
<p>class TCPClient1
{
// class variables
// class variables
// connect
private Socket s = null;
// data flow
private DataOutputStream dos = null;
private DataInputStream dis = null;
// UI
private Frame f = null;
private TextArea ta = null;
private TextField tf = null;
private Button  bn = null;</p>
<pre><code>     public void launch()
     {
         createUI();
         connect();
       //  new ClientRead().start();
        // new ClientWrite().start();
     }
    // construct member
    /*
    public TCPClient()
    {

    }
    */
    public void createUI()
    {
        Frame f = new Frame(&quot;客户端&quot;);
        ta = new TextArea();
        tf = new TextField();
        Panel p = new Panel(new BorderLayout());
        bn = new Button(&quot;发送&quot;);
        p.add(tf,BorderLayout.CENTER);
        p.add(bn,BorderLayout.EAST);

        f.add(ta,BorderLayout.CENTER);
        f.add(p,BorderLayout.SOUTH);

        f.setSize(400,200);
        f.setVisible(true);
        //f.setVisable(true);
            tf.addActionListener(new TCPClientListener());
            bn.addActionListener(new TCPClientListener());
        f.addWindowListener(new WindowAdapter()
                {
                    public void windowClosing(WindowEvent e)
                    {
                        System.exit(0);
                    }
                });
    }
    public void connect()
    {
        try{
            s = new Socket(&quot;127.0.0.2&quot;,5599);
            dis = new DataInputStream(s.getInputStream());
            dos = new DataOutputStream(s.getOutputStream());
                try{
                        //少了这个while不行！则不能循环接收
                        while(true)
                        {
                                      String str = dis.readUTF();
                                   //System.out.println(&quot;对方说:&quot;+str);
                                   ta.append(&quot;服务器说:&quot;+str+&quot;\n&quot;);
                                   if(str.equalsIgnoreCase(&quot;再见&quot;))
                                   {
                                       close();
                                       System.exit(0);
                                   }
                        }
                           
                  }catch(Exception e)
                  {
                      JOptionPane.showMessageDialog(f,&quot;客户端已离开&quot;);
                      return;
                  }
               
        }catch(Exception e)
        {
                System.out.println(&quot;客户端异常&quot;);
            //System.exit(0);
        }
    }
    public void close()
    {
        try{
            dis.close();
            dos.close();
            s.close();
        }catch(Exception e)
        {
            System.exit(0);
        }
    }


    class TCPClientListener implements ActionListener
    {
        @Override
        public void actionPerformed(ActionEvent e)
        {
               try{
                    String str = tf.getText();
                    tf.setText(&quot;&quot;);
                    ta.append(&quot;客户端说:&quot;+str+&quot;\n&quot;);
                    dos.writeUTF(str);
                    if(str.equalsIgnoreCase(&quot;再见&quot;))
                    {
                        close();
                        System.exit(0);
                    }
               }catch(Exception e1)
               {
                  // e.printStackTrace();
                  System.exit(0);
               } 
        }
    }
</code></pre>
<p>}</p>
<pre><code>结果：
![有问题的Server和Client图](/images/java/结果.png)


1： 改用在main方法中定义循环的socket等待试试，即
     ServerSocket ss = new ServerSocket(5599);
        
            while(true)
            {
                    new TCPServer1(ss.accept()).launch();
            }
复制代码
去掉ServerRead那边的一种Connection函数中的循环的socket.accept:

```java
public void connect()
        {
                
            try
            {
                    //while(true)
                    //{
                            //阻塞这边 等待客户端的连接
                        dis = new DataInputStream(s.getInputStream());
                        dos = new DataOutputStream(s.getOutputStream());
                        dos.writeUTF(&quot;欢迎你的到来&quot;+s.getInetAddress().getHostAddress());
                        new UserReadThread().start();
                        new UserWriteThread().start();
                        System.out.println(Thread.currentThread().getName()+&quot;已开启&quot;);
                    //}
</code></pre><p>2: 使用静态代码段的方法，只创建一个UI界面，不再把createUI放在launch当中，否则 只有在连接上客户端会创建客户端的同时也创建了服务器
服务器一直在增加，这不是我们所想的，只要一个服务器，于是采用static方法</p>
<p>至少在这边已经开始注意一个问题： 到底Client的read &amp; write要不要加入线程？ 这边是没有，仅仅是服务器的read &amp; write加入了线程？</p>
<p>具体的RewreiteTestServer4:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#75715e">/**
</span><span style="color:#75715e">* 解释：
</span><span style="color:#75715e">*/</span>
<span style="color:#f92672">package</span> TestNetwork<span style="color:#f92672">;</span>

<span style="color:#75715e">/**
</span><span style="color:#75715e">* @author    叶昭良
</span><span style="color:#75715e">* @time      2015年3月22日下午10:08:18
</span><span style="color:#75715e">* @version   TestNetworkRewriteTestServer4 V1.0
</span><span style="color:#75715e">* 功能： 
</span><span style="color:#75715e">                步骤：
</span><span style="color:#75715e">* 注意：
</span><span style="color:#75715e">* 掌握：
</span><span style="color:#75715e">                思考：
</span><span style="color:#75715e">* 回顾：
</span><span style="color:#75715e">*/</span>
<span style="color:#f92672">import</span> java.awt.BorderLayout<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.awt.Button<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.awt.Frame<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.awt.Panel<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.awt.TextArea<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.awt.TextField<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.awt.event.ActionEvent<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.awt.event.ActionListener<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.awt.event.WindowAdapter<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.awt.event.WindowEvent<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.io.*<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.net.*<span style="color:#f92672">;</span>

<span style="color:#f92672">import</span> javax.swing.JOptionPane<span style="color:#f92672">;</span>


<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">RewriteTestServer4</span>
<span style="color:#f92672">{</span>

        <span style="color:#75715e">/**
</span><span style="color:#75715e">         * @param args 
</span><span style="color:#75715e">         * 原因：
</span><span style="color:#75715e">         * 解决：
</span><span style="color:#75715e">         * 功能：
</span><span style="color:#75715e">         *       思考：        
</span><span style="color:#75715e">         *       步骤：
</span><span style="color:#75715e">         */</span>
        <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">main</span><span style="color:#f92672">(</span>String<span style="color:#f92672">[</span><span style="color:#f92672">]</span> args<span style="color:#f92672">)</span> <span style="color:#66d9ef">throws</span> Exception
        <span style="color:#f92672">{</span>
                <span style="color:#75715e">// TODO Auto-generated method stub
</span><span style="color:#75715e"></span>            ServerSocket ss <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> ServerSocket<span style="color:#f92672">(</span>5599<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
        
            <span style="color:#66d9ef">while</span><span style="color:#f92672">(</span><span style="color:#66d9ef">true</span><span style="color:#f92672">)</span>
            <span style="color:#f92672">{</span>
                    <span style="color:#66d9ef">new</span> TCPServer1<span style="color:#f92672">(</span>ss<span style="color:#f92672">.</span><span style="color:#a6e22e">accept</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span><span style="color:#f92672">.</span><span style="color:#a6e22e">launch</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
            <span style="color:#f92672">}</span>
            
        <span style="color:#f92672">}</span>

<span style="color:#f92672">}</span>


<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">TCPServer1</span>
<span style="color:#f92672">{</span>
        <span style="color:#75715e">// class variables
</span><span style="color:#75715e"></span>        <span style="color:#75715e">// class variables
</span><span style="color:#75715e"></span>        <span style="color:#75715e">// connect
</span><span style="color:#75715e"></span>         
         <span style="color:#66d9ef">private</span> Socket s <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
         <span style="color:#75715e">// data flow
</span><span style="color:#75715e"></span>         <span style="color:#66d9ef">private</span> DataOutputStream dos <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
         <span style="color:#66d9ef">private</span> DataInputStream dis <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
         <span style="color:#75715e">// UI
</span><span style="color:#75715e"></span>         <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> Frame f <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
         <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> TextArea ta <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
         <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> TextField tf <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
         <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> Button  bn <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
         <span style="color:#66d9ef">static</span>
         <span style="color:#f92672">{</span>
                 createUI<span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
         <span style="color:#f92672">}</span>
         <span style="color:#66d9ef">public</span>  <span style="color:#a6e22e">TCPServer1</span><span style="color:#f92672">(</span>Socket s<span style="color:#f92672">)</span>
         <span style="color:#f92672">{</span>
                 <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">s</span> <span style="color:#f92672">=</span> s<span style="color:#f92672">;</span>
         <span style="color:#f92672">}</span>
       
         <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">launch</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span>
         <span style="color:#f92672">{</span>

             connect<span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>

         <span style="color:#f92672">}</span>
        <span style="color:#75715e">// construct member
</span><span style="color:#75715e"></span>        <span style="color:#75715e">/*
</span><span style="color:#75715e">        public TCPServer()
</span><span style="color:#75715e">        {
</span><span style="color:#75715e">
</span><span style="color:#75715e">        }
</span><span style="color:#75715e">        */</span>
        <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">createUI</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span>
        <span style="color:#f92672">{</span>
            Frame f <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Frame<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;服务器&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
            ta <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> TextArea<span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
            tf <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> TextField<span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
            Panel p <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Panel<span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> BorderLayout<span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
            bn <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Button<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;发送&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
            p<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span>tf<span style="color:#f92672">,</span>BorderLayout<span style="color:#f92672">.</span><span style="color:#a6e22e">CENTER</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
            p<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span>bn<span style="color:#f92672">,</span>BorderLayout<span style="color:#f92672">.</span><span style="color:#a6e22e">EAST</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>

            f<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span>ta<span style="color:#f92672">,</span>BorderLayout<span style="color:#f92672">.</span><span style="color:#a6e22e">CENTER</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
            f<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span>p<span style="color:#f92672">,</span>BorderLayout<span style="color:#f92672">.</span><span style="color:#a6e22e">SOUTH</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>

            f<span style="color:#f92672">.</span><span style="color:#a6e22e">setSize</span><span style="color:#f92672">(</span>400<span style="color:#f92672">,</span>200<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
            f<span style="color:#f92672">.</span><span style="color:#a6e22e">setVisible</span><span style="color:#f92672">(</span><span style="color:#66d9ef">true</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
            <span style="color:#75715e">//f.setVisable(true);
</span><span style="color:#75715e"></span><span style="color:#75715e">/*            tf.addActionListener(new TCPServerListener());
</span><span style="color:#75715e">            bn.addActionListener(new TCPServerListener());*/</span>
            f<span style="color:#f92672">.</span><span style="color:#a6e22e">addWindowListener</span><span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> WindowAdapter<span style="color:#f92672">(</span><span style="color:#f92672">)</span>
                    <span style="color:#f92672">{</span>
                        <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">windowClosing</span><span style="color:#f92672">(</span>WindowEvent e<span style="color:#f92672">)</span>
                        <span style="color:#f92672">{</span>
                            System<span style="color:#f92672">.</span><span style="color:#a6e22e">exit</span><span style="color:#f92672">(</span>0<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                        <span style="color:#f92672">}</span>
                    <span style="color:#f92672">}</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
        <span style="color:#f92672">}</span>
        <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">connect</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span>
        <span style="color:#f92672">{</span>
                
            <span style="color:#66d9ef">try</span>
            <span style="color:#f92672">{</span>
                    <span style="color:#75715e">//while(true)
</span><span style="color:#75715e"></span>                    <span style="color:#75715e">//{
</span><span style="color:#75715e"></span>                            <span style="color:#75715e">//阻塞这边 等待客户端的连接
</span><span style="color:#75715e"></span>                        dis <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> DataInputStream<span style="color:#f92672">(</span>s<span style="color:#f92672">.</span><span style="color:#a6e22e">getInputStream</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                        dos <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> DataOutputStream<span style="color:#f92672">(</span>s<span style="color:#f92672">.</span><span style="color:#a6e22e">getOutputStream</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                        dos<span style="color:#f92672">.</span><span style="color:#a6e22e">writeUTF</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;欢迎你的到来&#34;</span><span style="color:#f92672">+</span>s<span style="color:#f92672">.</span><span style="color:#a6e22e">getInetAddress</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">.</span><span style="color:#a6e22e">getHostAddress</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                        <span style="color:#66d9ef">new</span> UserReadThread<span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">.</span><span style="color:#a6e22e">start</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                        <span style="color:#66d9ef">new</span> UserWriteThread<span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">.</span><span style="color:#a6e22e">start</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                        System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span>Thread<span style="color:#f92672">.</span><span style="color:#a6e22e">currentThread</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">.</span><span style="color:#a6e22e">getName</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">+</span><span style="color:#e6db74">&#34;已开启&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                    <span style="color:#75715e">//}
</span><span style="color:#75715e"></span>                
            <span style="color:#f92672">}</span><span style="color:#66d9ef">catch</span><span style="color:#f92672">(</span>Exception e<span style="color:#f92672">)</span>
            <span style="color:#f92672">{</span>
                    System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;服务器端异常&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
               <span style="color:#75715e">// System.exit(0);
</span><span style="color:#75715e"></span>            <span style="color:#f92672">}</span>
        <span style="color:#f92672">}</span>
        <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">close</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span>
        <span style="color:#f92672">{</span>
            <span style="color:#66d9ef">try</span><span style="color:#f92672">{</span>
                s<span style="color:#f92672">.</span><span style="color:#a6e22e">close</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
            <span style="color:#f92672">}</span><span style="color:#66d9ef">catch</span><span style="color:#f92672">(</span>Exception e<span style="color:#f92672">)</span>
            <span style="color:#f92672">{</span>
                System<span style="color:#f92672">.</span><span style="color:#a6e22e">exit</span><span style="color:#f92672">(</span>0<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
            <span style="color:#f92672">}</span>
        <span style="color:#f92672">}</span>
        
        <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">UserReadThread</span> <span style="color:#66d9ef">extends</span> Thread
        <span style="color:#f92672">{</span>
                <span style="color:#a6e22e">@Override</span>
                <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">run</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span>
                <span style="color:#f92672">{</span>
                        <span style="color:#66d9ef">while</span><span style="color:#f92672">(</span><span style="color:#66d9ef">true</span><span style="color:#f92672">)</span>
                <span style="color:#f92672">{</span>
                   <span style="color:#66d9ef">try</span><span style="color:#f92672">{</span>
                        String str <span style="color:#f92672">=</span> dis<span style="color:#f92672">.</span><span style="color:#a6e22e">readUTF</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
              <span style="color:#75715e">//          System.out.println(&#34;对方说:&#34;+str);
</span><span style="color:#75715e"></span>                        ta<span style="color:#f92672">.</span><span style="color:#a6e22e">append</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;客户端说：&#34;</span><span style="color:#f92672">+</span>str<span style="color:#f92672">+</span><span style="color:#e6db74">&#34;\n&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                        <span style="color:#66d9ef">if</span><span style="color:#f92672">(</span>str<span style="color:#f92672">.</span><span style="color:#a6e22e">equalsIgnoreCase</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;再见&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span>
                        <span style="color:#f92672">{</span>
                            close<span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                            System<span style="color:#f92672">.</span><span style="color:#a6e22e">exit</span><span style="color:#f92672">(</span>0<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                        <span style="color:#f92672">}</span>
                   <span style="color:#f92672">}</span><span style="color:#66d9ef">catch</span><span style="color:#f92672">(</span>Exception e<span style="color:#f92672">)</span>
                   <span style="color:#f92672">{</span>
                       JOptionPane<span style="color:#f92672">.</span><span style="color:#a6e22e">showMessageDialog</span><span style="color:#f92672">(</span>f<span style="color:#f92672">,</span><span style="color:#e6db74">&#34;客户端已离开&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                       <span style="color:#66d9ef">return</span><span style="color:#f92672">;</span>
                   <span style="color:#75715e">//    e.printStackTrace();
</span><span style="color:#75715e"></span>                   <span style="color:#f92672">}</span>
                <span style="color:#f92672">}</span>
                <span style="color:#f92672">}</span>
        <span style="color:#f92672">}</span>
        <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">UserWriteThread</span> <span style="color:#66d9ef">extends</span> Thread
        <span style="color:#f92672">{</span>
                <span style="color:#a6e22e">@Override</span>
                <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">run</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span>
                <span style="color:#f92672">{</span>
                tf<span style="color:#f92672">.</span><span style="color:#a6e22e">addActionListener</span><span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> TCPServerListener<span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                bn<span style="color:#f92672">.</span><span style="color:#a6e22e">addActionListener</span><span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> TCPServerListener<span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                <span style="color:#f92672">}</span>
        <span style="color:#f92672">}</span>
        <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">TCPServerListener</span> <span style="color:#66d9ef">implements</span> ActionListener
        <span style="color:#f92672">{</span>
            <span style="color:#a6e22e">@Override</span>
            <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">actionPerformed</span><span style="color:#f92672">(</span>ActionEvent e<span style="color:#f92672">)</span>
            <span style="color:#f92672">{</span>
                   <span style="color:#66d9ef">try</span><span style="color:#f92672">{</span>
                           String str <span style="color:#f92672">=</span> tf<span style="color:#f92672">.</span><span style="color:#a6e22e">getText</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                       <span style="color:#66d9ef">if</span><span style="color:#f92672">(</span><span style="color:#f92672">!</span>str<span style="color:#f92672">.</span><span style="color:#a6e22e">isEmpty</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span>
                       <span style="color:#f92672">{</span>
                               tf<span style="color:#f92672">.</span><span style="color:#a6e22e">setText</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                                ta<span style="color:#f92672">.</span><span style="color:#a6e22e">append</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;服务器说:&#34;</span><span style="color:#f92672">+</span>str<span style="color:#f92672">+</span><span style="color:#e6db74">&#34;\n&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                                dos<span style="color:#f92672">.</span><span style="color:#a6e22e">writeUTF</span><span style="color:#f92672">(</span>str<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                                <span style="color:#66d9ef">if</span><span style="color:#f92672">(</span>str<span style="color:#f92672">.</span><span style="color:#a6e22e">equalsIgnoreCase</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;再见&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span>
                                <span style="color:#f92672">{</span>
                                    close<span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                                    System<span style="color:#f92672">.</span><span style="color:#a6e22e">exit</span><span style="color:#f92672">(</span>0<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                                <span style="color:#f92672">}</span>
                       <span style="color:#f92672">}</span>
                   <span style="color:#f92672">}</span><span style="color:#66d9ef">catch</span><span style="color:#f92672">(</span>Exception e1<span style="color:#f92672">)</span>
                   <span style="color:#f92672">{</span>
                      <span style="color:#75715e">// e.printStackTrace();
</span><span style="color:#75715e"></span>                      System<span style="color:#f92672">.</span><span style="color:#a6e22e">exit</span><span style="color:#f92672">(</span>0<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                   <span style="color:#f92672">}</span> 
            <span style="color:#f92672">}</span>
        <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><p>RewriteClient4:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#75715e">/**
</span><span style="color:#75715e">* 解释：
</span><span style="color:#75715e">*/</span>
<span style="color:#f92672">package</span> TestNetwork<span style="color:#f92672">;</span>

<span style="color:#f92672">import</span> java.awt.BorderLayout<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.awt.Button<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.awt.Frame<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.awt.Panel<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.awt.TextArea<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.awt.TextField<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.awt.event.ActionEvent<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.awt.event.ActionListener<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.awt.event.WindowAdapter<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.awt.event.WindowEvent<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.io.DataInputStream<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.io.DataOutputStream<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.net.Socket<span style="color:#f92672">;</span>

<span style="color:#f92672">import</span> javax.swing.JOptionPane<span style="color:#f92672">;</span>

<span style="color:#f92672">import</span> TestNetwork.TCPClient.TCPClientListener<span style="color:#f92672">;</span>

<span style="color:#75715e">/**
</span><span style="color:#75715e">* @author    叶昭良
</span><span style="color:#75715e">* @time      2015年3月22日下午10:08:37
</span><span style="color:#75715e">* @version   TestNetworkRewriteTestClient4 V1.0
</span><span style="color:#75715e">* 功能： 
</span><span style="color:#75715e">                步骤：
</span><span style="color:#75715e">* 注意：
</span><span style="color:#75715e">* 掌握：
</span><span style="color:#75715e">                思考：
</span><span style="color:#75715e">* 回顾：
</span><span style="color:#75715e">*/</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">RewriteTestClient4</span>
<span style="color:#f92672">{</span>

        <span style="color:#75715e">/**
</span><span style="color:#75715e">         * @param args 
</span><span style="color:#75715e">         * 原因：
</span><span style="color:#75715e">         * 解决：
</span><span style="color:#75715e">         * 功能：
</span><span style="color:#75715e">         *       思考：        
</span><span style="color:#75715e">         *       步骤：
</span><span style="color:#75715e">         */</span>
        <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">main</span><span style="color:#f92672">(</span>String<span style="color:#f92672">[</span><span style="color:#f92672">]</span> args<span style="color:#f92672">)</span>
        <span style="color:#f92672">{</span>
                <span style="color:#75715e">// TODO Auto-generated method stub
</span><span style="color:#75715e"></span>                 <span style="color:#66d9ef">new</span> TCPClient1<span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">.</span><span style="color:#a6e22e">launch</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
        <span style="color:#f92672">}</span>

<span style="color:#f92672">}</span>

<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">TCPClient1</span>
<span style="color:#f92672">{</span>
        <span style="color:#75715e">// class variables
</span><span style="color:#75715e"></span>        <span style="color:#75715e">// class variables
</span><span style="color:#75715e"></span>        <span style="color:#75715e">// connect
</span><span style="color:#75715e"></span>         <span style="color:#66d9ef">private</span> Socket s <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
         <span style="color:#75715e">// data flow
</span><span style="color:#75715e"></span>         <span style="color:#66d9ef">private</span> DataOutputStream dos <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
         <span style="color:#66d9ef">private</span> DataInputStream dis <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
         <span style="color:#75715e">// UI
</span><span style="color:#75715e"></span>         <span style="color:#66d9ef">private</span> Frame f <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
         <span style="color:#66d9ef">private</span> TextArea ta <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
         <span style="color:#66d9ef">private</span> TextField tf <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
         <span style="color:#66d9ef">private</span> Button  bn <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>

       
         <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">launch</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span>
         <span style="color:#f92672">{</span>
             createUI<span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
             connect<span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
           <span style="color:#75715e">//  new ClientRead().start();
</span><span style="color:#75715e"></span>            <span style="color:#75715e">// new ClientWrite().start();
</span><span style="color:#75715e"></span>         <span style="color:#f92672">}</span>
        <span style="color:#75715e">// construct member
</span><span style="color:#75715e"></span>        <span style="color:#75715e">/*
</span><span style="color:#75715e">        public TCPClient()
</span><span style="color:#75715e">        {
</span><span style="color:#75715e">
</span><span style="color:#75715e">        }
</span><span style="color:#75715e">        */</span>
        <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">createUI</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span>
        <span style="color:#f92672">{</span>
            Frame f <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Frame<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;客户端&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
            ta <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> TextArea<span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
            tf <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> TextField<span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
            Panel p <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Panel<span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> BorderLayout<span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
            bn <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Button<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;发送&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
            p<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span>tf<span style="color:#f92672">,</span>BorderLayout<span style="color:#f92672">.</span><span style="color:#a6e22e">CENTER</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
            p<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span>bn<span style="color:#f92672">,</span>BorderLayout<span style="color:#f92672">.</span><span style="color:#a6e22e">EAST</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>

            f<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span>ta<span style="color:#f92672">,</span>BorderLayout<span style="color:#f92672">.</span><span style="color:#a6e22e">CENTER</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
            f<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span>p<span style="color:#f92672">,</span>BorderLayout<span style="color:#f92672">.</span><span style="color:#a6e22e">SOUTH</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>

            f<span style="color:#f92672">.</span><span style="color:#a6e22e">setSize</span><span style="color:#f92672">(</span>400<span style="color:#f92672">,</span>200<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
            f<span style="color:#f92672">.</span><span style="color:#a6e22e">setVisible</span><span style="color:#f92672">(</span><span style="color:#66d9ef">true</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
            <span style="color:#75715e">//f.setVisable(true);
</span><span style="color:#75715e"></span>                tf<span style="color:#f92672">.</span><span style="color:#a6e22e">addActionListener</span><span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> TCPClientListener<span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                bn<span style="color:#f92672">.</span><span style="color:#a6e22e">addActionListener</span><span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> TCPClientListener<span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
            f<span style="color:#f92672">.</span><span style="color:#a6e22e">addWindowListener</span><span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> WindowAdapter<span style="color:#f92672">(</span><span style="color:#f92672">)</span>
                    <span style="color:#f92672">{</span>
                        <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">windowClosing</span><span style="color:#f92672">(</span>WindowEvent e<span style="color:#f92672">)</span>
                        <span style="color:#f92672">{</span>
                            System<span style="color:#f92672">.</span><span style="color:#a6e22e">exit</span><span style="color:#f92672">(</span>0<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                        <span style="color:#f92672">}</span>
                    <span style="color:#f92672">}</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
        <span style="color:#f92672">}</span>
        <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">connect</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span>
        <span style="color:#f92672">{</span>
            <span style="color:#66d9ef">try</span><span style="color:#f92672">{</span>
                s <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Socket<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;127.0.0.1&#34;</span><span style="color:#f92672">,</span>5599<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                dis <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> DataInputStream<span style="color:#f92672">(</span>s<span style="color:#f92672">.</span><span style="color:#a6e22e">getInputStream</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                dos <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> DataOutputStream<span style="color:#f92672">(</span>s<span style="color:#f92672">.</span><span style="color:#a6e22e">getOutputStream</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                    <span style="color:#66d9ef">try</span><span style="color:#f92672">{</span>
                            <span style="color:#75715e">//少了这个while不行！则不能循环接收
</span><span style="color:#75715e"></span>                            <span style="color:#66d9ef">while</span><span style="color:#f92672">(</span><span style="color:#66d9ef">true</span><span style="color:#f92672">)</span>
                            <span style="color:#f92672">{</span>
                                          String str <span style="color:#f92672">=</span> dis<span style="color:#f92672">.</span><span style="color:#a6e22e">readUTF</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                                       <span style="color:#75715e">//System.out.println(&#34;对方说:&#34;+str);
</span><span style="color:#75715e"></span>                                       ta<span style="color:#f92672">.</span><span style="color:#a6e22e">append</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;服务器说:&#34;</span><span style="color:#f92672">+</span>str<span style="color:#f92672">+</span><span style="color:#e6db74">&#34;\n&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                                       <span style="color:#66d9ef">if</span><span style="color:#f92672">(</span>str<span style="color:#f92672">.</span><span style="color:#a6e22e">equalsIgnoreCase</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;再见&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span>
                                       <span style="color:#f92672">{</span>
                                           close<span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                                           System<span style="color:#f92672">.</span><span style="color:#a6e22e">exit</span><span style="color:#f92672">(</span>0<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                                       <span style="color:#f92672">}</span>
                            <span style="color:#f92672">}</span>
                               
                      <span style="color:#f92672">}</span><span style="color:#66d9ef">catch</span><span style="color:#f92672">(</span>Exception e<span style="color:#f92672">)</span>
                      <span style="color:#f92672">{</span>
                          JOptionPane<span style="color:#f92672">.</span><span style="color:#a6e22e">showMessageDialog</span><span style="color:#f92672">(</span>f<span style="color:#f92672">,</span><span style="color:#e6db74">&#34;客户端已离开&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                          <span style="color:#66d9ef">return</span><span style="color:#f92672">;</span>
                      <span style="color:#f92672">}</span>
                   
            <span style="color:#f92672">}</span><span style="color:#66d9ef">catch</span><span style="color:#f92672">(</span>Exception e<span style="color:#f92672">)</span>
            <span style="color:#f92672">{</span>
                    System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;客户端异常&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                <span style="color:#75715e">//System.exit(0);
</span><span style="color:#75715e"></span>            <span style="color:#f92672">}</span>
        <span style="color:#f92672">}</span>
        <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">close</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span>
        <span style="color:#f92672">{</span>
            <span style="color:#66d9ef">try</span><span style="color:#f92672">{</span>
                dis<span style="color:#f92672">.</span><span style="color:#a6e22e">close</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                dos<span style="color:#f92672">.</span><span style="color:#a6e22e">close</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                s<span style="color:#f92672">.</span><span style="color:#a6e22e">close</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
            <span style="color:#f92672">}</span><span style="color:#66d9ef">catch</span><span style="color:#f92672">(</span>Exception e<span style="color:#f92672">)</span>
            <span style="color:#f92672">{</span>
                System<span style="color:#f92672">.</span><span style="color:#a6e22e">exit</span><span style="color:#f92672">(</span>0<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
            <span style="color:#f92672">}</span>
        <span style="color:#f92672">}</span>


        <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">TCPClientListener</span> <span style="color:#66d9ef">implements</span> ActionListener
        <span style="color:#f92672">{</span>
            <span style="color:#a6e22e">@Override</span>
            <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">actionPerformed</span><span style="color:#f92672">(</span>ActionEvent e<span style="color:#f92672">)</span>
            <span style="color:#f92672">{</span>
                   <span style="color:#66d9ef">try</span><span style="color:#f92672">{</span>
                        String str <span style="color:#f92672">=</span> tf<span style="color:#f92672">.</span><span style="color:#a6e22e">getText</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                        tf<span style="color:#f92672">.</span><span style="color:#a6e22e">setText</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                        ta<span style="color:#f92672">.</span><span style="color:#a6e22e">append</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;客户端说:&#34;</span><span style="color:#f92672">+</span>str<span style="color:#f92672">+</span><span style="color:#e6db74">&#34;\n&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                        dos<span style="color:#f92672">.</span><span style="color:#a6e22e">writeUTF</span><span style="color:#f92672">(</span>str<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                        <span style="color:#66d9ef">if</span><span style="color:#f92672">(</span>str<span style="color:#f92672">.</span><span style="color:#a6e22e">equalsIgnoreCase</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;再见&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span>
                        <span style="color:#f92672">{</span>
                            close<span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                            System<span style="color:#f92672">.</span><span style="color:#a6e22e">exit</span><span style="color:#f92672">(</span>0<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                        <span style="color:#f92672">}</span>
                   <span style="color:#f92672">}</span><span style="color:#66d9ef">catch</span><span style="color:#f92672">(</span>Exception e1<span style="color:#f92672">)</span>
                   <span style="color:#f92672">{</span>
                      <span style="color:#75715e">// e.printStackTrace();
</span><span style="color:#75715e"></span>                      System<span style="color:#f92672">.</span><span style="color:#a6e22e">exit</span><span style="color:#f92672">(</span>0<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                   <span style="color:#f92672">}</span> 
            <span style="color:#f92672">}</span>
        <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><p>结果：</p>
<p>通过分析发现，的确是需要把socket.accept放在main中，而不是connection中！ 为什么？ 也许是connection会跳出？ 具体的不太清楚，如果有人知道求证明之。。。。</p>
<p>另外还存在一个问题，为什么服务器发出的数据只是放在第一个连接的地方？ 这是不是跟Client没有线程有关系，如果我也建个clientRead &amp; clientWrite线程？
<img src="/images/java/%E5%88%87%E6%8D%A2%E4%B8%8D%E6%88%90%E9%97%AE%E9%A2%98.png" alt="现在的切换和传递都不成问题"></p>
<p>1：增加了两个ClientRead &amp; ClientWrite两个线程，尝试看一下是否可以群发，
2： 并把socket的创建 提到main当中</p>
<p>Client的重写：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#75715e">/**
</span><span style="color:#75715e">* 解释：
</span><span style="color:#75715e">*/</span>
<span style="color:#f92672">package</span> TestNetwork<span style="color:#f92672">;</span>

<span style="color:#f92672">import</span> java.awt.BorderLayout<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.awt.Button<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.awt.Frame<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.awt.Panel<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.awt.TextArea<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.awt.TextField<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.awt.event.ActionEvent<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.awt.event.ActionListener<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.awt.event.WindowAdapter<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.awt.event.WindowEvent<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.io.BufferedReader<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.io.DataInputStream<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.io.DataOutputStream<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.io.IOException<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.io.InputStreamReader<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.net.Socket<span style="color:#f92672">;</span>

<span style="color:#f92672">import</span> javax.swing.JOptionPane<span style="color:#f92672">;</span>



<span style="color:#75715e">/**
</span><span style="color:#75715e">* @author    叶昭良
</span><span style="color:#75715e">* @time      2015年3月22日下午10:08:37
</span><span style="color:#75715e">* @version   TestNetworkRewriteTestClient4 V1.0
</span><span style="color:#75715e">* 功能： 
</span><span style="color:#75715e">                步骤：
</span><span style="color:#75715e">* 注意：
</span><span style="color:#75715e">* 掌握：
</span><span style="color:#75715e">                思考：
</span><span style="color:#75715e">* 回顾：
</span><span style="color:#75715e">*/</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">RewriteTestClient4</span>
<span style="color:#f92672">{</span>

        <span style="color:#75715e">/**
</span><span style="color:#75715e">         * @param args 
</span><span style="color:#75715e">         * 原因：
</span><span style="color:#75715e">         * 解决：
</span><span style="color:#75715e">         * 功能：
</span><span style="color:#75715e">         *       思考：        
</span><span style="color:#75715e">         *       步骤：
</span><span style="color:#75715e">         */</span>
        <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">main</span><span style="color:#f92672">(</span>String<span style="color:#f92672">[</span><span style="color:#f92672">]</span> args<span style="color:#f92672">)</span>
        <span style="color:#f92672">{</span>
                <span style="color:#75715e">// TODO Auto-generated method stub
</span><span style="color:#75715e"></span>                Socket s  <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
                 <span style="color:#66d9ef">try</span>
                <span style="color:#f92672">{</span>
                        s <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Socket<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;127.0.0.1&#34;</span><span style="color:#f92672">,</span>5599<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                <span style="color:#f92672">}</span> <span style="color:#66d9ef">catch</span> <span style="color:#f92672">(</span>IOException e<span style="color:#f92672">)</span>
                <span style="color:#f92672">{</span>
                        <span style="color:#75715e">// TODO Auto-generated catch block
</span><span style="color:#75715e"></span>                        e<span style="color:#f92672">.</span><span style="color:#a6e22e">printStackTrace</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                <span style="color:#f92672">}</span>
                 <span style="color:#66d9ef">new</span> TCPClient1<span style="color:#f92672">(</span>s<span style="color:#f92672">)</span><span style="color:#f92672">.</span><span style="color:#a6e22e">launch</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
        <span style="color:#f92672">}</span>

<span style="color:#f92672">}</span>

<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">TCPClient1</span>
<span style="color:#f92672">{</span>
        <span style="color:#75715e">// class variables
</span><span style="color:#75715e"></span>        <span style="color:#75715e">// class variables
</span><span style="color:#75715e"></span>        <span style="color:#75715e">// connect
</span><span style="color:#75715e"></span>         <span style="color:#66d9ef">private</span> Socket s <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
         <span style="color:#75715e">// data flow
</span><span style="color:#75715e"></span>         <span style="color:#66d9ef">private</span> DataOutputStream dos <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
         <span style="color:#66d9ef">private</span> DataInputStream dis <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
         <span style="color:#75715e">// UI
</span><span style="color:#75715e"></span>         <span style="color:#66d9ef">private</span> Frame f <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
         <span style="color:#66d9ef">private</span> TextArea ta <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
         <span style="color:#66d9ef">private</span> TextField tf <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
         <span style="color:#66d9ef">private</span> Button  bn <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
         <span style="color:#66d9ef">public</span> <span style="color:#a6e22e">TCPClient1</span><span style="color:#f92672">(</span>Socket s<span style="color:#f92672">)</span>
         <span style="color:#f92672">{</span>
                 <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">s</span> <span style="color:#f92672">=</span> s<span style="color:#f92672">;</span>
         <span style="color:#f92672">}</span>
       
         <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">launch</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span>
         <span style="color:#f92672">{</span>
             createUI<span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
             connect<span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
             <span style="color:#66d9ef">new</span> ClientRead<span style="color:#f92672">(</span>dis<span style="color:#f92672">)</span><span style="color:#f92672">.</span><span style="color:#a6e22e">start</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
             <span style="color:#66d9ef">new</span> ClientWrite<span style="color:#f92672">(</span>dos<span style="color:#f92672">)</span><span style="color:#f92672">.</span><span style="color:#a6e22e">start</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
         <span style="color:#f92672">}</span>
        <span style="color:#75715e">// construct member
</span><span style="color:#75715e"></span>        <span style="color:#75715e">/*
</span><span style="color:#75715e">        public TCPClient()
</span><span style="color:#75715e">        {
</span><span style="color:#75715e">
</span><span style="color:#75715e">        }
</span><span style="color:#75715e">        */</span>
        <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">createUI</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span>
        <span style="color:#f92672">{</span>
            Frame f <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Frame<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;客户端&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
            ta <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> TextArea<span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
            tf <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> TextField<span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
            Panel p <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Panel<span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> BorderLayout<span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
            bn <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Button<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;发送&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
            p<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span>tf<span style="color:#f92672">,</span>BorderLayout<span style="color:#f92672">.</span><span style="color:#a6e22e">CENTER</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
            p<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span>bn<span style="color:#f92672">,</span>BorderLayout<span style="color:#f92672">.</span><span style="color:#a6e22e">EAST</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>

            f<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span>ta<span style="color:#f92672">,</span>BorderLayout<span style="color:#f92672">.</span><span style="color:#a6e22e">CENTER</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
            f<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span>p<span style="color:#f92672">,</span>BorderLayout<span style="color:#f92672">.</span><span style="color:#a6e22e">SOUTH</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>

            f<span style="color:#f92672">.</span><span style="color:#a6e22e">setSize</span><span style="color:#f92672">(</span>400<span style="color:#f92672">,</span>200<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
            f<span style="color:#f92672">.</span><span style="color:#a6e22e">setVisible</span><span style="color:#f92672">(</span><span style="color:#66d9ef">true</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
            <span style="color:#75715e">//f.setVisable(true);
</span><span style="color:#75715e"></span>                tf<span style="color:#f92672">.</span><span style="color:#a6e22e">addActionListener</span><span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> TCPClientListener<span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                bn<span style="color:#f92672">.</span><span style="color:#a6e22e">addActionListener</span><span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> TCPClientListener<span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
            f<span style="color:#f92672">.</span><span style="color:#a6e22e">addWindowListener</span><span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> WindowAdapter<span style="color:#f92672">(</span><span style="color:#f92672">)</span>
                    <span style="color:#f92672">{</span>
                        <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">windowClosing</span><span style="color:#f92672">(</span>WindowEvent e<span style="color:#f92672">)</span>
                        <span style="color:#f92672">{</span>
                            System<span style="color:#f92672">.</span><span style="color:#a6e22e">exit</span><span style="color:#f92672">(</span>0<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                        <span style="color:#f92672">}</span>
                    <span style="color:#f92672">}</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
        <span style="color:#f92672">}</span>
        <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">connect</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span>
        <span style="color:#f92672">{</span>
            <span style="color:#66d9ef">try</span><span style="color:#f92672">{</span>
                
                dis <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> DataInputStream<span style="color:#f92672">(</span>s<span style="color:#f92672">.</span><span style="color:#a6e22e">getInputStream</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                dos <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> DataOutputStream<span style="color:#f92672">(</span>s<span style="color:#f92672">.</span><span style="color:#a6e22e">getOutputStream</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                   
            <span style="color:#f92672">}</span><span style="color:#66d9ef">catch</span><span style="color:#f92672">(</span>Exception e<span style="color:#f92672">)</span>
            <span style="color:#f92672">{</span>
                    System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;客户端异常&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                <span style="color:#75715e">//System.exit(0);
</span><span style="color:#75715e"></span>            <span style="color:#f92672">}</span>
        <span style="color:#f92672">}</span>
        <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">close</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span>
        <span style="color:#f92672">{</span>
            <span style="color:#66d9ef">try</span><span style="color:#f92672">{</span>
                dis<span style="color:#f92672">.</span><span style="color:#a6e22e">close</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                dos<span style="color:#f92672">.</span><span style="color:#a6e22e">close</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                s<span style="color:#f92672">.</span><span style="color:#a6e22e">close</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
            <span style="color:#f92672">}</span><span style="color:#66d9ef">catch</span><span style="color:#f92672">(</span>Exception e<span style="color:#f92672">)</span>
            <span style="color:#f92672">{</span>
                System<span style="color:#f92672">.</span><span style="color:#a6e22e">exit</span><span style="color:#f92672">(</span>0<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
            <span style="color:#f92672">}</span>
        <span style="color:#f92672">}</span>
        <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">ClientRead</span> <span style="color:#66d9ef">extends</span> Thread
        <span style="color:#f92672">{</span>
            <span style="color:#66d9ef">private</span> DataInputStream dis <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
            <span style="color:#66d9ef">public</span> <span style="color:#a6e22e">ClientRead</span><span style="color:#f92672">(</span>DataInputStream dis<span style="color:#f92672">)</span>
            <span style="color:#f92672">{</span>
                <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">dis</span> <span style="color:#f92672">=</span> dis<span style="color:#f92672">;</span>
            <span style="color:#f92672">}</span>

            <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">run</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span>
            <span style="color:#f92672">{</span>
                <span style="color:#66d9ef">while</span><span style="color:#f92672">(</span><span style="color:#66d9ef">true</span><span style="color:#f92672">)</span>
                <span style="color:#f92672">{</span>
                   <span style="color:#66d9ef">try</span><span style="color:#f92672">{</span>
                        String str <span style="color:#f92672">=</span> dis<span style="color:#f92672">.</span><span style="color:#a6e22e">readUTF</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                        ta<span style="color:#f92672">.</span><span style="color:#a6e22e">append</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;服务器说:&#34;</span><span style="color:#f92672">+</span>str<span style="color:#f92672">+</span><span style="color:#e6db74">&#34;\n&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                        <span style="color:#66d9ef">if</span><span style="color:#f92672">(</span>str<span style="color:#f92672">.</span><span style="color:#a6e22e">equalsIgnoreCase</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;再见&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span>
                        <span style="color:#f92672">{</span>
                            close<span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                            System<span style="color:#f92672">.</span><span style="color:#a6e22e">exit</span><span style="color:#f92672">(</span>0<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                        <span style="color:#f92672">}</span>
                        System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;服务器说:&#34;</span><span style="color:#f92672">+</span>str<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                        <span style="color:#66d9ef">if</span><span style="color:#f92672">(</span>str<span style="color:#f92672">.</span><span style="color:#a6e22e">equalsIgnoreCase</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;byebye&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span>
                            <span style="color:#66d9ef">break</span><span style="color:#f92672">;</span>
                   <span style="color:#f92672">}</span><span style="color:#66d9ef">catch</span><span style="color:#f92672">(</span>Exception e<span style="color:#f92672">)</span>
                   <span style="color:#f92672">{</span>
                              JOptionPane<span style="color:#f92672">.</span><span style="color:#a6e22e">showMessageDialog</span><span style="color:#f92672">(</span>f<span style="color:#f92672">,</span><span style="color:#e6db74">&#34;客户端已离开&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                              <span style="color:#66d9ef">return</span><span style="color:#f92672">;</span>
                   <span style="color:#f92672">}</span>
                <span style="color:#f92672">}</span>
            <span style="color:#f92672">}</span>
        <span style="color:#f92672">}</span>
        <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">ClientWrite</span> <span style="color:#66d9ef">extends</span> Thread
        <span style="color:#f92672">{</span>
            <span style="color:#66d9ef">private</span> DataOutputStream dos <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
            <span style="color:#66d9ef">public</span> <span style="color:#a6e22e">ClientWrite</span><span style="color:#f92672">(</span>DataOutputStream dos<span style="color:#f92672">)</span>
            <span style="color:#f92672">{</span>
                <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">dos</span> <span style="color:#f92672">=</span> dos<span style="color:#f92672">;</span>
            <span style="color:#f92672">}</span>

            <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">run</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span>
            <span style="color:#f92672">{</span>
                BufferedReader br <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> BufferedReader<span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> InputStreamReader<span style="color:#f92672">(</span>System<span style="color:#f92672">.</span><span style="color:#a6e22e">in</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                <span style="color:#66d9ef">while</span><span style="color:#f92672">(</span><span style="color:#66d9ef">true</span><span style="color:#f92672">)</span>
                <span style="color:#f92672">{</span>
                   <span style="color:#66d9ef">try</span><span style="color:#f92672">{</span>
                        String str <span style="color:#f92672">=</span> br<span style="color:#f92672">.</span><span style="color:#a6e22e">readLine</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                        dos<span style="color:#f92672">.</span><span style="color:#a6e22e">writeUTF</span><span style="color:#f92672">(</span>str<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                        <span style="color:#66d9ef">if</span><span style="color:#f92672">(</span>str<span style="color:#f92672">.</span><span style="color:#a6e22e">equalsIgnoreCase</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;byebye&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span>
                            <span style="color:#66d9ef">break</span><span style="color:#f92672">;</span>
                   <span style="color:#f92672">}</span><span style="color:#66d9ef">catch</span><span style="color:#f92672">(</span>Exception e<span style="color:#f92672">)</span>
                   <span style="color:#f92672">{</span>
                       e<span style="color:#f92672">.</span><span style="color:#a6e22e">printStackTrace</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                   <span style="color:#f92672">}</span>
                <span style="color:#f92672">}</span>
            <span style="color:#f92672">}</span>
        <span style="color:#f92672">}</span>

        <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">TCPClientListener</span> <span style="color:#66d9ef">implements</span> ActionListener
        <span style="color:#f92672">{</span>
            <span style="color:#a6e22e">@Override</span>
            <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">actionPerformed</span><span style="color:#f92672">(</span>ActionEvent e<span style="color:#f92672">)</span>
            <span style="color:#f92672">{</span>
                   <span style="color:#66d9ef">try</span><span style="color:#f92672">{</span>
                        String str <span style="color:#f92672">=</span> tf<span style="color:#f92672">.</span><span style="color:#a6e22e">getText</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                        tf<span style="color:#f92672">.</span><span style="color:#a6e22e">setText</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                        ta<span style="color:#f92672">.</span><span style="color:#a6e22e">append</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;客户端说:&#34;</span><span style="color:#f92672">+</span>str<span style="color:#f92672">+</span><span style="color:#e6db74">&#34;\n&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                        dos<span style="color:#f92672">.</span><span style="color:#a6e22e">writeUTF</span><span style="color:#f92672">(</span>str<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                        <span style="color:#66d9ef">if</span><span style="color:#f92672">(</span>str<span style="color:#f92672">.</span><span style="color:#a6e22e">equalsIgnoreCase</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;再见&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span>
                        <span style="color:#f92672">{</span>
                            close<span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                            System<span style="color:#f92672">.</span><span style="color:#a6e22e">exit</span><span style="color:#f92672">(</span>0<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                        <span style="color:#f92672">}</span>
                   <span style="color:#f92672">}</span><span style="color:#66d9ef">catch</span><span style="color:#f92672">(</span>Exception e1<span style="color:#f92672">)</span>
                   <span style="color:#f92672">{</span>
                      <span style="color:#75715e">// e.printStackTrace();
</span><span style="color:#75715e"></span>                      System<span style="color:#f92672">.</span><span style="color:#a6e22e">exit</span><span style="color:#f92672">(</span>0<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                   <span style="color:#f92672">}</span> 
            <span style="color:#f92672">}</span>
        <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><p>结果：
结果分析发现，并没有丝毫的改进。what a pity.</p>
<p><img src="/images/java/yiranmeiyou.png" alt="结果还是跟上例的client没有线程一样"></p>
<p>参考此文进行修改：</p>
<p>1：加入了三个主要集合<br>
用户   user_list
线程集
消息集
2：服务器端的主要修正：
1.在线程类的构造函数都添加 了start() 开启线程
2.删掉了ServerWrite &amp;ServerRead线程  都整合到ThreadServer类中
3.增加了一个PrintOutThread用于向客户端发送消息
3：客户端的主要修正：
新建了一个readLineThread() 读取服务器数据，并传递客户端数据
删除了ClientReader  &amp; ClientWriter  &amp; launch等函数</p>
<p>基本能够实现转发的功能，但是
存在的问题：开启多个则计算机变得特别卡</p>
<p>RewriteServer5的实现：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#75715e">/**
</span><span style="color:#75715e">* 解释：
</span><span style="color:#75715e">*/</span>
<span style="color:#f92672">package</span> TestNetwork<span style="color:#f92672">;</span>

<span style="color:#f92672">import</span> java.awt.BorderLayout<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.awt.Button<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.awt.Frame<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.awt.Panel<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.awt.TextArea<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.awt.TextField<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.awt.event.ActionEvent<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.awt.event.ActionListener<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.awt.event.WindowAdapter<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.awt.event.WindowEvent<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.io.DataInputStream<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.io.DataOutputStream<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.io.IOException<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.net.ServerSocket<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.net.Socket<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.util.*<span style="color:#f92672">;</span>





<span style="color:#75715e">/**
</span><span style="color:#75715e">* @author    叶昭良
</span><span style="color:#75715e">* @time      2015年3月23日上午12:41:10
</span><span style="color:#75715e">* @version   TestNetworkRewriteTestServer5 V1.0
</span><span style="color:#75715e">* 功能： 
</span><span style="color:#75715e">                步骤：
</span><span style="color:#75715e">* 注意：
</span><span style="color:#75715e">* 掌握：
</span><span style="color:#75715e">                思考：
</span><span style="color:#75715e">* 回顾：
</span><span style="color:#75715e">*/</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">RewriteTestServer5</span>
<span style="color:#f92672">{</span>

        <span style="color:#75715e">/**
</span><span style="color:#75715e">         * @param args 
</span><span style="color:#75715e">         * 原因：
</span><span style="color:#75715e">         * 解决：
</span><span style="color:#75715e">         * 功能：
</span><span style="color:#75715e">         *       思考：        
</span><span style="color:#75715e">         *       步骤：
</span><span style="color:#75715e">         */</span>
        <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">main</span><span style="color:#f92672">(</span>String<span style="color:#f92672">[</span><span style="color:#f92672">]</span> args<span style="color:#f92672">)</span> <span style="color:#66d9ef">throws</span> Exception
        <span style="color:#f92672">{</span>
                <span style="color:#75715e">// TODO Auto-generated method stub
</span><span style="color:#75715e"></span>            ServerSocket ss <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> ServerSocket<span style="color:#f92672">(</span>5599<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
        <span style="color:#66d9ef">while</span><span style="color:#f92672">(</span><span style="color:#66d9ef">true</span><span style="color:#f92672">)</span>
        <span style="color:#f92672">{</span>
                <span style="color:#66d9ef">new</span> TCPServer2<span style="color:#f92672">(</span>ss<span style="color:#f92672">.</span><span style="color:#a6e22e">accept</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
        <span style="color:#f92672">}</span>
            
        <span style="color:#f92672">}</span>

<span style="color:#f92672">}</span>
<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">TCPServer2</span>
<span style="color:#f92672">{</span>
        <span style="color:#75715e">// class variables
</span><span style="color:#75715e"></span>        <span style="color:#75715e">// class variables
</span><span style="color:#75715e"></span>        <span style="color:#75715e">// connect
</span><span style="color:#75715e"></span>         
         <span style="color:#66d9ef">private</span> Socket s <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
         <span style="color:#75715e">// data flow
</span><span style="color:#75715e"></span>         <span style="color:#66d9ef">private</span> DataOutputStream dos <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
         <span style="color:#66d9ef">private</span> DataInputStream dis <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
         <span style="color:#75715e">// UI
</span><span style="color:#75715e"></span>         <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> Frame f <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
         <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> TextArea ta <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
         <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> TextField tf <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
         <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> Button  bn <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
         
         <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">boolean</span> isPrint <span style="color:#f92672">=</span> <span style="color:#66d9ef">false</span><span style="color:#f92672">;</span><span style="color:#75715e">//是否输出消息标志
</span><span style="color:#75715e"></span>         <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> List user_list <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> ArrayList<span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span><span style="color:#75715e">//登陆用户集合
</span><span style="color:#75715e"></span>         <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> List<span style="color:#f92672">&lt;</span>ServerThread<span style="color:#f92672">&gt;</span> thread_list <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> ArrayList<span style="color:#f92672">&lt;</span>ServerThread<span style="color:#f92672">&gt;</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span><span style="color:#75715e">//服务器已启用的线程集合
</span><span style="color:#75715e"></span>         <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> LinkedList<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">&gt;</span> message_list <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> LinkedList<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">&gt;</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span><span style="color:#75715e">//存放消息队列
</span><span style="color:#75715e"></span>      
         <span style="color:#66d9ef">static</span>
         <span style="color:#f92672">{</span>
                 createUI<span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
         <span style="color:#f92672">}</span>
         <span style="color:#66d9ef">public</span>  <span style="color:#a6e22e">TCPServer2</span><span style="color:#f92672">(</span>Socket s<span style="color:#f92672">)</span> <span style="color:#66d9ef">throws</span> Exception
         <span style="color:#f92672">{</span>
                 <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">s</span> <span style="color:#f92672">=</span> s<span style="color:#f92672">;</span>
                 <span style="color:#66d9ef">new</span> PrintOutThread<span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span><span style="color:#75715e">//创建向客户端发送消息线程
</span><span style="color:#75715e"></span>             <span style="color:#66d9ef">new</span> ServerThread<span style="color:#f92672">(</span><span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">s</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>  
             <span style="color:#75715e">//本以为可以让其线程安全的，没想到没什么效果 反而更卡
</span><span style="color:#75715e"></span><span style="color:#75715e">/*             Collections.synchronizedList(user_list);
</span><span style="color:#75715e">             Collections.synchronizedList(thread_list);
</span><span style="color:#75715e">             Collections.synchronizedList(message_list);*/</span>
            <span style="color:#75715e">// launch();
</span><span style="color:#75715e"></span>                 
         <span style="color:#f92672">}</span>
       
        <span style="color:#75715e">// construct member
</span><span style="color:#75715e"></span>        <span style="color:#75715e">/*
</span><span style="color:#75715e">        public TCPServer()
</span><span style="color:#75715e">        {
</span><span style="color:#75715e">
</span><span style="color:#75715e">        }
</span><span style="color:#75715e">        */</span>
        <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">createUI</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span>
        <span style="color:#f92672">{</span>
            Frame f <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Frame<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;服务器&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
            ta <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> TextArea<span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
            tf <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> TextField<span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
            Panel p <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Panel<span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> BorderLayout<span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
            bn <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Button<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;发送&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
            p<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span>tf<span style="color:#f92672">,</span>BorderLayout<span style="color:#f92672">.</span><span style="color:#a6e22e">CENTER</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
            p<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span>bn<span style="color:#f92672">,</span>BorderLayout<span style="color:#f92672">.</span><span style="color:#a6e22e">EAST</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>

            f<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span>ta<span style="color:#f92672">,</span>BorderLayout<span style="color:#f92672">.</span><span style="color:#a6e22e">CENTER</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
            f<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span>p<span style="color:#f92672">,</span>BorderLayout<span style="color:#f92672">.</span><span style="color:#a6e22e">SOUTH</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>

            f<span style="color:#f92672">.</span><span style="color:#a6e22e">setSize</span><span style="color:#f92672">(</span>400<span style="color:#f92672">,</span>200<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
            f<span style="color:#f92672">.</span><span style="color:#a6e22e">setVisible</span><span style="color:#f92672">(</span><span style="color:#66d9ef">true</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
            <span style="color:#75715e">//f.setVisable(true);
</span><span style="color:#75715e"></span><span style="color:#75715e">/*            tf.addActionListener(new TCPServerListener());
</span><span style="color:#75715e">            bn.addActionListener(new TCPServerListener());*/</span>
            f<span style="color:#f92672">.</span><span style="color:#a6e22e">addWindowListener</span><span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> WindowAdapter<span style="color:#f92672">(</span><span style="color:#f92672">)</span>
                    <span style="color:#f92672">{</span>
                        <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">windowClosing</span><span style="color:#f92672">(</span>WindowEvent e<span style="color:#f92672">)</span>
                        <span style="color:#f92672">{</span>
                            System<span style="color:#f92672">.</span><span style="color:#a6e22e">exit</span><span style="color:#f92672">(</span>0<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                        <span style="color:#f92672">}</span>
                    <span style="color:#f92672">}</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
        <span style="color:#f92672">}</span>
        

        <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">close</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span>
        <span style="color:#f92672">{</span>
            <span style="color:#66d9ef">try</span><span style="color:#f92672">{</span>
                s<span style="color:#f92672">.</span><span style="color:#a6e22e">close</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
            <span style="color:#f92672">}</span><span style="color:#66d9ef">catch</span><span style="color:#f92672">(</span>Exception e<span style="color:#f92672">)</span>
            <span style="color:#f92672">{</span>
                System<span style="color:#f92672">.</span><span style="color:#a6e22e">exit</span><span style="color:#f92672">(</span>0<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
            <span style="color:#f92672">}</span>
        <span style="color:#f92672">}</span>
     
        <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">TCPServerListener</span> <span style="color:#66d9ef">implements</span> ActionListener
        <span style="color:#f92672">{</span>
            <span style="color:#a6e22e">@Override</span>
            <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">actionPerformed</span><span style="color:#f92672">(</span>ActionEvent e<span style="color:#f92672">)</span>
            <span style="color:#f92672">{</span>
                   <span style="color:#66d9ef">try</span><span style="color:#f92672">{</span>
                           String str <span style="color:#f92672">=</span> tf<span style="color:#f92672">.</span><span style="color:#a6e22e">getText</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                       <span style="color:#66d9ef">if</span><span style="color:#f92672">(</span><span style="color:#f92672">!</span>str<span style="color:#f92672">.</span><span style="color:#a6e22e">isEmpty</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span>
                       <span style="color:#f92672">{</span>
                               tf<span style="color:#f92672">.</span><span style="color:#a6e22e">setText</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                                ta<span style="color:#f92672">.</span><span style="color:#a6e22e">append</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;服务器说:&#34;</span><span style="color:#f92672">+</span>str<span style="color:#f92672">+</span><span style="color:#e6db74">&#34;\n&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                                dos<span style="color:#f92672">.</span><span style="color:#a6e22e">writeUTF</span><span style="color:#f92672">(</span>str<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                                <span style="color:#66d9ef">if</span><span style="color:#f92672">(</span>str<span style="color:#f92672">.</span><span style="color:#a6e22e">equalsIgnoreCase</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;再见&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span>
                                <span style="color:#f92672">{</span>
                                    close<span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                                    System<span style="color:#f92672">.</span><span style="color:#a6e22e">exit</span><span style="color:#f92672">(</span>0<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                                <span style="color:#f92672">}</span>
                       <span style="color:#f92672">}</span>
                   <span style="color:#f92672">}</span><span style="color:#66d9ef">catch</span><span style="color:#f92672">(</span>Exception e1<span style="color:#f92672">)</span>
                   <span style="color:#f92672">{</span>
                      <span style="color:#75715e">// e.printStackTrace();
</span><span style="color:#75715e"></span>                      System<span style="color:#f92672">.</span><span style="color:#a6e22e">exit</span><span style="color:#f92672">(</span>0<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                   <span style="color:#f92672">}</span> 
            <span style="color:#f92672">}</span>
        <span style="color:#f92672">}</span>
        
        <span style="color:#75715e">/**
</span><span style="color:#75715e">         * 服务器线程类
</span><span style="color:#75715e">         */</span>
        <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">ServerThread</span> <span style="color:#66d9ef">extends</span> Thread<span style="color:#f92672">{</span>
                <span style="color:#66d9ef">private</span> Socket client<span style="color:#f92672">;</span>
                <span style="color:#66d9ef">private</span> String name <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
                <span style="color:#66d9ef">public</span> <span style="color:#a6e22e">ServerThread</span><span style="color:#f92672">(</span>Socket s<span style="color:#f92672">)</span> <span style="color:#66d9ef">throws</span> Exception
                <span style="color:#f92672">{</span>
                        <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">client</span> <span style="color:#f92672">=</span> s<span style="color:#f92672">;</span>
                        dis <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> DataInputStream<span style="color:#f92672">(</span>client<span style="color:#f92672">.</span><span style="color:#a6e22e">getInputStream</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                dos <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> DataOutputStream<span style="color:#f92672">(</span>client<span style="color:#f92672">.</span><span style="color:#a6e22e">getOutputStream</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                dos<span style="color:#f92672">.</span><span style="color:#a6e22e">writeUTF</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;成功连上服务器&#34;</span><span style="color:#f92672">+</span>client<span style="color:#f92672">.</span><span style="color:#a6e22e">getInetAddress</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">.</span><span style="color:#a6e22e">getHostAddress</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                dos<span style="color:#f92672">.</span><span style="color:#a6e22e">writeUTF</span><span style="color:#f92672">(</span>Thread<span style="color:#f92672">.</span><span style="color:#a6e22e">currentThread</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">.</span><span style="color:#a6e22e">getName</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">+</span><span style="color:#e6db74">&#34;已开启&#34;</span><span style="color:#f92672">+</span><span style="color:#e6db74">&#34;请输入你的姓名&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">start</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                tf<span style="color:#f92672">.</span><span style="color:#a6e22e">addActionListener</span><span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> TCPServerListener<span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                bn<span style="color:#f92672">.</span><span style="color:#a6e22e">addActionListener</span><span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> TCPServerListener<span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                <span style="color:#f92672">}</span>
                <span style="color:#a6e22e">@Override</span>
                <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">run</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span>
                <span style="color:#f92672">{</span>
                        <span style="color:#66d9ef">try</span>
                        <span style="color:#f92672">{</span>
                                <span style="color:#66d9ef">int</span> flag <span style="color:#f92672">=</span> 0 <span style="color:#f92672">;</span>
                                String line <span style="color:#f92672">=</span> dis<span style="color:#f92672">.</span><span style="color:#a6e22e">readUTF</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                                <span style="color:#66d9ef">while</span><span style="color:#f92672">(</span><span style="color:#f92672">!</span><span style="color:#e6db74">&#34;bye&#34;</span><span style="color:#f92672">.</span><span style="color:#a6e22e">equals</span><span style="color:#f92672">(</span>line<span style="color:#f92672">)</span><span style="color:#f92672">)</span>
                                <span style="color:#f92672">{</span>
                                        <span style="color:#75715e">//查看在线用户列表
</span><span style="color:#75715e"></span>                        <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span><span style="color:#e6db74">&#34;showuser&#34;</span><span style="color:#f92672">.</span><span style="color:#a6e22e">equals</span><span style="color:#f92672">(</span>line<span style="color:#f92672">)</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
                            dos<span style="color:#f92672">.</span><span style="color:#a6e22e">writeUTF</span><span style="color:#f92672">(</span><span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">listOnlineUsers</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                            line <span style="color:#f92672">=</span> dis<span style="color:#f92672">.</span><span style="color:#a6e22e">readUTF</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                        <span style="color:#f92672">}</span>
                        <span style="color:#75715e">//第一次进入，保存名字
</span><span style="color:#75715e"></span>
                        <span style="color:#66d9ef">if</span><span style="color:#f92672">(</span>flag<span style="color:#f92672">+</span><span style="color:#f92672">+</span> <span style="color:#f92672">=</span><span style="color:#f92672">=</span>0<span style="color:#f92672">)</span><span style="color:#f92672">{</span>
                            name <span style="color:#f92672">=</span> line<span style="color:#f92672">;</span>
                            user_list<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span>name<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                            thread_list<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span><span style="color:#66d9ef">this</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                            System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;this=&#34;</span><span style="color:#f92672">+</span><span style="color:#66d9ef">this</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                            dos<span style="color:#f92672">.</span><span style="color:#a6e22e">writeUTF</span><span style="color:#f92672">(</span>name <span style="color:#f92672">+</span><span style="color:#e6db74">&#34;你好,可以开始聊天了...&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                            <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">pushMessage</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Client&lt;&#34;</span> <span style="color:#f92672">+</span> name <span style="color:#f92672">+</span><span style="color:#e6db74">&#34;&gt;进入聊天室...+\n&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                            ta<span style="color:#f92672">.</span><span style="color:#a6e22e">append</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Client&lt;&#34;</span> <span style="color:#f92672">+</span> name <span style="color:#f92672">+</span><span style="color:#e6db74">&#34;&gt;进入聊天室...\n&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                        <span style="color:#f92672">}</span><span style="color:#66d9ef">else</span><span style="color:#f92672">{</span>
                                ta<span style="color:#f92672">.</span><span style="color:#a6e22e">append</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Client&lt;&#34;</span> <span style="color:#f92672">+</span> name <span style="color:#f92672">+</span><span style="color:#e6db74">&#34;&gt; say : &#34;</span> <span style="color:#f92672">+</span> line<span style="color:#f92672">+</span><span style="color:#e6db74">&#34;\n&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                                <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">pushMessage</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Client&lt;&#34;</span> <span style="color:#f92672">+</span> name <span style="color:#f92672">+</span><span style="color:#e6db74">&#34;&gt; say : &#34;</span> <span style="color:#f92672">+</span> line<span style="color:#f92672">+</span><span style="color:#e6db74">&#34;\n&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                        <span style="color:#f92672">}</span>
                        line <span style="color:#f92672">=</span> dis<span style="color:#f92672">.</span><span style="color:#a6e22e">readUTF</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                                <span style="color:#f92672">}</span>
                        <span style="color:#f92672">}</span><span style="color:#66d9ef">catch</span><span style="color:#f92672">(</span>IOException e<span style="color:#f92672">)</span>
                        <span style="color:#f92672">{</span>
                                
                        <span style="color:#f92672">}</span>
                <span style="color:#f92672">}</span>
                
                 <span style="color:#75715e">//放入消息队列末尾，准备发送给客户端
</span><span style="color:#75715e"></span>            <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">pushMessage</span><span style="color:#f92672">(</span>String msg<span style="color:#f92672">)</span><span style="color:#f92672">{</span>
                message_list<span style="color:#f92672">.</span><span style="color:#a6e22e">addLast</span><span style="color:#f92672">(</span>msg<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                isPrint <span style="color:#f92672">=</span><span style="color:#66d9ef">true</span><span style="color:#f92672">;</span>
            <span style="color:#f92672">}</span>
              
            <span style="color:#75715e">//向客户端发送一条消息(在PrintOutThread 有使用 于是变成了public修饰)
</span><span style="color:#75715e"></span>            <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">sendMessage</span><span style="color:#f92672">(</span>String msg<span style="color:#f92672">)</span> <span style="color:#66d9ef">throws</span> Exception<span style="color:#f92672">{</span>
                dos<span style="color:#f92672">.</span><span style="color:#a6e22e">writeUTF</span><span style="color:#f92672">(</span>msg<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                dos<span style="color:#f92672">.</span><span style="color:#a6e22e">flush</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
            <span style="color:#f92672">}</span>
              
            <span style="color:#75715e">//统计在线用户列表  需要在showuser中使用  改为public
</span><span style="color:#75715e"></span>            <span style="color:#66d9ef">private</span> String <span style="color:#a6e22e">listOnlineUsers</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
                String s <span style="color:#f92672">=</span><span style="color:#e6db74">&#34;--- 在线用户列表 ---\015\012&#34;</span><span style="color:#f92672">;</span>
                <span style="color:#66d9ef">for</span> <span style="color:#f92672">(</span><span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span>0<span style="color:#f92672">;</span> i <span style="color:#f92672">&lt;</span> user_list<span style="color:#f92672">.</span><span style="color:#a6e22e">size</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span> i<span style="color:#f92672">+</span><span style="color:#f92672">+</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
                    s <span style="color:#f92672">+</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;[&#34;</span> <span style="color:#f92672">+</span> user_list<span style="color:#f92672">.</span><span style="color:#a6e22e">get</span><span style="color:#f92672">(</span>i<span style="color:#f92672">)</span> <span style="color:#f92672">+</span><span style="color:#e6db74">&#34;]\015\012&#34;</span><span style="color:#f92672">;</span>
                <span style="color:#f92672">}</span>
                s <span style="color:#f92672">+</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;--------------------&#34;</span><span style="color:#f92672">;</span>
                <span style="color:#66d9ef">return</span> s<span style="color:#f92672">;</span>
            <span style="color:#f92672">}</span>
        <span style="color:#f92672">}</span>
        <span style="color:#75715e">/**
</span><span style="color:#75715e">         * 监听是否有输出消息请求线程类,向客户端发送消息
</span><span style="color:#75715e">         */</span>
        <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">PrintOutThread</span> <span style="color:#66d9ef">extends</span> Thread
        <span style="color:#f92672">{</span>
            <span style="color:#66d9ef">public</span> <span style="color:#a6e22e">PrintOutThread</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span>
            <span style="color:#f92672">{</span>
                start<span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
            <span style="color:#f92672">}</span>
              
            <span style="color:#a6e22e">@Override</span>
            <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">run</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span> 
            <span style="color:#f92672">{</span>
                <span style="color:#66d9ef">while</span><span style="color:#f92672">(</span><span style="color:#66d9ef">true</span><span style="color:#f92672">)</span><span style="color:#f92672">{</span>
                    <span style="color:#66d9ef">if</span><span style="color:#f92672">(</span>isPrint<span style="color:#f92672">)</span><span style="color:#f92672">{</span><span style="color:#75715e">//将缓存在队列中的消息按顺序发送到各客户端，并从队列中清除。
</span><span style="color:#75715e"></span>                        String message <span style="color:#f92672">=</span> message_list<span style="color:#f92672">.</span><span style="color:#a6e22e">getFirst</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                        <span style="color:#66d9ef">for</span> <span style="color:#f92672">(</span>ServerThread thread <span style="color:#f92672">:</span> thread_list<span style="color:#f92672">)</span> 
                        <span style="color:#f92672">{</span>
                            <span style="color:#66d9ef">try</span>
                                                        <span style="color:#f92672">{</span>
                                                                thread<span style="color:#f92672">.</span><span style="color:#a6e22e">sendMessage</span><span style="color:#f92672">(</span>message<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                                                        <span style="color:#f92672">}</span> <span style="color:#66d9ef">catch</span> <span style="color:#f92672">(</span>Exception e<span style="color:#f92672">)</span>
                                                        <span style="color:#f92672">{</span>
                                                                <span style="color:#75715e">// TODO Auto-generated catch block
</span><span style="color:#75715e"></span>                                                                e<span style="color:#f92672">.</span><span style="color:#a6e22e">printStackTrace</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                                                        <span style="color:#f92672">}</span>
                        <span style="color:#f92672">}</span>
                        message_list<span style="color:#f92672">.</span><span style="color:#a6e22e">removeFirst</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                        isPrint <span style="color:#f92672">=</span> message_list<span style="color:#f92672">.</span><span style="color:#a6e22e">size</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span> <span style="color:#f92672">&gt;</span>0 <span style="color:#f92672">?</span><span style="color:#66d9ef">true</span> <span style="color:#f92672">:</span><span style="color:#66d9ef">false</span><span style="color:#f92672">;</span>
                    <span style="color:#f92672">}</span>
                <span style="color:#f92672">}</span>
            <span style="color:#f92672">}</span>
        <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><p>RewriteClient5的实现：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#75715e">/**
</span><span style="color:#75715e">* 解释：
</span><span style="color:#75715e">*/</span>
<span style="color:#f92672">package</span> TestNetwork<span style="color:#f92672">;</span>

<span style="color:#f92672">import</span> java.awt.BorderLayout<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.awt.Button<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.awt.Frame<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.awt.Panel<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.awt.TextArea<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.awt.TextField<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.awt.event.ActionEvent<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.awt.event.ActionListener<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.awt.event.WindowAdapter<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.awt.event.WindowEvent<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.io.BufferedReader<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.io.DataInputStream<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.io.DataOutputStream<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.io.IOException<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.io.InputStreamReader<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.net.Socket<span style="color:#f92672">;</span>

<span style="color:#f92672">import</span> javax.swing.JOptionPane<span style="color:#f92672">;</span>

<span style="color:#f92672">import</span> TestNetwork.TCPClient1.ClientRead<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> TestNetwork.TCPClient1.ClientWrite<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> TestNetwork.TCPClient1.TCPClientListener<span style="color:#f92672">;</span>

<span style="color:#75715e">/**
</span><span style="color:#75715e">* @author    叶昭良
</span><span style="color:#75715e">* @time      2015年3月23日上午1:57:54
</span><span style="color:#75715e">* @version   TestNetworkRewriteTestClient5 V1.0
</span><span style="color:#75715e">* 功能： 
</span><span style="color:#75715e">                步骤：
</span><span style="color:#75715e">* 注意：
</span><span style="color:#75715e">* 掌握：
</span><span style="color:#75715e">                思考：
</span><span style="color:#75715e">* 回顾：
</span><span style="color:#75715e">*/</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">RewriteTestClient5</span>
<span style="color:#f92672">{</span>

        <span style="color:#75715e">/**
</span><span style="color:#75715e">         * @param args 
</span><span style="color:#75715e">         * 原因：
</span><span style="color:#75715e">         * 解决：
</span><span style="color:#75715e">         * 功能：
</span><span style="color:#75715e">         *       思考：        
</span><span style="color:#75715e">         *       步骤：
</span><span style="color:#75715e">         */</span>
        <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">main</span><span style="color:#f92672">(</span>String<span style="color:#f92672">[</span><span style="color:#f92672">]</span> args<span style="color:#f92672">)</span> <span style="color:#66d9ef">throws</span> Exception
        <span style="color:#f92672">{</span>
                <span style="color:#75715e">// TODO Auto-generated method stub
</span><span style="color:#75715e"></span>                Socket s  <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
                s <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Socket<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;127.0.0.1&#34;</span><span style="color:#f92672">,</span>5599<span style="color:#f92672">)</span><span style="color:#f92672">;</span>

                 <span style="color:#66d9ef">new</span> TCPClient5<span style="color:#f92672">(</span>s<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
        <span style="color:#f92672">}</span>

<span style="color:#f92672">}</span>
<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">TCPClient5</span>
<span style="color:#f92672">{</span>
        <span style="color:#75715e">// class variables
</span><span style="color:#75715e"></span>        <span style="color:#75715e">// class variables
</span><span style="color:#75715e"></span>        <span style="color:#75715e">// connect
</span><span style="color:#75715e"></span>         <span style="color:#66d9ef">private</span> Socket s <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
         <span style="color:#75715e">// data flow
</span><span style="color:#75715e"></span>         <span style="color:#66d9ef">private</span> DataOutputStream dos <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
         <span style="color:#66d9ef">private</span> DataInputStream dis <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
         <span style="color:#75715e">// UI
</span><span style="color:#75715e"></span>         <span style="color:#66d9ef">private</span> Frame f <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
         <span style="color:#66d9ef">private</span> TextArea ta <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
         <span style="color:#66d9ef">private</span> TextField tf <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
         <span style="color:#66d9ef">private</span> Button  bn <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
         
         <span style="color:#75715e">/**
</span><span style="color:#75715e">          * 与服务器连接，并输入发送消息
</span><span style="color:#75715e">          */</span>
         <span style="color:#66d9ef">public</span> <span style="color:#a6e22e">TCPClient5</span><span style="color:#f92672">(</span>Socket s<span style="color:#f92672">)</span> <span style="color:#66d9ef">throws</span> Exception
         <span style="color:#f92672">{</span>
                 <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">s</span> <span style="color:#f92672">=</span> s<span style="color:#f92672">;</span>
                 dis <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> DataInputStream<span style="color:#f92672">(</span>s<span style="color:#f92672">.</span><span style="color:#a6e22e">getInputStream</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
             dos <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> DataOutputStream<span style="color:#f92672">(</span>s<span style="color:#f92672">.</span><span style="color:#a6e22e">getOutputStream</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
             createUI<span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
             <span style="color:#75715e">//new ClientRead(dis);
</span><span style="color:#75715e"></span>             <span style="color:#75715e">//new ClientWrite(dos);
</span><span style="color:#75715e"></span>             <span style="color:#66d9ef">new</span> readLineThread<span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>

         <span style="color:#f92672">}</span>
         <span style="color:#75715e">/**
</span><span style="color:#75715e">          * 用于监听服务器端向客户端发送消息线程类
</span><span style="color:#75715e">          */</span>
  
        <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">createUI</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span>
        <span style="color:#f92672">{</span>
            Frame f <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Frame<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;客户端&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
            ta <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> TextArea<span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
            tf <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> TextField<span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
            Panel p <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Panel<span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> BorderLayout<span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
            bn <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Button<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;发送&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
            p<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span>tf<span style="color:#f92672">,</span>BorderLayout<span style="color:#f92672">.</span><span style="color:#a6e22e">CENTER</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
            p<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span>bn<span style="color:#f92672">,</span>BorderLayout<span style="color:#f92672">.</span><span style="color:#a6e22e">EAST</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>

            f<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span>ta<span style="color:#f92672">,</span>BorderLayout<span style="color:#f92672">.</span><span style="color:#a6e22e">CENTER</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
            f<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span>p<span style="color:#f92672">,</span>BorderLayout<span style="color:#f92672">.</span><span style="color:#a6e22e">SOUTH</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>

            f<span style="color:#f92672">.</span><span style="color:#a6e22e">setSize</span><span style="color:#f92672">(</span>400<span style="color:#f92672">,</span>200<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
            f<span style="color:#f92672">.</span><span style="color:#a6e22e">setVisible</span><span style="color:#f92672">(</span><span style="color:#66d9ef">true</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
            <span style="color:#75715e">//f.setVisable(true);
</span><span style="color:#75715e"></span>                tf<span style="color:#f92672">.</span><span style="color:#a6e22e">addActionListener</span><span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> TCPClientListener<span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                bn<span style="color:#f92672">.</span><span style="color:#a6e22e">addActionListener</span><span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> TCPClientListener<span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
            f<span style="color:#f92672">.</span><span style="color:#a6e22e">addWindowListener</span><span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> WindowAdapter<span style="color:#f92672">(</span><span style="color:#f92672">)</span>
                    <span style="color:#f92672">{</span>
                        <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">windowClosing</span><span style="color:#f92672">(</span>WindowEvent e<span style="color:#f92672">)</span>
                        <span style="color:#f92672">{</span>
                            System<span style="color:#f92672">.</span><span style="color:#a6e22e">exit</span><span style="color:#f92672">(</span>0<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                        <span style="color:#f92672">}</span>
                    <span style="color:#f92672">}</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
        <span style="color:#f92672">}</span>

        <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">close</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span>
        <span style="color:#f92672">{</span>
            <span style="color:#66d9ef">try</span><span style="color:#f92672">{</span>
                dis<span style="color:#f92672">.</span><span style="color:#a6e22e">close</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                dos<span style="color:#f92672">.</span><span style="color:#a6e22e">close</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                s<span style="color:#f92672">.</span><span style="color:#a6e22e">close</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
            <span style="color:#f92672">}</span><span style="color:#66d9ef">catch</span><span style="color:#f92672">(</span>Exception e<span style="color:#f92672">)</span>
            <span style="color:#f92672">{</span>
                System<span style="color:#f92672">.</span><span style="color:#a6e22e">exit</span><span style="color:#f92672">(</span>0<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
            <span style="color:#f92672">}</span>
        <span style="color:#f92672">}</span>
        <span style="color:#75715e">/**
</span><span style="color:#75715e">         * 用于监听服务器端向客户端发送消息线程类
</span><span style="color:#75715e">         */</span>
        <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">readLineThread</span> <span style="color:#66d9ef">extends</span> Thread
        <span style="color:#f92672">{</span>
              
            <span style="color:#66d9ef">private</span> BufferedReader buff <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span><span style="color:#f92672">;</span>
            <span style="color:#66d9ef">public</span> <span style="color:#a6e22e">readLineThread</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">{</span>
                    start<span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                
            <span style="color:#f92672">}</span>
              
            <span style="color:#a6e22e">@Override</span>
            <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">run</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
                <span style="color:#66d9ef">try</span> <span style="color:#f92672">{</span>
                    <span style="color:#66d9ef">while</span><span style="color:#f92672">(</span><span style="color:#66d9ef">true</span><span style="color:#f92672">)</span><span style="color:#f92672">{</span>
                        String result <span style="color:#f92672">=</span> dis<span style="color:#f92672">.</span><span style="color:#a6e22e">readUTF</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                        <span style="color:#66d9ef">if</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;byeClient&#34;</span><span style="color:#f92672">.</span><span style="color:#a6e22e">equals</span><span style="color:#f92672">(</span>result<span style="color:#f92672">)</span><span style="color:#f92672">)</span><span style="color:#f92672">{</span><span style="color:#75715e">//客户端申请退出，服务端返回确认退出
</span><span style="color:#75715e"></span>                            <span style="color:#66d9ef">break</span><span style="color:#f92672">;</span>
                        <span style="color:#f92672">}</span><span style="color:#66d9ef">else</span><span style="color:#f92672">{</span><span style="color:#75715e">//输出服务端发送消息
</span><span style="color:#75715e"></span>                                <span style="color:#75715e">//ta.append(result);
</span><span style="color:#75715e"></span>                            System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span>result<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                           <span style="color:#75715e">// dos.writeUTF(result);
</span><span style="color:#75715e"></span>                            ta<span style="color:#f92672">.</span><span style="color:#a6e22e">append</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;服务器传递说:&#34;</span><span style="color:#f92672">+</span>result<span style="color:#f92672">+</span><span style="color:#e6db74">&#34;\n&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                            <span style="color:#66d9ef">if</span><span style="color:#f92672">(</span>result<span style="color:#f92672">.</span><span style="color:#a6e22e">equalsIgnoreCase</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;再见&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span>
                            <span style="color:#f92672">{</span>
                                close<span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                                System<span style="color:#f92672">.</span><span style="color:#a6e22e">exit</span><span style="color:#f92672">(</span>0<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                            <span style="color:#f92672">}</span>
                        <span style="color:#f92672">}</span>
                    <span style="color:#f92672">}</span>
                <span style="color:#f92672">}</span><span style="color:#66d9ef">catch</span> <span style="color:#f92672">(</span>Exception e<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
                <span style="color:#f92672">}</span>
            <span style="color:#f92672">}</span>
        <span style="color:#f92672">}</span>
        
        <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">TCPClientListener</span> <span style="color:#66d9ef">implements</span> ActionListener
        <span style="color:#f92672">{</span>
            <span style="color:#a6e22e">@Override</span>
            <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">actionPerformed</span><span style="color:#f92672">(</span>ActionEvent e<span style="color:#f92672">)</span>
            <span style="color:#f92672">{</span>
                   <span style="color:#66d9ef">try</span><span style="color:#f92672">{</span>
                        String str <span style="color:#f92672">=</span> tf<span style="color:#f92672">.</span><span style="color:#a6e22e">getText</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                        tf<span style="color:#f92672">.</span><span style="color:#a6e22e">setText</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                        ta<span style="color:#f92672">.</span><span style="color:#a6e22e">append</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;客户端说:&#34;</span><span style="color:#f92672">+</span>str<span style="color:#f92672">+</span><span style="color:#e6db74">&#34;\n&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                        dos<span style="color:#f92672">.</span><span style="color:#a6e22e">writeUTF</span><span style="color:#f92672">(</span>str<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                        <span style="color:#66d9ef">if</span><span style="color:#f92672">(</span>str<span style="color:#f92672">.</span><span style="color:#a6e22e">equalsIgnoreCase</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;再见&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span>
                        <span style="color:#f92672">{</span>
                            close<span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                            System<span style="color:#f92672">.</span><span style="color:#a6e22e">exit</span><span style="color:#f92672">(</span>0<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                        <span style="color:#f92672">}</span>
                   <span style="color:#f92672">}</span><span style="color:#66d9ef">catch</span><span style="color:#f92672">(</span>Exception e1<span style="color:#f92672">)</span>
                   <span style="color:#f92672">{</span>
                      <span style="color:#75715e">// e.printStackTrace();
</span><span style="color:#75715e"></span>                      System<span style="color:#f92672">.</span><span style="color:#a6e22e">exit</span><span style="color:#f92672">(</span>0<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                   <span style="color:#f92672">}</span> 
            <span style="color:#f92672">}</span>
        <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>

</code></pre></div><p>结果： 还有一问题待解决，运行多个界面，程序占用内存过大！！！！！！ 如何解决？？</p>
<p><img src="/images/java/jiben.png" alt="服务器转发客户端实现局部聊天"></p>
<p>还有一个问题：服务器说的话只能发给一个人。</p>
<p>解决办法：
修改TCPServerListener的实现：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">private</span> ServerThread st <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
                <span style="color:#66d9ef">public</span> <span style="color:#a6e22e">TCPServerListener</span><span style="color:#f92672">(</span>ServerThread s<span style="color:#f92672">)</span>
                <span style="color:#f92672">{</span>
                        st <span style="color:#f92672">=</span>s <span style="color:#f92672">;</span>
                <span style="color:#f92672">}</span>
</code></pre></div><p>并在actionPerformed中增加 st.pushMessage();</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">                   <span style="color:#66d9ef">try</span><span style="color:#f92672">{</span>
                           String str <span style="color:#f92672">=</span> tf<span style="color:#f92672">.</span><span style="color:#a6e22e">getText</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                       <span style="color:#66d9ef">if</span><span style="color:#f92672">(</span><span style="color:#f92672">!</span>str<span style="color:#f92672">.</span><span style="color:#a6e22e">isEmpty</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span>
                       <span style="color:#f92672">{</span>
                                       tf<span style="color:#f92672">.</span><span style="color:#a6e22e">setText</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                                ta<span style="color:#f92672">.</span><span style="color:#a6e22e">append</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;服务器说:&#34;</span><span style="color:#f92672">+</span>str<span style="color:#f92672">+</span><span style="color:#e6db74">&#34;\n&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                                dos<span style="color:#f92672">.</span><span style="color:#a6e22e">writeUTF</span><span style="color:#f92672">(</span>str<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                                <span style="color:#66d9ef">if</span><span style="color:#f92672">(</span>str<span style="color:#f92672">.</span><span style="color:#a6e22e">equalsIgnoreCase</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;再见&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span>
                                <span style="color:#f92672">{</span>
                                    close<span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                                    System<span style="color:#f92672">.</span><span style="color:#a6e22e">exit</span><span style="color:#f92672">(</span>0<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                                <span style="color:#f92672">}</span>
                                <span style="color:#75715e">//ta.append(&#34;Client&lt;&#34; + name +&#34;&gt; say : &#34; + line+&#34;\n&#34;);
</span><span style="color:#75715e"></span>                                st<span style="color:#f92672">.</span><span style="color:#a6e22e">pushMessage</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;服务器说:&#34;</span><span style="color:#f92672">+</span>str<span style="color:#f92672">+</span><span style="color:#e6db74">&#34;\n&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                       <span style="color:#f92672">}</span>
</code></pre></div><p>当然在ServerThread服务器线程类中，增加</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">private</span> ServerThread st <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span> <span style="color:#75715e">// 受到启发的作用！！ Client=s
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">st</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span><span style="color:#f92672">;</span>
的确这样修改完有效果<span style="color:#960050;background-color:#1e0010">，</span>能够群发了<span style="color:#960050;background-color:#1e0010">，</span>但是就是有些哥们的客户端发的是两条重复信息<span style="color:#960050;background-color:#1e0010">，</span>有些却是一条<span style="color:#960050;background-color:#1e0010">。</span>


重要修改<span style="color:#960050;background-color:#1e0010">，</span>能够保证服务器发的信息不至于发太多给某一个客户端<span style="color:#960050;background-color:#1e0010">：</span>
                           String str <span style="color:#f92672">=</span> tf<span style="color:#f92672">.</span><span style="color:#a6e22e">getText</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                       <span style="color:#66d9ef">if</span><span style="color:#f92672">(</span><span style="color:#f92672">!</span>str<span style="color:#f92672">.</span><span style="color:#a6e22e">isEmpty</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span>
                       <span style="color:#f92672">{</span>
                                       tf<span style="color:#f92672">.</span><span style="color:#a6e22e">setText</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                                ta<span style="color:#f92672">.</span><span style="color:#a6e22e">append</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;服务器说:&#34;</span><span style="color:#f92672">+</span>str<span style="color:#f92672">+</span><span style="color:#e6db74">&#34;\n&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                                <span style="color:#75715e">//dos.writeUTF(str);  //如果不注释掉 其中有一个用户会得到两条重复信息，都把他放在message_list中进行转发，而不是特例的一个利用dos.writeUTF(str)
</span><span style="color:#75715e"></span>                                <span style="color:#66d9ef">if</span><span style="color:#f92672">(</span>str<span style="color:#f92672">.</span><span style="color:#a6e22e">equalsIgnoreCase</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;再见&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span>
                                <span style="color:#f92672">{</span>
                                    close<span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                                    System<span style="color:#f92672">.</span><span style="color:#a6e22e">exit</span><span style="color:#f92672">(</span>0<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                                <span style="color:#f92672">}</span>
                               
                                st<span style="color:#f92672">.</span><span style="color:#a6e22e">pushMessage</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;服务器说:&#34;</span><span style="color:#f92672">+</span>str<span style="color:#f92672">+</span><span style="color:#e6db74">&#34;\n&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                       <span style="color:#f92672">}</span>



</code></pre></div><p>基于此我们的Server端如下：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#75715e">/**
</span><span style="color:#75715e">* 解释：
</span><span style="color:#75715e">*/</span>
<span style="color:#f92672">package</span> TestNetwork<span style="color:#f92672">;</span>

<span style="color:#f92672">import</span> java.awt.BorderLayout<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.awt.Button<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.awt.Frame<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.awt.Panel<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.awt.TextArea<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.awt.TextField<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.awt.event.ActionEvent<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.awt.event.ActionListener<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.awt.event.WindowAdapter<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.awt.event.WindowEvent<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.io.DataInputStream<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.io.DataOutputStream<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.io.IOException<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.net.ServerSocket<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.net.Socket<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.util.*<span style="color:#f92672">;</span>





<span style="color:#75715e">/**
</span><span style="color:#75715e">* @author    叶昭良
</span><span style="color:#75715e">* @time      2015年3月23日上午12:41:10
</span><span style="color:#75715e">* @version   TestNetworkRewriteTestServer5 V1.0
</span><span style="color:#75715e">* 功能： 
</span><span style="color:#75715e">                步骤：
</span><span style="color:#75715e">* 注意：
</span><span style="color:#75715e">* 掌握：
</span><span style="color:#75715e">                思考：
</span><span style="color:#75715e">* 回顾：
</span><span style="color:#75715e">*/</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">RewriteTestServer5</span>
<span style="color:#f92672">{</span>

        <span style="color:#75715e">/**
</span><span style="color:#75715e">         * @param args 
</span><span style="color:#75715e">         * 原因：
</span><span style="color:#75715e">         * 解决：
</span><span style="color:#75715e">         * 功能：
</span><span style="color:#75715e">         *       思考：        
</span><span style="color:#75715e">         *       步骤：
</span><span style="color:#75715e">         */</span>
        <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">main</span><span style="color:#f92672">(</span>String<span style="color:#f92672">[</span><span style="color:#f92672">]</span> args<span style="color:#f92672">)</span> <span style="color:#66d9ef">throws</span> Exception
        <span style="color:#f92672">{</span>
                <span style="color:#75715e">// TODO Auto-generated method stub
</span><span style="color:#75715e"></span>            ServerSocket ss <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> ServerSocket<span style="color:#f92672">(</span>5599<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
        <span style="color:#66d9ef">while</span><span style="color:#f92672">(</span><span style="color:#66d9ef">true</span><span style="color:#f92672">)</span>
        <span style="color:#f92672">{</span>
                <span style="color:#66d9ef">new</span> TCPServer2<span style="color:#f92672">(</span>ss<span style="color:#f92672">.</span><span style="color:#a6e22e">accept</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
        <span style="color:#f92672">}</span>
            
        <span style="color:#f92672">}</span>

<span style="color:#f92672">}</span>
<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">TCPServer2</span>
<span style="color:#f92672">{</span>
        <span style="color:#75715e">// class variables
</span><span style="color:#75715e"></span>        <span style="color:#75715e">// class variables
</span><span style="color:#75715e"></span>        <span style="color:#75715e">// connect
</span><span style="color:#75715e"></span>         
         <span style="color:#66d9ef">private</span> Socket s <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
         <span style="color:#75715e">// data flow
</span><span style="color:#75715e"></span>         <span style="color:#66d9ef">private</span> DataOutputStream dos <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
         <span style="color:#66d9ef">private</span> DataInputStream dis <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
         <span style="color:#75715e">// UI
</span><span style="color:#75715e"></span>         <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> Frame f <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
         <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> TextArea ta <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
         <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> TextField tf <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
         <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> Button  bn <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
         
         <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">boolean</span> isPrint <span style="color:#f92672">=</span> <span style="color:#66d9ef">false</span><span style="color:#f92672">;</span><span style="color:#75715e">//是否输出消息标志
</span><span style="color:#75715e"></span>         <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> List user_list <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> ArrayList<span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span><span style="color:#75715e">//登陆用户集合
</span><span style="color:#75715e"></span>         <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> List<span style="color:#f92672">&lt;</span>ServerThread<span style="color:#f92672">&gt;</span> thread_list <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> ArrayList<span style="color:#f92672">&lt;</span>ServerThread<span style="color:#f92672">&gt;</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span><span style="color:#75715e">//服务器已启用的线程集合
</span><span style="color:#75715e"></span>         <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> LinkedList<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">&gt;</span> message_list <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> LinkedList<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">&gt;</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span><span style="color:#75715e">//存放消息队列
</span><span style="color:#75715e"></span>      
         <span style="color:#66d9ef">static</span>
         <span style="color:#f92672">{</span>
                 createUI<span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
         <span style="color:#f92672">}</span>
         <span style="color:#66d9ef">public</span>  <span style="color:#a6e22e">TCPServer2</span><span style="color:#f92672">(</span>Socket s<span style="color:#f92672">)</span> <span style="color:#66d9ef">throws</span> Exception
         <span style="color:#f92672">{</span>
                 <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">s</span> <span style="color:#f92672">=</span> s<span style="color:#f92672">;</span>
                 <span style="color:#66d9ef">new</span> PrintOutThread<span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span><span style="color:#75715e">//创建向客户端发送消息线程
</span><span style="color:#75715e"></span>             <span style="color:#66d9ef">new</span> ServerThread<span style="color:#f92672">(</span><span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">s</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>  
             <span style="color:#75715e">//本以为可以让其线程安全的，没想到没什么效果 反而更卡
</span><span style="color:#75715e"></span><span style="color:#75715e">/*             Collections.synchronizedList(user_list);
</span><span style="color:#75715e">             Collections.synchronizedList(thread_list);
</span><span style="color:#75715e">             Collections.synchronizedList(message_list);*/</span>
            <span style="color:#75715e">// launch();
</span><span style="color:#75715e"></span>                 
         <span style="color:#f92672">}</span>
       
        <span style="color:#75715e">// construct member
</span><span style="color:#75715e"></span>        <span style="color:#75715e">/*
</span><span style="color:#75715e">        public TCPServer()
</span><span style="color:#75715e">        {
</span><span style="color:#75715e">
</span><span style="color:#75715e">        }
</span><span style="color:#75715e">        */</span>
        <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">createUI</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span>
        <span style="color:#f92672">{</span>
            Frame f <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Frame<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;服务器&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
            ta <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> TextArea<span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
            tf <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> TextField<span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
            Panel p <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Panel<span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> BorderLayout<span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
            bn <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Button<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;发送&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
            p<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span>tf<span style="color:#f92672">,</span>BorderLayout<span style="color:#f92672">.</span><span style="color:#a6e22e">CENTER</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
            p<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span>bn<span style="color:#f92672">,</span>BorderLayout<span style="color:#f92672">.</span><span style="color:#a6e22e">EAST</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>

            f<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span>ta<span style="color:#f92672">,</span>BorderLayout<span style="color:#f92672">.</span><span style="color:#a6e22e">CENTER</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
            f<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span>p<span style="color:#f92672">,</span>BorderLayout<span style="color:#f92672">.</span><span style="color:#a6e22e">SOUTH</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>

            f<span style="color:#f92672">.</span><span style="color:#a6e22e">setSize</span><span style="color:#f92672">(</span>400<span style="color:#f92672">,</span>200<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
            f<span style="color:#f92672">.</span><span style="color:#a6e22e">setVisible</span><span style="color:#f92672">(</span><span style="color:#66d9ef">true</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
            <span style="color:#75715e">//f.setVisable(true);
</span><span style="color:#75715e"></span><span style="color:#75715e">/*            tf.addActionListener(new TCPServerListener());
</span><span style="color:#75715e">            bn.addActionListener(new TCPServerListener());*/</span>
            f<span style="color:#f92672">.</span><span style="color:#a6e22e">addWindowListener</span><span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> WindowAdapter<span style="color:#f92672">(</span><span style="color:#f92672">)</span>
                    <span style="color:#f92672">{</span>
                        <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">windowClosing</span><span style="color:#f92672">(</span>WindowEvent e<span style="color:#f92672">)</span>
                        <span style="color:#f92672">{</span>
                            System<span style="color:#f92672">.</span><span style="color:#a6e22e">exit</span><span style="color:#f92672">(</span>0<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                        <span style="color:#f92672">}</span>
                    <span style="color:#f92672">}</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
        <span style="color:#f92672">}</span>
        

        <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">close</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span>
        <span style="color:#f92672">{</span>
            <span style="color:#66d9ef">try</span><span style="color:#f92672">{</span>
                s<span style="color:#f92672">.</span><span style="color:#a6e22e">close</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
            <span style="color:#f92672">}</span><span style="color:#66d9ef">catch</span><span style="color:#f92672">(</span>Exception e<span style="color:#f92672">)</span>
            <span style="color:#f92672">{</span>
                System<span style="color:#f92672">.</span><span style="color:#a6e22e">exit</span><span style="color:#f92672">(</span>0<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
            <span style="color:#f92672">}</span>
        <span style="color:#f92672">}</span>
     
        <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">TCPServerListener</span> <span style="color:#66d9ef">implements</span> ActionListener
        <span style="color:#f92672">{</span>
                <span style="color:#66d9ef">private</span> ServerThread st <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
                <span style="color:#66d9ef">public</span> <span style="color:#a6e22e">TCPServerListener</span><span style="color:#f92672">(</span>ServerThread s<span style="color:#f92672">)</span>
                <span style="color:#f92672">{</span>
                        st <span style="color:#f92672">=</span>s <span style="color:#f92672">;</span>
                <span style="color:#f92672">}</span>
            <span style="color:#a6e22e">@Override</span>
            <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">actionPerformed</span><span style="color:#f92672">(</span>ActionEvent e<span style="color:#f92672">)</span>
            <span style="color:#f92672">{</span>
                   <span style="color:#66d9ef">try</span><span style="color:#f92672">{</span>
                           String str <span style="color:#f92672">=</span> tf<span style="color:#f92672">.</span><span style="color:#a6e22e">getText</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                       <span style="color:#66d9ef">if</span><span style="color:#f92672">(</span><span style="color:#f92672">!</span>str<span style="color:#f92672">.</span><span style="color:#a6e22e">isEmpty</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span>
                       <span style="color:#f92672">{</span>
                                       tf<span style="color:#f92672">.</span><span style="color:#a6e22e">setText</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                                ta<span style="color:#f92672">.</span><span style="color:#a6e22e">append</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;服务器说:&#34;</span><span style="color:#f92672">+</span>str<span style="color:#f92672">+</span><span style="color:#e6db74">&#34;\n&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                                <span style="color:#75715e">//dos.writeUTF(str);
</span><span style="color:#75715e"></span>                                <span style="color:#66d9ef">if</span><span style="color:#f92672">(</span>str<span style="color:#f92672">.</span><span style="color:#a6e22e">equalsIgnoreCase</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;再见&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span>
                                <span style="color:#f92672">{</span>
                                    close<span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                                    System<span style="color:#f92672">.</span><span style="color:#a6e22e">exit</span><span style="color:#f92672">(</span>0<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                                <span style="color:#f92672">}</span>
                               
                                st<span style="color:#f92672">.</span><span style="color:#a6e22e">pushMessage</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;服务器说:&#34;</span><span style="color:#f92672">+</span>str<span style="color:#f92672">+</span><span style="color:#e6db74">&#34;\n&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                       <span style="color:#f92672">}</span>
                   <span style="color:#f92672">}</span><span style="color:#66d9ef">catch</span><span style="color:#f92672">(</span>Exception e1<span style="color:#f92672">)</span>
                   <span style="color:#f92672">{</span>
                      <span style="color:#75715e">// e.printStackTrace();
</span><span style="color:#75715e"></span>                      System<span style="color:#f92672">.</span><span style="color:#a6e22e">exit</span><span style="color:#f92672">(</span>0<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                   <span style="color:#f92672">}</span> 
            <span style="color:#f92672">}</span>
        <span style="color:#f92672">}</span>
        
        <span style="color:#75715e">/**
</span><span style="color:#75715e">         * 服务器线程类
</span><span style="color:#75715e">         */</span>
        <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">ServerThread</span> <span style="color:#66d9ef">extends</span> Thread<span style="color:#f92672">{</span>
                <span style="color:#66d9ef">private</span> Socket client<span style="color:#f92672">;</span>
                <span style="color:#66d9ef">private</span> String name <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
                <span style="color:#66d9ef">private</span> ServerThread st <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span> <span style="color:#75715e">// 受到启发的作用！！ Client=s
</span><span style="color:#75715e"></span>                <span style="color:#66d9ef">public</span> <span style="color:#a6e22e">ServerThread</span><span style="color:#f92672">(</span>Socket s<span style="color:#f92672">)</span> <span style="color:#66d9ef">throws</span> Exception
                <span style="color:#f92672">{</span>
                        <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">client</span> <span style="color:#f92672">=</span> s<span style="color:#f92672">;</span>
                        <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">st</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span><span style="color:#f92672">;</span>
                        dis <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> DataInputStream<span style="color:#f92672">(</span>client<span style="color:#f92672">.</span><span style="color:#a6e22e">getInputStream</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                dos <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> DataOutputStream<span style="color:#f92672">(</span>client<span style="color:#f92672">.</span><span style="color:#a6e22e">getOutputStream</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                dos<span style="color:#f92672">.</span><span style="color:#a6e22e">writeUTF</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;成功连上服务器&#34;</span><span style="color:#f92672">+</span>client<span style="color:#f92672">.</span><span style="color:#a6e22e">getInetAddress</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">.</span><span style="color:#a6e22e">getHostAddress</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                dos<span style="color:#f92672">.</span><span style="color:#a6e22e">writeUTF</span><span style="color:#f92672">(</span>Thread<span style="color:#f92672">.</span><span style="color:#a6e22e">currentThread</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">.</span><span style="color:#a6e22e">getName</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">+</span><span style="color:#e6db74">&#34;已开启&#34;</span><span style="color:#f92672">+</span><span style="color:#e6db74">&#34;请输入你的姓名&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">start</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                <span style="color:#75715e">//tf的监听器
</span><span style="color:#75715e"></span>                tf<span style="color:#f92672">.</span><span style="color:#a6e22e">addActionListener</span><span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> TCPServerListener<span style="color:#f92672">(</span><span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">st</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                bn<span style="color:#f92672">.</span><span style="color:#a6e22e">addActionListener</span><span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> TCPServerListener<span style="color:#f92672">(</span><span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">st</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                <span style="color:#f92672">}</span>
                <span style="color:#a6e22e">@Override</span>
                <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">run</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span>
                <span style="color:#f92672">{</span>
                        <span style="color:#66d9ef">try</span>
                        <span style="color:#f92672">{</span>
                                <span style="color:#66d9ef">int</span> flag <span style="color:#f92672">=</span> 0 <span style="color:#f92672">;</span>
                                String line <span style="color:#f92672">=</span> dis<span style="color:#f92672">.</span><span style="color:#a6e22e">readUTF</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                                <span style="color:#66d9ef">while</span><span style="color:#f92672">(</span><span style="color:#f92672">!</span><span style="color:#e6db74">&#34;bye&#34;</span><span style="color:#f92672">.</span><span style="color:#a6e22e">equals</span><span style="color:#f92672">(</span>line<span style="color:#f92672">)</span><span style="color:#f92672">)</span>
                                <span style="color:#f92672">{</span>
                                        <span style="color:#75715e">//查看在线用户列表
</span><span style="color:#75715e"></span>                        <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span><span style="color:#e6db74">&#34;showuser&#34;</span><span style="color:#f92672">.</span><span style="color:#a6e22e">equals</span><span style="color:#f92672">(</span>line<span style="color:#f92672">)</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
                            dos<span style="color:#f92672">.</span><span style="color:#a6e22e">writeUTF</span><span style="color:#f92672">(</span><span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">listOnlineUsers</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                            line <span style="color:#f92672">=</span> dis<span style="color:#f92672">.</span><span style="color:#a6e22e">readUTF</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                        <span style="color:#f92672">}</span>
                        <span style="color:#75715e">//第一次进入，保存名字
</span><span style="color:#75715e"></span>
                        <span style="color:#66d9ef">if</span><span style="color:#f92672">(</span>flag<span style="color:#f92672">+</span><span style="color:#f92672">+</span> <span style="color:#f92672">=</span><span style="color:#f92672">=</span>0<span style="color:#f92672">)</span><span style="color:#f92672">{</span>
                            name <span style="color:#f92672">=</span> line<span style="color:#f92672">;</span>
                            user_list<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span>name<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                            thread_list<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span><span style="color:#66d9ef">this</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                            System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;this=&#34;</span><span style="color:#f92672">+</span><span style="color:#66d9ef">this</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                            dos<span style="color:#f92672">.</span><span style="color:#a6e22e">writeUTF</span><span style="color:#f92672">(</span>name <span style="color:#f92672">+</span><span style="color:#e6db74">&#34;你好,可以开始聊天了...&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                            <span style="color:#75715e">//
</span><span style="color:#75715e"></span>                            <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">pushMessage</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Client&lt;&#34;</span> <span style="color:#f92672">+</span> name <span style="color:#f92672">+</span><span style="color:#e6db74">&#34;&gt;进入聊天室...+\n&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                            <span style="color:#75715e">//现在在服务器的大厅中
</span><span style="color:#75715e"></span>                            ta<span style="color:#f92672">.</span><span style="color:#a6e22e">append</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Client&lt;&#34;</span> <span style="color:#f92672">+</span> name <span style="color:#f92672">+</span><span style="color:#e6db74">&#34;&gt;进入聊天室...\n&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                        <span style="color:#f92672">}</span><span style="color:#66d9ef">else</span><span style="color:#f92672">{</span>
                                 <span style="color:#75715e">//现在在服务器的大厅中
</span><span style="color:#75715e"></span>                                ta<span style="color:#f92672">.</span><span style="color:#a6e22e">append</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Client&lt;&#34;</span> <span style="color:#f92672">+</span> name <span style="color:#f92672">+</span><span style="color:#e6db74">&#34;&gt; say : &#34;</span> <span style="color:#f92672">+</span> line<span style="color:#f92672">+</span><span style="color:#e6db74">&#34;\n&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                                <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">pushMessage</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Client&lt;&#34;</span> <span style="color:#f92672">+</span> name <span style="color:#f92672">+</span><span style="color:#e6db74">&#34;&gt; say : &#34;</span> <span style="color:#f92672">+</span> line<span style="color:#f92672">+</span><span style="color:#e6db74">&#34;\n&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                        <span style="color:#f92672">}</span>
                        line <span style="color:#f92672">=</span> dis<span style="color:#f92672">.</span><span style="color:#a6e22e">readUTF</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                                <span style="color:#f92672">}</span>
                        <span style="color:#f92672">}</span><span style="color:#66d9ef">catch</span><span style="color:#f92672">(</span>IOException e<span style="color:#f92672">)</span>
                        <span style="color:#f92672">{</span>
                                
                        <span style="color:#f92672">}</span>
                <span style="color:#f92672">}</span>
                 <span style="color:#75715e">//放入消息队列末尾，准备发送给客户端
</span><span style="color:#75715e"></span>            <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">pushMessage</span><span style="color:#f92672">(</span>String msg<span style="color:#f92672">)</span><span style="color:#f92672">{</span>
                message_list<span style="color:#f92672">.</span><span style="color:#a6e22e">addLast</span><span style="color:#f92672">(</span>msg<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                isPrint <span style="color:#f92672">=</span><span style="color:#66d9ef">true</span><span style="color:#f92672">;</span>
            <span style="color:#f92672">}</span>
              
            <span style="color:#75715e">//向客户端发送一条消息(在PrintOutThread 有使用 于是变成了public修饰)
</span><span style="color:#75715e"></span>            <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">sendMessage</span><span style="color:#f92672">(</span>String msg<span style="color:#f92672">)</span> <span style="color:#66d9ef">throws</span> Exception<span style="color:#f92672">{</span>
                dos<span style="color:#f92672">.</span><span style="color:#a6e22e">writeUTF</span><span style="color:#f92672">(</span>msg<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                dos<span style="color:#f92672">.</span><span style="color:#a6e22e">flush</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
            <span style="color:#f92672">}</span>
              
            <span style="color:#75715e">//统计在线用户列表  需要在showuser中使用  改为public
</span><span style="color:#75715e"></span>            <span style="color:#66d9ef">private</span> String <span style="color:#a6e22e">listOnlineUsers</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
                String s <span style="color:#f92672">=</span><span style="color:#e6db74">&#34;--- 在线用户列表 ---&#34;</span><span style="color:#f92672">;</span>
                <span style="color:#66d9ef">for</span> <span style="color:#f92672">(</span><span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span>0<span style="color:#f92672">;</span> i <span style="color:#f92672">&lt;</span> user_list<span style="color:#f92672">.</span><span style="color:#a6e22e">size</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span> i<span style="color:#f92672">+</span><span style="color:#f92672">+</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
                    s <span style="color:#f92672">+</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;[&#34;</span> <span style="color:#f92672">+</span> user_list<span style="color:#f92672">.</span><span style="color:#a6e22e">get</span><span style="color:#f92672">(</span>i<span style="color:#f92672">)</span> <span style="color:#f92672">+</span><span style="color:#e6db74">&#34;]&#34;</span><span style="color:#f92672">;</span>
                <span style="color:#f92672">}</span>
                s <span style="color:#f92672">+</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;--------------------&#34;</span><span style="color:#f92672">;</span>
                <span style="color:#66d9ef">return</span> s<span style="color:#f92672">;</span>
            <span style="color:#f92672">}</span>

        <span style="color:#f92672">}</span>
              
        <span style="color:#75715e">/**
</span><span style="color:#75715e">         * 监听是否有输出消息请求线程类,向客户端发送消息
</span><span style="color:#75715e">         */</span>
        <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">PrintOutThread</span> <span style="color:#66d9ef">extends</span> Thread
        <span style="color:#f92672">{</span>
            <span style="color:#66d9ef">public</span> <span style="color:#a6e22e">PrintOutThread</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span>
            <span style="color:#f92672">{</span>
                start<span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
            <span style="color:#f92672">}</span>
              
            <span style="color:#a6e22e">@Override</span>
            <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">run</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span> 
            <span style="color:#f92672">{</span>
                <span style="color:#66d9ef">while</span><span style="color:#f92672">(</span><span style="color:#66d9ef">true</span><span style="color:#f92672">)</span><span style="color:#f92672">{</span>
                    <span style="color:#66d9ef">if</span><span style="color:#f92672">(</span>isPrint<span style="color:#f92672">)</span><span style="color:#f92672">{</span><span style="color:#75715e">//将缓存在队列中的消息按顺序发送到各客户端，并从队列中清除。
</span><span style="color:#75715e"></span>                        String message <span style="color:#f92672">=</span> message_list<span style="color:#f92672">.</span><span style="color:#a6e22e">getFirst</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                        <span style="color:#66d9ef">for</span> <span style="color:#f92672">(</span>ServerThread thread <span style="color:#f92672">:</span> thread_list<span style="color:#f92672">)</span> 
                        <span style="color:#f92672">{</span>
                            <span style="color:#66d9ef">try</span>
                                                        <span style="color:#f92672">{</span>
                                    <span style="color:#75715e">//this.
</span><span style="color:#75715e"></span>                                    thread<span style="color:#f92672">.</span><span style="color:#a6e22e">sendMessage</span><span style="color:#f92672">(</span>message<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                                                        <span style="color:#f92672">}</span> <span style="color:#66d9ef">catch</span> <span style="color:#f92672">(</span>Exception e<span style="color:#f92672">)</span>
                                                        <span style="color:#f92672">{</span>
                                                                <span style="color:#75715e">// TODO Auto-generated catch block
</span><span style="color:#75715e"></span>                                                                e<span style="color:#f92672">.</span><span style="color:#a6e22e">printStackTrace</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                                                        <span style="color:#f92672">}</span>
                        <span style="color:#f92672">}</span>
                        message_list<span style="color:#f92672">.</span><span style="color:#a6e22e">removeFirst</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                        isPrint <span style="color:#f92672">=</span> message_list<span style="color:#f92672">.</span><span style="color:#a6e22e">size</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span> <span style="color:#f92672">&gt;</span>0 <span style="color:#f92672">?</span><span style="color:#66d9ef">true</span> <span style="color:#f92672">:</span><span style="color:#66d9ef">false</span><span style="color:#f92672">;</span>
                    <span style="color:#f92672">}</span>
                <span style="color:#f92672">}</span>
            <span style="color:#f92672">}</span>
        <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>

</code></pre></div><p>Client端如下：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#75715e">/**
</span><span style="color:#75715e">* 解释：
</span><span style="color:#75715e">*/</span>
<span style="color:#f92672">package</span> TestNetwork<span style="color:#f92672">;</span>

<span style="color:#f92672">import</span> java.awt.BorderLayout<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.awt.Button<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.awt.Frame<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.awt.Panel<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.awt.TextArea<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.awt.TextField<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.awt.event.ActionEvent<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.awt.event.ActionListener<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.awt.event.WindowAdapter<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.awt.event.WindowEvent<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.io.BufferedReader<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.io.DataInputStream<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.io.DataOutputStream<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.io.IOException<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.io.InputStreamReader<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.net.Socket<span style="color:#f92672">;</span>

<span style="color:#f92672">import</span> javax.swing.JOptionPane<span style="color:#f92672">;</span>

<span style="color:#f92672">import</span> TestNetwork.TCPClient1.ClientRead<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> TestNetwork.TCPClient1.ClientWrite<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> TestNetwork.TCPClient1.TCPClientListener<span style="color:#f92672">;</span>

<span style="color:#75715e">/**
</span><span style="color:#75715e">* @author    叶昭良
</span><span style="color:#75715e">* @time      2015年3月23日上午1:57:54
</span><span style="color:#75715e">* @version   TestNetworkRewriteTestClient5 V1.0
</span><span style="color:#75715e">* 功能： 
</span><span style="color:#75715e">                步骤：
</span><span style="color:#75715e">* 注意：
</span><span style="color:#75715e">* 掌握：
</span><span style="color:#75715e">                思考：
</span><span style="color:#75715e">* 回顾：
</span><span style="color:#75715e">*/</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">RewriteTestClient5</span>
<span style="color:#f92672">{</span>

        <span style="color:#75715e">/**
</span><span style="color:#75715e">         * @param args 
</span><span style="color:#75715e">         * 原因：
</span><span style="color:#75715e">         * 解决：
</span><span style="color:#75715e">         * 功能：
</span><span style="color:#75715e">         *       思考：        
</span><span style="color:#75715e">         *       步骤：
</span><span style="color:#75715e">         */</span>
        <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">main</span><span style="color:#f92672">(</span>String<span style="color:#f92672">[</span><span style="color:#f92672">]</span> args<span style="color:#f92672">)</span> <span style="color:#66d9ef">throws</span> Exception
        <span style="color:#f92672">{</span>
                <span style="color:#75715e">// TODO Auto-generated method stub
</span><span style="color:#75715e"></span>                Socket s  <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
                s <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Socket<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;127.0.0.1&#34;</span><span style="color:#f92672">,</span>5599<span style="color:#f92672">)</span><span style="color:#f92672">;</span>

                 <span style="color:#66d9ef">new</span> TCPClient5<span style="color:#f92672">(</span>s<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
        <span style="color:#f92672">}</span>

<span style="color:#f92672">}</span>
<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">TCPClient5</span>
<span style="color:#f92672">{</span>
        <span style="color:#75715e">// class variables
</span><span style="color:#75715e"></span>        <span style="color:#75715e">// class variables
</span><span style="color:#75715e"></span>        <span style="color:#75715e">// connect
</span><span style="color:#75715e"></span>         <span style="color:#66d9ef">private</span> Socket s <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
         <span style="color:#75715e">// data flow
</span><span style="color:#75715e"></span>         <span style="color:#66d9ef">private</span> DataOutputStream dos <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
         <span style="color:#66d9ef">private</span> DataInputStream dis <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
         <span style="color:#75715e">// UI
</span><span style="color:#75715e"></span>         <span style="color:#66d9ef">private</span> Frame f <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
         <span style="color:#66d9ef">private</span> TextArea ta <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
         <span style="color:#66d9ef">private</span> TextField tf <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
         <span style="color:#66d9ef">private</span> Button  bn <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
         
         <span style="color:#75715e">/**
</span><span style="color:#75715e">          * 与服务器连接，并输入发送消息
</span><span style="color:#75715e">          */</span>
         <span style="color:#66d9ef">public</span> <span style="color:#a6e22e">TCPClient5</span><span style="color:#f92672">(</span>Socket s<span style="color:#f92672">)</span> <span style="color:#66d9ef">throws</span> Exception
         <span style="color:#f92672">{</span>
                 <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">s</span> <span style="color:#f92672">=</span> s<span style="color:#f92672">;</span>
                 dis <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> DataInputStream<span style="color:#f92672">(</span>s<span style="color:#f92672">.</span><span style="color:#a6e22e">getInputStream</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
             dos <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> DataOutputStream<span style="color:#f92672">(</span>s<span style="color:#f92672">.</span><span style="color:#a6e22e">getOutputStream</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
             createUI<span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
             <span style="color:#75715e">//new ClientRead(dis);
</span><span style="color:#75715e"></span>             <span style="color:#75715e">//new ClientWrite(dos);
</span><span style="color:#75715e"></span>             <span style="color:#66d9ef">new</span> readLineThread<span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>

         <span style="color:#f92672">}</span>
         <span style="color:#75715e">/**
</span><span style="color:#75715e">          * 用于监听服务器端向客户端发送消息线程类
</span><span style="color:#75715e">          */</span>
  
        <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">createUI</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span>
        <span style="color:#f92672">{</span>
            Frame f <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Frame<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;客户端&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
            ta <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> TextArea<span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
            tf <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> TextField<span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
            Panel p <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Panel<span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> BorderLayout<span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
            bn <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Button<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;发送&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
            p<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span>tf<span style="color:#f92672">,</span>BorderLayout<span style="color:#f92672">.</span><span style="color:#a6e22e">CENTER</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
            p<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span>bn<span style="color:#f92672">,</span>BorderLayout<span style="color:#f92672">.</span><span style="color:#a6e22e">EAST</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>

            f<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span>ta<span style="color:#f92672">,</span>BorderLayout<span style="color:#f92672">.</span><span style="color:#a6e22e">CENTER</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
            f<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span>p<span style="color:#f92672">,</span>BorderLayout<span style="color:#f92672">.</span><span style="color:#a6e22e">SOUTH</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>

            f<span style="color:#f92672">.</span><span style="color:#a6e22e">setSize</span><span style="color:#f92672">(</span>400<span style="color:#f92672">,</span>200<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
            f<span style="color:#f92672">.</span><span style="color:#a6e22e">setVisible</span><span style="color:#f92672">(</span><span style="color:#66d9ef">true</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
            <span style="color:#75715e">//f.setVisable(true);
</span><span style="color:#75715e"></span>                tf<span style="color:#f92672">.</span><span style="color:#a6e22e">addActionListener</span><span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> TCPClientListener<span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                bn<span style="color:#f92672">.</span><span style="color:#a6e22e">addActionListener</span><span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> TCPClientListener<span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
            f<span style="color:#f92672">.</span><span style="color:#a6e22e">addWindowListener</span><span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> WindowAdapter<span style="color:#f92672">(</span><span style="color:#f92672">)</span>
                    <span style="color:#f92672">{</span>
                        <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">windowClosing</span><span style="color:#f92672">(</span>WindowEvent e<span style="color:#f92672">)</span>
                        <span style="color:#f92672">{</span>
                            System<span style="color:#f92672">.</span><span style="color:#a6e22e">exit</span><span style="color:#f92672">(</span>0<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                        <span style="color:#f92672">}</span>
                    <span style="color:#f92672">}</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
        <span style="color:#f92672">}</span>

        <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">close</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span>
        <span style="color:#f92672">{</span>
            <span style="color:#66d9ef">try</span><span style="color:#f92672">{</span>
                dis<span style="color:#f92672">.</span><span style="color:#a6e22e">close</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                dos<span style="color:#f92672">.</span><span style="color:#a6e22e">close</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                s<span style="color:#f92672">.</span><span style="color:#a6e22e">close</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
            <span style="color:#f92672">}</span><span style="color:#66d9ef">catch</span><span style="color:#f92672">(</span>Exception e<span style="color:#f92672">)</span>
            <span style="color:#f92672">{</span>
                System<span style="color:#f92672">.</span><span style="color:#a6e22e">exit</span><span style="color:#f92672">(</span>0<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
            <span style="color:#f92672">}</span>
        <span style="color:#f92672">}</span>
        <span style="color:#75715e">/**
</span><span style="color:#75715e">         * 用于监听服务器端向客户端发送消息线程类
</span><span style="color:#75715e">         */</span>
        <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">readLineThread</span> <span style="color:#66d9ef">extends</span> Thread
        <span style="color:#f92672">{</span>
              
            <span style="color:#66d9ef">private</span> BufferedReader buff <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span><span style="color:#f92672">;</span>
            <span style="color:#66d9ef">public</span> <span style="color:#a6e22e">readLineThread</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">{</span>
                    start<span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                
            <span style="color:#f92672">}</span>
              
            <span style="color:#a6e22e">@Override</span>
            <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">run</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
                <span style="color:#66d9ef">try</span> <span style="color:#f92672">{</span>
                    <span style="color:#66d9ef">while</span><span style="color:#f92672">(</span><span style="color:#66d9ef">true</span><span style="color:#f92672">)</span><span style="color:#f92672">{</span>
                        String result <span style="color:#f92672">=</span> dis<span style="color:#f92672">.</span><span style="color:#a6e22e">readUTF</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                        <span style="color:#66d9ef">if</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;byeClient&#34;</span><span style="color:#f92672">.</span><span style="color:#a6e22e">equals</span><span style="color:#f92672">(</span>result<span style="color:#f92672">)</span><span style="color:#f92672">)</span><span style="color:#f92672">{</span><span style="color:#75715e">//客户端申请退出，服务端返回确认退出
</span><span style="color:#75715e"></span>                            <span style="color:#66d9ef">break</span><span style="color:#f92672">;</span>
                        <span style="color:#f92672">}</span><span style="color:#66d9ef">else</span><span style="color:#f92672">{</span><span style="color:#75715e">//输出服务端发送消息
</span><span style="color:#75715e"></span>                                <span style="color:#75715e">//ta.append(result);
</span><span style="color:#75715e"></span>                            System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span>result<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                           <span style="color:#75715e">// dos.writeUTF(result);
</span><span style="color:#75715e"></span>                            ta<span style="color:#f92672">.</span><span style="color:#a6e22e">append</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;服务器传递说:&#34;</span><span style="color:#f92672">+</span>result<span style="color:#f92672">+</span><span style="color:#e6db74">&#34;\n&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                            <span style="color:#66d9ef">if</span><span style="color:#f92672">(</span>result<span style="color:#f92672">.</span><span style="color:#a6e22e">equalsIgnoreCase</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;再见&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span>
                            <span style="color:#f92672">{</span>
                                close<span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                                System<span style="color:#f92672">.</span><span style="color:#a6e22e">exit</span><span style="color:#f92672">(</span>0<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                            <span style="color:#f92672">}</span>
                        <span style="color:#f92672">}</span>
                    <span style="color:#f92672">}</span>
                <span style="color:#f92672">}</span><span style="color:#66d9ef">catch</span> <span style="color:#f92672">(</span>Exception e<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
                <span style="color:#f92672">}</span>
            <span style="color:#f92672">}</span>
        <span style="color:#f92672">}</span>
        
        <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">TCPClientListener</span> <span style="color:#66d9ef">implements</span> ActionListener
        <span style="color:#f92672">{</span>
            <span style="color:#a6e22e">@Override</span>
            <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">actionPerformed</span><span style="color:#f92672">(</span>ActionEvent e<span style="color:#f92672">)</span>
            <span style="color:#f92672">{</span>
                   <span style="color:#66d9ef">try</span><span style="color:#f92672">{</span>
                        String str <span style="color:#f92672">=</span> tf<span style="color:#f92672">.</span><span style="color:#a6e22e">getText</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                        tf<span style="color:#f92672">.</span><span style="color:#a6e22e">setText</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                        ta<span style="color:#f92672">.</span><span style="color:#a6e22e">append</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;客户端说:&#34;</span><span style="color:#f92672">+</span>str<span style="color:#f92672">+</span><span style="color:#e6db74">&#34;\n&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                        dos<span style="color:#f92672">.</span><span style="color:#a6e22e">writeUTF</span><span style="color:#f92672">(</span>str<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                        <span style="color:#66d9ef">if</span><span style="color:#f92672">(</span>str<span style="color:#f92672">.</span><span style="color:#a6e22e">equalsIgnoreCase</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;再见&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span>
                        <span style="color:#f92672">{</span>
                            close<span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                            System<span style="color:#f92672">.</span><span style="color:#a6e22e">exit</span><span style="color:#f92672">(</span>0<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                        <span style="color:#f92672">}</span>
                   <span style="color:#f92672">}</span><span style="color:#66d9ef">catch</span><span style="color:#f92672">(</span>Exception e1<span style="color:#f92672">)</span>
                   <span style="color:#f92672">{</span>
                      <span style="color:#75715e">// e.printStackTrace();
</span><span style="color:#75715e"></span>                      System<span style="color:#f92672">.</span><span style="color:#a6e22e">exit</span><span style="color:#f92672">(</span>0<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                   <span style="color:#f92672">}</span> 
            <span style="color:#f92672">}</span>
        <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><p>结果：</p>
<p>1：之前的线程卡的问题，还没有解决，运行起来仍然感觉占用大量内存！！
2：为什么 第一个进入聊天系统的杨中科，会打印出三次呢？ 当然后面的消息正常，当然三次的意思是聊天系统进入了三个人，都教授和Rocket. 所以肯定是那部分有问题待解决</p>
<p><img src="/images/java/%E6%9C%8D%E5%8A%A1%E5%99%A82.png" alt="在这边有一个小问题，出现了三行打印"></p>
<p><img src="/images/java/%E5%9F%BA%E6%9C%AC%E6%BB%A1%E8%B6%B3%E9%A2%98%E6%84%8F.png" alt="群发效果OK,服务器也没问题了"></p>
<p><a href="http://www.cnblogs.com/linjiqin/archive/2013/05/30/3108188.html">http://www.cnblogs.com/linjiqin/archive/2013/05/30/3108188.html</a>  欣赏了这篇佳作</p>
<p>基于上次的问题，打开的时候经常会出现多个打印的情况，
尝试如下修改：
“登录用户集合”和“服务器已启用线程集合”的list，如果变化不频繁，读多写少，使用CopyOnWriteArrayList。
“存放消息队列”用Queue接口比List接口更方便（每次直接POP，没消息时候还可以让广播线程自己阻塞在上面），具体的用ArrayBlockingQueue或者LinkedBlockingQueue都可以。http://my.oschina.net/leejun2005/blog/104955
对应的message_list.addLast(msg)  变成了message_list.put(msg)              message_list.take()来取代 message_list.getFirst() &amp; message_list.removeFirst()
效果就是居然没问题。居然也不卡了</p>
<p>Server端的修正版本：（Client端不需要修正）</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">
<span style="color:#75715e">/**
</span><span style="color:#75715e">* 解释：
</span><span style="color:#75715e">*/</span>
<span style="color:#f92672">package</span> TestNetwork<span style="color:#f92672">;</span>

<span style="color:#f92672">import</span> java.awt.BorderLayout<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.awt.Button<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.awt.Frame<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.awt.Panel<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.awt.TextArea<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.awt.TextField<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.awt.event.ActionEvent<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.awt.event.ActionListener<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.awt.event.WindowAdapter<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.awt.event.WindowEvent<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.io.DataInputStream<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.io.DataOutputStream<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.io.IOException<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.net.ServerSocket<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.net.Socket<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.util.*<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.util.concurrent.CopyOnWriteArrayList<span style="color:#f92672">;</span>
<span style="color:#f92672">import</span> java.util.concurrent.LinkedBlockingQueue<span style="color:#f92672">;</span>





<span style="color:#75715e">/**
</span><span style="color:#75715e">* @author    叶昭良
</span><span style="color:#75715e">* @time      2015年3月23日上午12:41:10
</span><span style="color:#75715e">* @version   TestNetworkRewriteTestServer5 V1.0
</span><span style="color:#75715e">* 功能： 
</span><span style="color:#75715e">                步骤：
</span><span style="color:#75715e">* 注意：
</span><span style="color:#75715e">* 掌握：
</span><span style="color:#75715e">                思考：
</span><span style="color:#75715e">* 回顾：
</span><span style="color:#75715e">*/</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">RewriteTestServer5</span>
<span style="color:#f92672">{</span>

        <span style="color:#75715e">/**
</span><span style="color:#75715e">         * @param args 
</span><span style="color:#75715e">         * 原因：
</span><span style="color:#75715e">         * 解决：
</span><span style="color:#75715e">         * 功能：
</span><span style="color:#75715e">         *       思考：        
</span><span style="color:#75715e">         *       步骤：
</span><span style="color:#75715e">         */</span>
        <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">main</span><span style="color:#f92672">(</span>String<span style="color:#f92672">[</span><span style="color:#f92672">]</span> args<span style="color:#f92672">)</span> <span style="color:#66d9ef">throws</span> Exception
        <span style="color:#f92672">{</span>
                <span style="color:#75715e">// TODO Auto-generated method stub
</span><span style="color:#75715e"></span>            ServerSocket ss <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> ServerSocket<span style="color:#f92672">(</span>5599<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
        <span style="color:#66d9ef">while</span><span style="color:#f92672">(</span><span style="color:#66d9ef">true</span><span style="color:#f92672">)</span>
        <span style="color:#f92672">{</span>
                <span style="color:#66d9ef">new</span> TCPServer2<span style="color:#f92672">(</span>ss<span style="color:#f92672">.</span><span style="color:#a6e22e">accept</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
        <span style="color:#f92672">}</span>
            
        <span style="color:#f92672">}</span>

<span style="color:#f92672">}</span>
<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">TCPServer2</span>
<span style="color:#f92672">{</span>
        <span style="color:#75715e">// class variables
</span><span style="color:#75715e"></span>        <span style="color:#75715e">// class variables
</span><span style="color:#75715e"></span>        <span style="color:#75715e">// connect
</span><span style="color:#75715e"></span>         
         <span style="color:#66d9ef">private</span> Socket s <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
         <span style="color:#75715e">// data flow
</span><span style="color:#75715e"></span>         <span style="color:#66d9ef">private</span> DataOutputStream dos <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
         <span style="color:#66d9ef">private</span> DataInputStream dis <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
         <span style="color:#75715e">// UI
</span><span style="color:#75715e"></span>         <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> Frame f <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
         <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> TextArea ta <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
         <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> TextField tf <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
         <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> Button  bn <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
         
         <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">boolean</span> isPrint <span style="color:#f92672">=</span> <span style="color:#66d9ef">false</span><span style="color:#f92672">;</span><span style="color:#75715e">//是否输出消息标志
</span><span style="color:#75715e"></span>         <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> List user_list <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> CopyOnWriteArrayList<span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span><span style="color:#75715e">//登陆用户集合
</span><span style="color:#75715e"></span>         <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> List<span style="color:#f92672">&lt;</span>ServerThread<span style="color:#f92672">&gt;</span> thread_list <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> CopyOnWriteArrayList<span style="color:#f92672">&lt;</span>ServerThread<span style="color:#f92672">&gt;</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span><span style="color:#75715e">//服务器已启用的线程集合
</span><span style="color:#75715e"></span>         <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> LinkedBlockingQueue<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">&gt;</span> message_list <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> LinkedBlockingQueue<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">&gt;</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span><span style="color:#75715e">//存放消息队列
</span><span style="color:#75715e"></span>        <span style="color:#75715e">// private static List&lt;String&gt; message_list = new LinkedList&lt;String&gt;();//存放消息队列
</span><span style="color:#75715e"></span>      
         <span style="color:#66d9ef">static</span>
         <span style="color:#f92672">{</span>
                 createUI<span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
         <span style="color:#f92672">}</span>
         <span style="color:#66d9ef">public</span>  <span style="color:#a6e22e">TCPServer2</span><span style="color:#f92672">(</span>Socket s<span style="color:#f92672">)</span> <span style="color:#66d9ef">throws</span> Exception
         <span style="color:#f92672">{</span>
                 <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">s</span> <span style="color:#f92672">=</span> s<span style="color:#f92672">;</span>
                 <span style="color:#66d9ef">new</span> PrintOutThread<span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span><span style="color:#75715e">//创建向客户端发送消息线程
</span><span style="color:#75715e"></span>             <span style="color:#66d9ef">new</span> ServerThread<span style="color:#f92672">(</span><span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">s</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>  
             <span style="color:#75715e">//本以为可以让其线程安全的，没想到没什么效果 反而更卡
</span><span style="color:#75715e"></span><span style="color:#75715e">/*             Collections.synchronizedList(user_list);
</span><span style="color:#75715e">             Collections.synchronizedList(thread_list);
</span><span style="color:#75715e">             Collections.synchronizedList(message_list);*/</span>
            <span style="color:#75715e">// launch();
</span><span style="color:#75715e"></span>                 
         <span style="color:#f92672">}</span>
       
        <span style="color:#75715e">// construct member
</span><span style="color:#75715e"></span>        <span style="color:#75715e">/*
</span><span style="color:#75715e">        public TCPServer()
</span><span style="color:#75715e">        {
</span><span style="color:#75715e">
</span><span style="color:#75715e">        }
</span><span style="color:#75715e">        */</span>
        <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">createUI</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span>
        <span style="color:#f92672">{</span>
            Frame f <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Frame<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;服务器&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
            ta <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> TextArea<span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
            tf <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> TextField<span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
            Panel p <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Panel<span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> BorderLayout<span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
            bn <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Button<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;发送&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
            p<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span>tf<span style="color:#f92672">,</span>BorderLayout<span style="color:#f92672">.</span><span style="color:#a6e22e">CENTER</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
            p<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span>bn<span style="color:#f92672">,</span>BorderLayout<span style="color:#f92672">.</span><span style="color:#a6e22e">EAST</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>

            f<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span>ta<span style="color:#f92672">,</span>BorderLayout<span style="color:#f92672">.</span><span style="color:#a6e22e">CENTER</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
            f<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span>p<span style="color:#f92672">,</span>BorderLayout<span style="color:#f92672">.</span><span style="color:#a6e22e">SOUTH</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>

            f<span style="color:#f92672">.</span><span style="color:#a6e22e">setSize</span><span style="color:#f92672">(</span>400<span style="color:#f92672">,</span>200<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
            f<span style="color:#f92672">.</span><span style="color:#a6e22e">setVisible</span><span style="color:#f92672">(</span><span style="color:#66d9ef">true</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
            <span style="color:#75715e">//f.setVisable(true);
</span><span style="color:#75715e"></span><span style="color:#75715e">/*            tf.addActionListener(new TCPServerListener());
</span><span style="color:#75715e">            bn.addActionListener(new TCPServerListener());*/</span>
            f<span style="color:#f92672">.</span><span style="color:#a6e22e">addWindowListener</span><span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> WindowAdapter<span style="color:#f92672">(</span><span style="color:#f92672">)</span>
                    <span style="color:#f92672">{</span>
                        <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">windowClosing</span><span style="color:#f92672">(</span>WindowEvent e<span style="color:#f92672">)</span>
                        <span style="color:#f92672">{</span>
                            System<span style="color:#f92672">.</span><span style="color:#a6e22e">exit</span><span style="color:#f92672">(</span>0<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                        <span style="color:#f92672">}</span>
                    <span style="color:#f92672">}</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
        <span style="color:#f92672">}</span>
        

        <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">close</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span>
        <span style="color:#f92672">{</span>
            <span style="color:#66d9ef">try</span><span style="color:#f92672">{</span>
                s<span style="color:#f92672">.</span><span style="color:#a6e22e">close</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
            <span style="color:#f92672">}</span><span style="color:#66d9ef">catch</span><span style="color:#f92672">(</span>Exception e<span style="color:#f92672">)</span>
            <span style="color:#f92672">{</span>
                System<span style="color:#f92672">.</span><span style="color:#a6e22e">exit</span><span style="color:#f92672">(</span>0<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
            <span style="color:#f92672">}</span>
        <span style="color:#f92672">}</span>
     
        <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">TCPServerListener</span> <span style="color:#66d9ef">implements</span> ActionListener
        <span style="color:#f92672">{</span>
                <span style="color:#66d9ef">private</span> ServerThread st <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
                <span style="color:#66d9ef">public</span> <span style="color:#a6e22e">TCPServerListener</span><span style="color:#f92672">(</span>ServerThread s<span style="color:#f92672">)</span>
                <span style="color:#f92672">{</span>
                        st <span style="color:#f92672">=</span>s <span style="color:#f92672">;</span>
                <span style="color:#f92672">}</span>
            <span style="color:#a6e22e">@Override</span>
            <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">actionPerformed</span><span style="color:#f92672">(</span>ActionEvent e<span style="color:#f92672">)</span>
            <span style="color:#f92672">{</span>
                   <span style="color:#66d9ef">try</span><span style="color:#f92672">{</span>
                           String str <span style="color:#f92672">=</span> tf<span style="color:#f92672">.</span><span style="color:#a6e22e">getText</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                       <span style="color:#66d9ef">if</span><span style="color:#f92672">(</span><span style="color:#f92672">!</span>str<span style="color:#f92672">.</span><span style="color:#a6e22e">isEmpty</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span>
                       <span style="color:#f92672">{</span>
                                       tf<span style="color:#f92672">.</span><span style="color:#a6e22e">setText</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                                ta<span style="color:#f92672">.</span><span style="color:#a6e22e">append</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;服务器说:&#34;</span><span style="color:#f92672">+</span>str<span style="color:#f92672">+</span><span style="color:#e6db74">&#34;\n&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                                <span style="color:#75715e">//dos.writeUTF(str);
</span><span style="color:#75715e"></span>                                <span style="color:#66d9ef">if</span><span style="color:#f92672">(</span>str<span style="color:#f92672">.</span><span style="color:#a6e22e">equalsIgnoreCase</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;再见&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span>
                                <span style="color:#f92672">{</span>
                                    close<span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                                    System<span style="color:#f92672">.</span><span style="color:#a6e22e">exit</span><span style="color:#f92672">(</span>0<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                                <span style="color:#f92672">}</span>
                               
                                st<span style="color:#f92672">.</span><span style="color:#a6e22e">pushMessage</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;服务器说:&#34;</span><span style="color:#f92672">+</span>str<span style="color:#f92672">+</span><span style="color:#e6db74">&#34;\n&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                       <span style="color:#f92672">}</span>
                   <span style="color:#f92672">}</span><span style="color:#66d9ef">catch</span><span style="color:#f92672">(</span>Exception e1<span style="color:#f92672">)</span>
                   <span style="color:#f92672">{</span>
                      <span style="color:#75715e">// e.printStackTrace();
</span><span style="color:#75715e"></span>                      System<span style="color:#f92672">.</span><span style="color:#a6e22e">exit</span><span style="color:#f92672">(</span>0<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                   <span style="color:#f92672">}</span> 
            <span style="color:#f92672">}</span>
        <span style="color:#f92672">}</span>
        
        <span style="color:#75715e">/**
</span><span style="color:#75715e">         * 服务器线程类
</span><span style="color:#75715e">         */</span>
        <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">ServerThread</span> <span style="color:#66d9ef">extends</span> Thread<span style="color:#f92672">{</span>
                <span style="color:#66d9ef">private</span> Socket client<span style="color:#f92672">;</span>
                <span style="color:#66d9ef">private</span> String name <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
                <span style="color:#66d9ef">private</span> ServerThread st <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span> <span style="color:#75715e">// 受到启发的作用！！ Client=s
</span><span style="color:#75715e"></span>                <span style="color:#66d9ef">public</span> <span style="color:#a6e22e">ServerThread</span><span style="color:#f92672">(</span>Socket s<span style="color:#f92672">)</span> <span style="color:#66d9ef">throws</span> Exception
                <span style="color:#f92672">{</span>
                        <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">client</span> <span style="color:#f92672">=</span> s<span style="color:#f92672">;</span>
                        <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">st</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span><span style="color:#f92672">;</span>
                        dis <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> DataInputStream<span style="color:#f92672">(</span>client<span style="color:#f92672">.</span><span style="color:#a6e22e">getInputStream</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                dos <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> DataOutputStream<span style="color:#f92672">(</span>client<span style="color:#f92672">.</span><span style="color:#a6e22e">getOutputStream</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                dos<span style="color:#f92672">.</span><span style="color:#a6e22e">writeUTF</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;成功连上服务器&#34;</span><span style="color:#f92672">+</span>client<span style="color:#f92672">.</span><span style="color:#a6e22e">getInetAddress</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">.</span><span style="color:#a6e22e">getHostAddress</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                dos<span style="color:#f92672">.</span><span style="color:#a6e22e">writeUTF</span><span style="color:#f92672">(</span>Thread<span style="color:#f92672">.</span><span style="color:#a6e22e">currentThread</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">.</span><span style="color:#a6e22e">getName</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">+</span><span style="color:#e6db74">&#34;已开启&#34;</span><span style="color:#f92672">+</span><span style="color:#e6db74">&#34;请输入你的姓名&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">start</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                <span style="color:#75715e">//tf的监听器
</span><span style="color:#75715e"></span>                tf<span style="color:#f92672">.</span><span style="color:#a6e22e">addActionListener</span><span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> TCPServerListener<span style="color:#f92672">(</span><span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">st</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                bn<span style="color:#f92672">.</span><span style="color:#a6e22e">addActionListener</span><span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> TCPServerListener<span style="color:#f92672">(</span><span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">st</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                <span style="color:#f92672">}</span>
                <span style="color:#a6e22e">@Override</span>
                <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">run</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span>
                <span style="color:#f92672">{</span>
                        <span style="color:#66d9ef">try</span>
                        <span style="color:#f92672">{</span>
                                <span style="color:#66d9ef">int</span> flag <span style="color:#f92672">=</span> 0 <span style="color:#f92672">;</span>
                                String line <span style="color:#f92672">=</span> dis<span style="color:#f92672">.</span><span style="color:#a6e22e">readUTF</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                                <span style="color:#66d9ef">while</span><span style="color:#f92672">(</span><span style="color:#f92672">!</span><span style="color:#e6db74">&#34;bye&#34;</span><span style="color:#f92672">.</span><span style="color:#a6e22e">equals</span><span style="color:#f92672">(</span>line<span style="color:#f92672">)</span><span style="color:#f92672">)</span>
                                <span style="color:#f92672">{</span>
                                        <span style="color:#75715e">//查看在线用户列表
</span><span style="color:#75715e"></span>                        <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span><span style="color:#e6db74">&#34;showuser&#34;</span><span style="color:#f92672">.</span><span style="color:#a6e22e">equals</span><span style="color:#f92672">(</span>line<span style="color:#f92672">)</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
                            dos<span style="color:#f92672">.</span><span style="color:#a6e22e">writeUTF</span><span style="color:#f92672">(</span><span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">listOnlineUsers</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                            line <span style="color:#f92672">=</span> dis<span style="color:#f92672">.</span><span style="color:#a6e22e">readUTF</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                        <span style="color:#f92672">}</span>
                        <span style="color:#75715e">//第一次进入，保存名字
</span><span style="color:#75715e"></span>
                        <span style="color:#66d9ef">if</span><span style="color:#f92672">(</span>flag<span style="color:#f92672">+</span><span style="color:#f92672">+</span> <span style="color:#f92672">=</span><span style="color:#f92672">=</span>0<span style="color:#f92672">)</span><span style="color:#f92672">{</span>
                            name <span style="color:#f92672">=</span> line<span style="color:#f92672">;</span>
                            user_list<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span>name<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                            thread_list<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span><span style="color:#66d9ef">this</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                            System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;this=&#34;</span><span style="color:#f92672">+</span><span style="color:#66d9ef">this</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                            <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">pushMessage</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Client&lt;&#34;</span> <span style="color:#f92672">+</span> name <span style="color:#f92672">+</span><span style="color:#e6db74">&#34;&gt;进入聊天室...+\n&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                            dos<span style="color:#f92672">.</span><span style="color:#a6e22e">writeUTF</span><span style="color:#f92672">(</span>name <span style="color:#f92672">+</span><span style="color:#e6db74">&#34;你好,可以开始聊天了...&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                            <span style="color:#75715e">//
</span><span style="color:#75715e"></span>                            
                            <span style="color:#75715e">//现在在服务器的大厅中
</span><span style="color:#75715e"></span>                            ta<span style="color:#f92672">.</span><span style="color:#a6e22e">append</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Client&lt;&#34;</span> <span style="color:#f92672">+</span> name <span style="color:#f92672">+</span><span style="color:#e6db74">&#34;&gt;进入聊天室...\n&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                        <span style="color:#f92672">}</span><span style="color:#66d9ef">else</span><span style="color:#f92672">{</span>
                                 <span style="color:#75715e">//现在在服务器的大厅中
</span><span style="color:#75715e"></span>                                ta<span style="color:#f92672">.</span><span style="color:#a6e22e">append</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Client&lt;&#34;</span> <span style="color:#f92672">+</span> name <span style="color:#f92672">+</span><span style="color:#e6db74">&#34;&gt; say : &#34;</span> <span style="color:#f92672">+</span> line<span style="color:#f92672">+</span><span style="color:#e6db74">&#34;\n&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                                <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">pushMessage</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Client&lt;&#34;</span> <span style="color:#f92672">+</span> name <span style="color:#f92672">+</span><span style="color:#e6db74">&#34;&gt; say : &#34;</span> <span style="color:#f92672">+</span> line<span style="color:#f92672">+</span><span style="color:#e6db74">&#34;\n&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                        <span style="color:#f92672">}</span>
                        line <span style="color:#f92672">=</span> dis<span style="color:#f92672">.</span><span style="color:#a6e22e">readUTF</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                                <span style="color:#f92672">}</span>
                        <span style="color:#f92672">}</span><span style="color:#66d9ef">catch</span><span style="color:#f92672">(</span>IOException e<span style="color:#f92672">)</span>
                        <span style="color:#f92672">{</span>
                                
                        <span style="color:#f92672">}</span>
                <span style="color:#f92672">}</span>
                 <span style="color:#75715e">//放入消息队列末尾，准备发送给客户端
</span><span style="color:#75715e"></span>            <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">pushMessage</span><span style="color:#f92672">(</span>String msg<span style="color:#f92672">)</span><span style="color:#f92672">{</span>
                    <span style="color:#75715e">//msssage_list.
</span><span style="color:#75715e"></span>                <span style="color:#75715e">//message_list.addLast(msg); //针对于LinkedList
</span><span style="color:#75715e"></span>                    <span style="color:#66d9ef">try</span>
                                <span style="color:#f92672">{</span>
                                        message_list<span style="color:#f92672">.</span><span style="color:#a6e22e">put</span><span style="color:#f92672">(</span>msg<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                                <span style="color:#f92672">}</span> <span style="color:#66d9ef">catch</span> <span style="color:#f92672">(</span>InterruptedException e<span style="color:#f92672">)</span>
                                <span style="color:#f92672">{</span>
                                        <span style="color:#75715e">// TODO Auto-generated catch block
</span><span style="color:#75715e"></span>                                        e<span style="color:#f92672">.</span><span style="color:#a6e22e">printStackTrace</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                                <span style="color:#f92672">}</span>
                isPrint <span style="color:#f92672">=</span><span style="color:#66d9ef">true</span><span style="color:#f92672">;</span>
            <span style="color:#f92672">}</span>
              
            <span style="color:#75715e">//向客户端发送一条消息(在PrintOutThread 有使用 于是变成了public修饰)
</span><span style="color:#75715e"></span>            <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">sendMessage</span><span style="color:#f92672">(</span>String msg<span style="color:#f92672">)</span> <span style="color:#66d9ef">throws</span> Exception<span style="color:#f92672">{</span>
                dos<span style="color:#f92672">.</span><span style="color:#a6e22e">writeUTF</span><span style="color:#f92672">(</span>msg<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                dos<span style="color:#f92672">.</span><span style="color:#a6e22e">flush</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
            <span style="color:#f92672">}</span>
              
            <span style="color:#75715e">//统计在线用户列表  需要在showuser中使用  改为public
</span><span style="color:#75715e"></span>            <span style="color:#66d9ef">private</span> String <span style="color:#a6e22e">listOnlineUsers</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
                String s <span style="color:#f92672">=</span><span style="color:#e6db74">&#34;--- 在线用户列表 ---&#34;</span><span style="color:#f92672">;</span>
                <span style="color:#66d9ef">for</span> <span style="color:#f92672">(</span><span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span>0<span style="color:#f92672">;</span> i <span style="color:#f92672">&lt;</span> user_list<span style="color:#f92672">.</span><span style="color:#a6e22e">size</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span> i<span style="color:#f92672">+</span><span style="color:#f92672">+</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
                    s <span style="color:#f92672">+</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;[&#34;</span> <span style="color:#f92672">+</span> user_list<span style="color:#f92672">.</span><span style="color:#a6e22e">get</span><span style="color:#f92672">(</span>i<span style="color:#f92672">)</span> <span style="color:#f92672">+</span><span style="color:#e6db74">&#34;]&#34;</span><span style="color:#f92672">;</span>
                <span style="color:#f92672">}</span>
                s <span style="color:#f92672">+</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;--------------------&#34;</span><span style="color:#f92672">;</span>
                <span style="color:#66d9ef">return</span> s<span style="color:#f92672">;</span>
            <span style="color:#f92672">}</span>

        <span style="color:#f92672">}</span>
              
        <span style="color:#75715e">/**
</span><span style="color:#75715e">         * 监听是否有输出消息请求线程类,向客户端发送消息
</span><span style="color:#75715e">         */</span>
        <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">PrintOutThread</span> <span style="color:#66d9ef">extends</span> Thread
        <span style="color:#f92672">{</span>
            <span style="color:#66d9ef">public</span> <span style="color:#a6e22e">PrintOutThread</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span>
            <span style="color:#f92672">{</span>
                start<span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
            <span style="color:#f92672">}</span>
              
            <span style="color:#a6e22e">@Override</span>
            <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">run</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span> 
            <span style="color:#f92672">{</span>
                <span style="color:#66d9ef">while</span><span style="color:#f92672">(</span><span style="color:#66d9ef">true</span><span style="color:#f92672">)</span><span style="color:#f92672">{</span>
                    <span style="color:#66d9ef">if</span><span style="color:#f92672">(</span>isPrint<span style="color:#f92672">)</span><span style="color:#f92672">{</span><span style="color:#75715e">//将缓存在队列中的消息按顺序发送到各客户端，并从队列中清除。
</span><span style="color:#75715e"></span>                        String message <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
                                                <span style="color:#66d9ef">try</span>
                                                <span style="color:#f92672">{</span>
                                                        message <span style="color:#f92672">=</span> message_list<span style="color:#f92672">.</span><span style="color:#a6e22e">take</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                                                <span style="color:#f92672">}</span> <span style="color:#66d9ef">catch</span> <span style="color:#f92672">(</span>InterruptedException e1<span style="color:#f92672">)</span>
                                                <span style="color:#f92672">{</span>
                                                        <span style="color:#75715e">// TODO Auto-generated catch block
</span><span style="color:#75715e"></span>                                                        e1<span style="color:#f92672">.</span><span style="color:#a6e22e">printStackTrace</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                                                <span style="color:#f92672">}</span>
                        <span style="color:#75715e">//message = message_list.getFirst();
</span><span style="color:#75715e"></span>                        <span style="color:#66d9ef">for</span> <span style="color:#f92672">(</span>ServerThread thread <span style="color:#f92672">:</span> thread_list<span style="color:#f92672">)</span> 
                        <span style="color:#f92672">{</span>
                            <span style="color:#66d9ef">try</span>
                                                        <span style="color:#f92672">{</span>
                                    <span style="color:#75715e">//this.
</span><span style="color:#75715e"></span>                                    thread<span style="color:#f92672">.</span><span style="color:#a6e22e">sendMessage</span><span style="color:#f92672">(</span>message<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                                                        <span style="color:#f92672">}</span> <span style="color:#66d9ef">catch</span> <span style="color:#f92672">(</span>Exception e<span style="color:#f92672">)</span>
                                                        <span style="color:#f92672">{</span>
                                                                <span style="color:#75715e">// TODO Auto-generated catch block
</span><span style="color:#75715e"></span>                                                                e<span style="color:#f92672">.</span><span style="color:#a6e22e">printStackTrace</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                                                        <span style="color:#f92672">}</span>
                        <span style="color:#f92672">}</span>
                       <span style="color:#75715e">// message_list.removeFirst();
</span><span style="color:#75715e"></span>                        <span style="color:#75715e">//isPrint = false;
</span><span style="color:#75715e"></span>                        <span style="color:#75715e">//这句话很重要！！！不能随便修改
</span><span style="color:#75715e"></span>                        isPrint <span style="color:#f92672">=</span> message_list<span style="color:#f92672">.</span><span style="color:#a6e22e">size</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">&gt;</span>0 <span style="color:#f92672">?</span><span style="color:#66d9ef">true</span> <span style="color:#f92672">:</span><span style="color:#66d9ef">false</span><span style="color:#f92672">;</span>
                    <span style="color:#f92672">}</span>
                <span style="color:#f92672">}</span>
            <span style="color:#f92672">}</span>
        <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><p><img src="/images/java/%E6%9C%8D%E5%8A%A1%E5%99%A83.png" alt="有问题的版本（但是基本满足题意）"></p>
<p><img src="/images/java/%E5%B1%85%E7%84%B6%E4%B8%8D%E5%8D%A1%E4%BA%86.png" alt="不卡版本，且解决了登陆时候的多条打印问题"></p>
<p>1 动机是为了熟悉网络编程，于是重写了之前写过的代码。从TCPServer 1 2 3三个进行重新的改写
2 发现TCPServer3有问题？<br>
在客户端连接上后，客户端发送数据可以到服务器端，接着切换到服务器端，但是服务器的输入出现了问题，
无论你输入一个字还是n个字都无法切换回客户端了</p>
<p>3 于是基于这个问题开始进行修改
主要包含一个主要
版本1     Server有一对读写线程类   Client有一对读写线程类
版本2     Server有一对读写线程类   Client没有一对读写线程类
版本3    Server有一个ServerThread线程类    Client有一个readLineThread线程类</p>
<p>真的是从原先的四个类，到最后抛弃了原先的四个类，重写了另外的几个类</p>
<p>RewriteServer1.java
RewriteServer2.java
RewriteServer3.java
RewriteServer4.java
RewriteServer5.java
最后的一个版本是RewriteServer5</p>
<p>4 版本3  引入了新的数据结构 CopyWriteArrayList和LinkedBlockingQueue 线程阻塞类</p>
<p>5: 注意了
5.1 线程的使用(从thread到Runnable)，线程开启放置的位置，最后发现使用了多线程服务器客户端
5.2 静态代码段static的使用
5.3 ServerThread的静态变量的使用，配合上构造函数
5.4 数据结构的使用</p>
<p>猛然发现一个特点：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">  GTK<span style="color:#f92672">.</span><span style="color:#a6e22e">g_timeout_add</span><span style="color:#f92672">(</span>100<span style="color:#f92672">,</span> <span style="color:#66d9ef">new</span> IGSourceFunc<span style="color:#f92672">(</span><span style="color:#f92672">)</span>
                <span style="color:#f92672">{</span>
                        
                        <span style="color:#a6e22e">@Override</span>
                        <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">boolean</span> <span style="color:#a6e22e">execute</span><span style="color:#f92672">(</span>Object userdata<span style="color:#f92672">)</span>
                        <span style="color:#f92672">{</span>
                                <span style="color:#75715e">// TODO Auto-generated method stub
</span><span style="color:#75715e"></span>                                <span style="color:#66d9ef">int</span> len <span style="color:#f92672">=</span> otv<span style="color:#f92672">.</span><span style="color:#a6e22e">getText</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">.</span><span style="color:#a6e22e">length</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                                <span style="color:#66d9ef">char</span> ch <span style="color:#f92672">=</span> love<span style="color:#f92672">.</span><span style="color:#a6e22e">charAt</span><span style="color:#f92672">(</span>len<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                                otv<span style="color:#f92672">.</span><span style="color:#a6e22e">insertTextAtEnd</span><span style="color:#f92672">(</span>Character<span style="color:#f92672">.</span><span style="color:#a6e22e">toString</span><span style="color:#f92672">(</span>ch<span style="color:#f92672">)</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                                <span style="color:#66d9ef">if</span><span style="color:#f92672">(</span>otv<span style="color:#f92672">.</span><span style="color:#a6e22e">getText</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">.</span><span style="color:#a6e22e">length</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span> <span style="color:#f92672">=</span><span style="color:#f92672">=</span> love<span style="color:#f92672">.</span><span style="color:#a6e22e">length</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">-</span>1<span style="color:#f92672">)</span>
                                <span style="color:#f92672">{</span>
                                        <span style="color:#75715e">//om.close();
</span><span style="color:#75715e"></span>                                        <span style="color:#66d9ef">try</span>
                                        <span style="color:#f92672">(</span>
                                                        OOMusic om <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> OOMusic<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;我如此爱你.mp3&#34;</span><span style="color:#f92672">,</span><span style="color:#66d9ef">true</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                                        <span style="color:#f92672">)</span>
                                        <span style="color:#f92672">{</span>
                                                        om<span style="color:#f92672">.</span><span style="color:#a6e22e">playRepeat</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                                        <span style="color:#f92672">}</span>
                                
                                        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">true</span><span style="color:#f92672">;</span>
                                <span style="color:#f92672">}</span><span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span><span style="color:#f92672">(</span>otv<span style="color:#f92672">.</span><span style="color:#a6e22e">getText</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">.</span><span style="color:#a6e22e">length</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span> <span style="color:#f92672">=</span><span style="color:#f92672">=</span> love<span style="color:#f92672">.</span><span style="color:#a6e22e">length</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span>
                                <span style="color:#f92672">{</span>
                                        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">false</span><span style="color:#f92672">;</span>
                                <span style="color:#f92672">}</span>
                                <span style="color:#66d9ef">else</span>
                                <span style="color:#f92672">{</span> 
                                        <span style="color:#75715e">//System.out.println(&#34;2&#34;);
</span><span style="color:#75715e"></span>                                        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">true</span><span style="color:#f92672">;</span>
                                <span style="color:#f92672">}</span>

                        <span style="color:#f92672">}</span>
                <span style="color:#f92672">}</span><span style="color:#f92672">,</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
</code></pre></div><p>2：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">vgOpen<span style="color:#f92672">.</span><span style="color:#a6e22e">addActivateListener</span><span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> IGCallBack<span style="color:#f92672">(</span><span style="color:#f92672">)</span>
                <span style="color:#f92672">{</span>
                        
                        <span style="color:#a6e22e">@Override</span>
                        <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">execute</span><span style="color:#f92672">(</span><span style="color:#66d9ef">int</span> instance<span style="color:#f92672">,</span> <span style="color:#66d9ef">int</span> eventData<span style="color:#f92672">,</span> Object object<span style="color:#f92672">)</span>
                        <span style="color:#f92672">{</span>
                                youOpenfile<span style="color:#f92672">(</span>ootv<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                                
                        <span style="color:#f92672">}</span>
                <span style="color:#f92672">}</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
</code></pre></div><p>3：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#75715e">//添加按钮事件
</span><span style="color:#75715e"></span>                GTK<span style="color:#f92672">.</span><span style="color:#a6e22e">g_signal_connect</span><span style="color:#f92672">(</span>btnShow<span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;clicked&#34;</span><span style="color:#f92672">,</span> <span style="color:#66d9ef">new</span> IGCallBack<span style="color:#f92672">(</span><span style="color:#f92672">)</span> 
                <span style="color:#f92672">{</span>
                        <span style="color:#a6e22e">@Override</span>
                        <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">execute</span><span style="color:#f92672">(</span><span style="color:#66d9ef">int</span> instance<span style="color:#f92672">,</span> <span style="color:#66d9ef">int</span> eventData<span style="color:#f92672">,</span> Object object<span style="color:#f92672">)</span>
                        <span style="color:#f92672">{</span>
                                <span style="color:#75715e">// TODO 自动生成的方法存根
</span><span style="color:#75715e"></span>                                String text <span style="color:#f92672">=</span> GTK<span style="color:#f92672">.</span><span style="color:#a6e22e">gtk_text_buffer_get_text</span><span style="color:#f92672">(</span>textbuffer<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                                GTK<span style="color:#f92672">.</span><span style="color:#a6e22e">gtk_label_set_text</span><span style="color:#f92672">(</span>label<span style="color:#f92672">,</span> text<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                        <span style="color:#f92672">}</span>
                <span style="color:#f92672">}</span><span style="color:#f92672">,</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
</code></pre></div><p>4：
前三个都是针对gtk的
awt的事件关闭监听，</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">f <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> JFrame<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;客户端&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
f<span style="color:#f92672">.</span><span style="color:#a6e22e">addWindowListener</span><span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> WindowAdapter<span style="color:#f92672">(</span><span style="color:#f92672">)</span>
                    <span style="color:#f92672">{</span>
                        <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">windowClosing</span><span style="color:#f92672">(</span>WindowEvent e<span style="color:#f92672">)</span>
                        <span style="color:#f92672">{</span>
                            System<span style="color:#f92672">.</span><span style="color:#a6e22e">exit</span><span style="color:#f92672">(</span>0<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                        <span style="color:#f92672">}</span>
                    <span style="color:#f92672">}</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
</code></pre></div><p>当然在JFrame可以采用：
f.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);
复制代码
他们共同的特点是都采用匿名类，当做时间的响应函数或者回调函数，于是当前的网络编程的button和  textfield也是采用匿名类来实现：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">TCPClientListener</span> <span style="color:#66d9ef">implements</span> ActionListener
        <span style="color:#f92672">{</span>
            <span style="color:#a6e22e">@Override</span>
            <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">actionPerformed</span><span style="color:#f92672">(</span>ActionEvent e<span style="color:#f92672">)</span>
            <span style="color:#f92672">{</span>
                   <span style="color:#66d9ef">try</span><span style="color:#f92672">{</span>
                        String str <span style="color:#f92672">=</span> tf<span style="color:#f92672">.</span><span style="color:#a6e22e">getText</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                        tf<span style="color:#f92672">.</span><span style="color:#a6e22e">setText</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                        ta<span style="color:#f92672">.</span><span style="color:#a6e22e">append</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;客户端说:&#34;</span><span style="color:#f92672">+</span>str<span style="color:#f92672">+</span><span style="color:#e6db74">&#34;\n&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                        dos<span style="color:#f92672">.</span><span style="color:#a6e22e">writeUTF</span><span style="color:#f92672">(</span>str<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                        <span style="color:#66d9ef">if</span><span style="color:#f92672">(</span>str<span style="color:#f92672">.</span><span style="color:#a6e22e">equalsIgnoreCase</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;再见&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span>
                        <span style="color:#f92672">{</span>
                            close<span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                            System<span style="color:#f92672">.</span><span style="color:#a6e22e">exit</span><span style="color:#f92672">(</span>0<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                        <span style="color:#f92672">}</span>
                   <span style="color:#f92672">}</span><span style="color:#66d9ef">catch</span><span style="color:#f92672">(</span>Exception e1<span style="color:#f92672">)</span>
                   <span style="color:#f92672">{</span>
                      <span style="color:#75715e">// e.printStackTrace();
</span><span style="color:#75715e"></span>                      System<span style="color:#f92672">.</span><span style="color:#a6e22e">exit</span><span style="color:#f92672">(</span>0<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                   <span style="color:#f92672">}</span> 
            <span style="color:#f92672">}</span>
        <span style="color:#f92672">}</span>
</code></pre></div><p>添加监听：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">
         tf<span style="color:#f92672">.</span><span style="color:#a6e22e">addActionListener</span><span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> TCPClientListener<span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
                bn<span style="color:#f92672">.</span><span style="color:#a6e22e">addActionListener</span><span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> TCPClientListener<span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
</code></pre></div><p>注意匿名类的监听函数的匿名类对象实现回调</p>
<p>学习了匿名类的事件回调函数。</p>
    </div>
 <div class="nav-links" style="padding:10;">
        
        <div align="left">
        <a href="https://jueqingsizhe66.github.io/blog/2015/05/11/ce-shi-wai-bu-dtdyue-shu-de-you-xiao-xing/"><span class="arrow">←</span> <strong>上一篇:测试外部DTD约束的有效性</strong></a>
        </div>
        
        


       <div align="right"> <a href="https://jueqingsizhe66.github.io/blog/2015/05/11/mysql2yue-15ri-javaban-zuo-ye-bi-ji/" ><strong>下一篇:mysql2月15日Java班作业笔记 </strong><span class="arrow">→</span></a></div>
        
      </div>
    





<div class="article-tags">
  
  <a class="badge badge-light" href="/tags/javabasic/">JavaBasic</a>
  
</div>



<div class="share-box" aria-hidden="true">
  <ul class="share">
    
      
      
      
        
      
      
      
      <li>
        <a href="https://twitter.com/intent/tweet?url=https://jueqingsizhe66.github.io/blog/2015/05/11/duo-xian-cheng-march18th/&amp;text=%e5%a4%9a%e7%ba%bf%e7%a8%8bMarch18th" target="_blank" rel="noopener" class="share-btn-twitter">
          <i class="fab fa-twitter"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="https://www.facebook.com/sharer.php?u=https://jueqingsizhe66.github.io/blog/2015/05/11/duo-xian-cheng-march18th/&amp;t=%e5%a4%9a%e7%ba%bf%e7%a8%8bMarch18th" target="_blank" rel="noopener" class="share-btn-facebook">
          <i class="fab fa-facebook"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="mailto:?subject=%e5%a4%9a%e7%ba%bf%e7%a8%8bMarch18th&amp;body=https://jueqingsizhe66.github.io/blog/2015/05/11/duo-xian-cheng-march18th/" target="_blank" rel="noopener" class="share-btn-email">
          <i class="fas fa-envelope"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="https://www.linkedin.com/shareArticle?url=https://jueqingsizhe66.github.io/blog/2015/05/11/duo-xian-cheng-march18th/&amp;title=%e5%a4%9a%e7%ba%bf%e7%a8%8bMarch18th" target="_blank" rel="noopener" class="share-btn-linkedin">
          <i class="fab fa-linkedin-in"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="https://web.whatsapp.com/send?text=%e5%a4%9a%e7%ba%bf%e7%a8%8bMarch18th%20https://jueqingsizhe66.github.io/blog/2015/05/11/duo-xian-cheng-march18th/" target="_blank" rel="noopener" class="share-btn-whatsapp">
          <i class="fab fa-whatsapp"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="https://service.weibo.com/share/share.php?url=https://jueqingsizhe66.github.io/blog/2015/05/11/duo-xian-cheng-march18th/&amp;title=%e5%a4%9a%e7%ba%bf%e7%a8%8bMarch18th" target="_blank" rel="noopener" class="share-btn-weibo">
          <i class="fab fa-weibo"></i>
        </a>
      </li>
    
  </ul>
</div>












  






  
  
  
    
  
  
  <div class="media author-card content-widget-hr">
    
      
      <img class="portrait mr-3" src="/authors/admin/avatar_hu52a603635ecebd45650b162dadabb4e5_12861_250x250_fill_q90_lanczos_center.jpg" alt="Avatar">
    

    <div class="media-body">
      <h5 class="card-title"><a href="https://jueqingsizhe66.github.io/">Ye Zhaoliang</a></h5>
      <h6 class="card-subtitle">Engineer of offshore wind turbine technique research</h6>
      <p class="card-text">My research interests include distributed energy, wind turbine power generation technique , Computational fluid dynamic and programmable matter.</p>
      <ul class="network-icon" aria-hidden="true">
  
    
    
    
      
    
    
    
    
    
      
    
    <li>
      <a href="/#contact" >
        <i class="fas fa-envelope"></i>
      </a>
    </li>
  
    
    
    
      
    
    
    
    
    
      
    
    <li>
      <a href="https://twitter.com/jueqingsizhe66" target="_blank" rel="noopener">
        <i class="fab fa-twitter"></i>
      </a>
    </li>
  
    
    
    
    
    
    
    
      
    
    <li>
      <a href="https://scholar.google.co.uk/citations?user=7VyEMyQAAAAJ&amp;hl=zh-CN" target="_blank" rel="noopener">
        <i class="ai ai-google-scholar"></i>
      </a>
    </li>
  
    
    
    
      
    
    
    
    
    
      
    
    <li>
      <a href="https://github.com/jueqingsizhe66" target="_blank" rel="noopener">
        <i class="fab fa-github"></i>
      </a>
    </li>
  
</ul>

    </div>
  </div>









  
  
  <div class="article-widget content-widget-hr">
    <h3>Related</h3>
    <ul>
      
      <li><a href="/blog/2015/05/11/di-gui-de-jian-dan-chan-shu/">递归的简单阐述</a></li>
      
      <li><a href="/blog/2015/05/11/jarbao-da-bao-cheng-ke-an-zhuang-de-exewen-jian/">Jar包打包成可安装的EXE文件</a></li>
      
      <li><a href="/blog/2015/05/11/javaban-1yue-24ri/">Java班 1月24日</a></li>
      
      <li><a href="/blog/2015/05/11/css7-14jie-bi-ji-dai-ma-march25th/">css7-14节笔记代码March25th</a></li>
      
      <li><a href="/blog/2015/05/11/emailyou-jian-fa-song-plus-oogtk-0217/">email邮件发送&#43;OOGTK(0217)</a></li>
      
    </ul>


         <span id="busuanzi_container_site_pv"> 
             本站访问量：<span id="busuanzi_value_site_pv"></span>次 
         </span> 
         &nbsp; 
   </div> 


  </div>

</article>
<script src="https://utteranc.es/client.js"
        repo="jueqingsizhe66/jueqingsizhe66.github.io"
        issue-term="pathname"
        theme="github-dark"
        crossorigin="anonymous"
        async>
</script>

      

    
    
    
    <script src="/js/mathjax-config.js"></script>
    

    
    
    
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.4/imagesloaded.pkgd.min.js" integrity="sha256-lqvxZrPLtfffUl2G/e7szqSvPBILGbwmsGE1MKlOi0Q=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.isotope/3.0.6/isotope.pkgd.min.js" integrity="sha256-CBrpuqrMhXwcLLUd5tvQ4euBHCdh7wGlDfNz8vbu/iI=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.2.5/jquery.fancybox.min.js" integrity="sha256-X5PoE3KU5l+JcX+w09p/wHl9AzK333C4hJ2I9S5mD4M=" crossorigin="anonymous"></script>

      

      
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/highlight.min.js" integrity="sha256-aYTdUrn6Ow1DDgh5JTc3aDGnnju48y/1c8s1dgkYPQ8=" crossorigin="anonymous"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/languages/go.min.js"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/languages/vim.min.js"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/languages/matlab.min.js"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/languages/sql.min.js"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/languages/python.min.js"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/languages/c.min.js"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/languages/scheme.min.js"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/languages/racket.min.js"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/languages/perl.min.js"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/languages/awk.min.js"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/languages/clojure.min.js"></script>
        
      

      
      
      <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-AMS_CHTML-full" integrity="sha256-GhM+5JHb6QUzOQPXSJLEWP7R73CbkisjzK5Eyij4U9w=" crossorigin="anonymous" async></script>
      
    

    
    
      <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.2.0/leaflet.js" integrity="sha512-lInM/apFSqyy1o6s89K4iQUKg6ppXEgsVxT35HbzUupEVRh2Eu9Wdl4tHj7dZO0s1uvplcYGmt3498TtHq+log==" crossorigin="anonymous"></script>
    

    
    
    <script>hljs.initHighlightingOnLoad();</script>
    

    
    
    
    
    
    
    <script>
      const search_config = {"indexURI":"/index.json","minLength":1,"threshold":0.3};
      const i18n = {"no_results":"No results found","placeholder":"Search...","results":"results found"};
      const content_type = {
        'post': "Posts",
        'project': "Projects",
        'publication' : "Publications",
        'talk' : "Talks"
        };
    </script>
    

    
    

    
    
    <script id="search-hit-fuse-template" type="text/x-template">
      <div class="search-hit" id="summary-{{key}}">
      <div class="search-hit-content">
        <div class="search-hit-name">
          <a href="{{relpermalink}}">{{title}}</a>
          <div class="article-metadata search-hit-type">{{type}}</div>
          <p class="search-hit-description">{{snippet}}</p>
        </div>
      </div>
      </div>
    </script>
    

    
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/3.2.1/fuse.min.js" integrity="sha256-VzgmKYmhsGNNN4Ph1kMW+BjoYJM2jV5i4IlFoeZA9XI=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script>
    

    
    

    
    

    
    
    
    
    
    
    
    
    
      
    
    
    
    
    <script src="/js/academic.min.d6bd04fdad2ad213aa8111c5a3b72fc5.js"></script>

    






  
  
  <div class="container">
    <footer class="site-footer">
  

  <p class="powered-by">
    ©2020 &middot; 

    Powered by the
    <a href="https://sourcethemes.com/academic/" target="_blank" rel="noopener">Academic theme</a> for
    <a href="https://gohugo.io" target="_blank" rel="noopener">Hugo</a>.

    
    <span class="float-right" aria-hidden="true">
      <a href="#" class="back-to-top">
        <span class="button_icon">
          <i class="fas fa-chevron-up fa-2x"></i>
        </span>
      </a>
    </span>
    
  </p>
</footer>

  </div>
  

  
<div id="modal" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Cite</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <pre><code class="tex hljs"></code></pre>
      </div>
      <div class="modal-footer">
        <a class="btn btn-outline-primary my-1 js-copy-cite" href="#" target="_blank">
          <i class="fas fa-copy"></i> Copy
        </a>
        <a class="btn btn-outline-primary my-1 js-download-cite" href="#" target="_blank">
          <i class="fas fa-download"></i> Download
        </a>
        <div id="modal-error"></div>
      </div>
    </div>
  </div>
</div>

</body>
</html>
